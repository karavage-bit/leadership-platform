"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[737],{1737:function(e,s,t){t.r(s),t.d(s,{default:function(){return V}});var r=t(8357),o=t(921),a=t(440),i=t(3691),n=t(1418),l=t(3689),c=t(687),d=t(9515),x=t(1271),h=t(7639),m=t(1500),p=t(9567),u=t(7968),j=t(1869);let b=[{name:"forward",keys:["KeyW","ArrowUp"]},{name:"backward",keys:["KeyS","ArrowDown"]},{name:"left",keys:["KeyA","ArrowLeft"]},{name:"right",keys:["KeyD","ArrowRight"]},{name:"jump",keys:["Space"]},{name:"interact",keys:["KeyE"]},{name:"placement",keys:["KeyP"]},{name:"brainstorm",keys:["KeyB"]}];function g(e){let s=1e4*Math.sin(e);return s-Math.floor(s)}function y(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s&=s;return Math.abs(s)}class f{init(){if(!this.ctx)try{this.ctx=new(window.AudioContext||window.webkitAudioContext),this.gain=this.ctx.createGain(),this.gain.connect(this.ctx.destination),this.gain.gain.value=.25}catch(e){console.log("No audio")}}play(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sine";if(!this.ctx||!this.gain||this.muted)return;let r=this.ctx.createOscillator(),o=this.ctx.createGain();r.type=t,r.frequency.setValueAtTime(e,this.ctx.currentTime),o.gain.setValueAtTime(.2,this.ctx.currentTime),o.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+s),r.connect(o),o.connect(this.gain),r.start(),r.stop(this.ctx.currentTime+s)}step(){this.play(200+100*Math.random(),.08,"sine")}pop(){this.play(880,.1,"sine")}place(){this.play(523,.15,"sine"),setTimeout(()=>this.play(659,.15,"sine"),100)}discover(){[523,659,784,1047].forEach((e,s)=>setTimeout(()=>this.play(e,.2),80*s))}toggle(){return this.muted=!this.muted,this.gain&&(this.gain.gain.value=this.muted?0:.25),this.muted}isMuted(){return this.muted}constructor(){this.ctx=null,this.gain=null,this.muted=!1}}let w=new f,v={grass:["#4ade80","#22c55e","#16a34a"],dirt:["#92400e","#78350f","#5c2d0e"],stone:["#6b7280","#4b5563","#374151"],wood:["#78350f","#92400e","#5c2d0e"],leaves:["#166534","#15803d","#14532d","#0f5132"],water:"#0369a1",flowers:["#f472b6","#fb923c","#facc15","#a78bfa","#f87171","#34d399","#60a5fa","#f9a8d4"],skin:["#fcd5ce","#f5cba7","#d4a574","#c19a6b","#8d5524"],shirts:["#dc2626","#2563eb","#7c3aed","#059669","#d97706","#0891b2","#be185d"],pants:["#1e40af","#4c1d95","#0f766e","#991b1b","#92400e","#1e3a5f"],hair:["#451a03","#1c1917","#78350f","#fbbf24","#7c2d12","#1e293b"]};function M(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.12,t=document.createElement("canvas");t.width=16,t.height=16;let r=t.getContext("2d");r.fillStyle=e,r.fillRect(0,0,16,16);for(let e=0;e<16;e++)for(let t=0;t<16;t++)if(.3>Math.random()){let o=.5>Math.random()?-s:s;r.fillStyle="rgba(".concat(o>0?255:0,",").concat(o>0?255:0,",").concat(o>0?255:0,",").concat(Math.abs(o),")"),r.fillRect(e,t,1,1)}r.strokeStyle="rgba(0,0,0,0.2)",r.lineWidth=1,r.strokeRect(.5,.5,15,15);let o=new j.CanvasTexture(t);return o.magFilter=j.NearestFilter,o.minFilter=j.NearestFilter,new j.MeshLambertMaterial({map:o,color:e})}let k=e=>{let{position:s}=e,t=(0,o.useMemo)(()=>M(v.grass[0],.15),[]);return(0,r.jsxs)("mesh",{position:s,castShadow:!0,receiveShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1,1,1]}),(0,r.jsx)("primitive",{object:t,attach:"material"})]})},D=e=>{let{position:s}=e,t=(0,o.useMemo)(()=>M(v.dirt[0],.2),[]);return(0,r.jsxs)("mesh",{position:s,castShadow:!0,receiveShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1,1,1]}),(0,r.jsx)("primitive",{object:t,attach:"material"})]})},S=e=>{let{position:s}=e,t=(0,o.useMemo)(()=>M(v.stone[0],.25),[]);return(0,r.jsxs)("mesh",{position:s,castShadow:!0,receiveShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1,1,1]}),(0,r.jsx)("primitive",{object:t,attach:"material"})]})};function N(e){let{position:s,name:t,seed:i,isLocalPlayer:d,onPositionChange:x}=e,h=(0,o.useRef)(null),m=(0,o.useRef)(new j.Vector3),[p,u]=(0,o.useState)(!1),[,b]=(0,n.Z)(),g=(0,o.useMemo)(()=>({skin:v.skin[i%v.skin.length],shirt:v.shirts[i%v.shirts.length],pants:v.pants[(i+1)%v.pants.length],hair:v.hair[(i+2)%v.hair.length]}),[i]);return(0,a.F)((e,t)=>{if(h.current){if(d){let e=b(),s=new j.Vector3;if(e.forward&&(s.z-=1),e.backward&&(s.z+=1),e.left&&(s.x-=1),e.right&&(s.x+=1),s.length()>0){s.normalize(),m.current.x+=.08*s.x,m.current.z+=.08*s.z;let e=Math.atan2(s.x,s.z);h.current.rotation.y=j.MathUtils.lerp(h.current.rotation.y,e,.15),.05>Math.random()&&w.step()}m.current.multiplyScalar(.85),h.current.position.add(m.current);let t=h.current.position,r=Math.sqrt(t.x*t.x+t.z*t.z);r>5&&(t.x=t.x/r*5,t.z=t.z/r*5),x&&x(h.current.position.clone())}h.current&&(h.current.position.y=s.y+.03*Math.sin(2*e.clock.elapsedTime))}}),(0,r.jsxs)("group",{ref:h,position:s,onPointerOver:()=>u(!0),onPointerOut:()=>u(!1),children:[d&&(0,r.jsxs)("mesh",{position:[0,-.48,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("circleGeometry",{args:[.5,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#fef08a",transparent:!0,opacity:.12})]}),(0,r.jsxs)("mesh",{position:[0,-.47,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("circleGeometry",{args:[.3,16]}),(0,r.jsx)("meshBasicMaterial",{color:"#000",transparent:!0,opacity:.25})]}),(0,r.jsxs)("mesh",{position:[-.1,.22,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.18,.44,.18]}),(0,r.jsx)("meshLambertMaterial",{color:g.pants})]}),(0,r.jsxs)("mesh",{position:[.1,.22,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.18,.44,.18]}),(0,r.jsx)("meshLambertMaterial",{color:g.pants})]}),(0,r.jsxs)("mesh",{position:[-.1,.04,.02],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.2,.08,.24]}),(0,r.jsx)("meshLambertMaterial",{color:"#1f2937"})]}),(0,r.jsxs)("mesh",{position:[.1,.04,.02],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.2,.08,.24]}),(0,r.jsx)("meshLambertMaterial",{color:"#1f2937"})]}),(0,r.jsxs)("mesh",{position:[0,.62,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.36,.44,.22]}),(0,r.jsx)("meshLambertMaterial",{color:g.shirt})]}),(0,r.jsxs)("mesh",{position:[-.25,.62,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.14,.4,.16]}),(0,r.jsx)("meshLambertMaterial",{color:g.shirt})]}),(0,r.jsxs)("mesh",{position:[.25,.62,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.14,.4,.16]}),(0,r.jsx)("meshLambertMaterial",{color:g.shirt})]}),(0,r.jsxs)("mesh",{position:[-.25,.38,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.11,.11,.13]}),(0,r.jsx)("meshLambertMaterial",{color:g.skin})]}),(0,r.jsxs)("mesh",{position:[.25,.38,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.11,.11,.13]}),(0,r.jsx)("meshLambertMaterial",{color:g.skin})]}),(0,r.jsxs)("mesh",{position:[0,1,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.36,.36,.36]}),(0,r.jsx)("meshLambertMaterial",{color:g.skin})]}),(0,r.jsxs)("mesh",{position:[0,1.17,-.01],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.38,.14,.38]}),(0,r.jsx)("meshLambertMaterial",{color:g.hair})]}),(0,r.jsxs)("mesh",{position:[-.08,1.02,.18],children:[(0,r.jsx)("boxGeometry",{args:[.06,.06,.02]}),(0,r.jsx)("meshBasicMaterial",{color:"#1f2937"})]}),(0,r.jsxs)("mesh",{position:[.08,1.02,.18],children:[(0,r.jsx)("boxGeometry",{args:[.06,.06,.02]}),(0,r.jsx)("meshBasicMaterial",{color:"#1f2937"})]}),(0,r.jsxs)("mesh",{position:[-.06,1.03,.182],children:[(0,r.jsx)("boxGeometry",{args:[.02,.02,.01]}),(0,r.jsx)("meshBasicMaterial",{color:"#fff"})]}),(0,r.jsxs)("mesh",{position:[.1,1.03,.182],children:[(0,r.jsx)("boxGeometry",{args:[.02,.02,.01]}),(0,r.jsx)("meshBasicMaterial",{color:"#fff"})]}),(0,r.jsxs)("mesh",{position:[0,.93,.18],children:[(0,r.jsx)("boxGeometry",{args:[.1,.025,.01]}),(0,r.jsx)("meshBasicMaterial",{color:"#dc2626"})]}),(0,r.jsx)(l.V,{position:[0,1.5,0],center:!0,style:{pointerEvents:"none"},children:(0,r.jsxs)("div",{className:"\n          px-2 py-1 rounded-full text-xs font-bold whitespace-nowrap transition-all\n          ".concat(d?"bg-yellow-400 text-black":"bg-black/70 text-white","\n          ").concat(p?"scale-110":"scale-100","\n        "),children:[d?"⭐ ":"",t]})}),d&&(0,r.jsx)(c.P,{count:6,scale:1,size:2,speed:.3,color:"#fef08a"})]})}function G(e){let{target:s,enabled:t}=e,{camera:r}=(0,a.D)(),i=(0,o.useRef)(new j.Vector3(8,6,8));return(0,a.F)(()=>{if(!t)return;let e=s.clone().add(i.current);r.position.lerp(e,.05);let o=s.clone();o.y+=1,r.lookAt(o)}),null}function L(e){let{position:s,seed:t,memory:i,onInteract:n}=e,[c,d]=(0,o.useState)(!1),x=(0,o.useRef)(null),h=t%3,m=v.leaves[t%v.leaves.length],p=2+Math.floor(2*g(t));return(0,a.F)(e=>{x.current&&(x.current.rotation.z=.015*Math.sin(.8*e.clock.elapsedTime+t))}),(0,r.jsxs)("group",{ref:x,position:s,onPointerOver:()=>{d(!0),w.pop()},onPointerOut:()=>d(!1),onClick:()=>null==n?void 0:n(),children:[Array.from({length:p},(e,s)=>(0,r.jsxs)("mesh",{position:[0,.6*s+.3,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.3,.6,.3]}),(0,r.jsx)("meshLambertMaterial",{color:v.wood[0]})]},s)),0===h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,.6*p+.4,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1.3,1,1.3]}),(0,r.jsx)("meshLambertMaterial",{color:m})]}),(0,r.jsxs)("mesh",{position:[0,.6*p+1.1,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.9,.7,.9]}),(0,r.jsx)("meshLambertMaterial",{color:m})]})]}),1===h&&(0,r.jsx)(r.Fragment,{children:[0,.45,.85,1.2].map((e,s)=>(0,r.jsxs)("mesh",{position:[0,.6*p+e,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1.5-.35*s,.45,1.5-.35*s]}),(0,r.jsx)("meshLambertMaterial",{color:m})]},s))}),2===h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[-.3,.6*p+.3,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.9,.8,.9]}),(0,r.jsx)("meshLambertMaterial",{color:m})]}),(0,r.jsxs)("mesh",{position:[.3,.6*p+.4,.2],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.9,.8,.9]}),(0,r.jsx)("meshLambertMaterial",{color:m})]}),(0,r.jsxs)("mesh",{position:[0,.6*p+.9,-.1],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1,.7,.9]}),(0,r.jsx)("meshLambertMaterial",{color:m})]})]}),c&&i&&(0,r.jsx)(l.V,{position:[0,p+2,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm max-w-[200px] shadow-xl border border-green-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-green-400",children:"\uD83C\uDF32 Tree of Courage"}),(0,r.jsx)("div",{className:"text-xs text-gray-300 mt-1",children:i}),(0,r.jsx)("div",{className:"text-xs text-green-400/70 mt-1",children:"Press E to remember"})]})})]})}function P(e){let{position:s,seed:t,memory:i}=e,n=(0,o.useRef)(null),[c,d]=(0,o.useState)(!1),x=v.flowers[t%v.flowers.length];return(0,a.F)(e=>{n.current&&(n.current.rotation.z=.1*Math.sin(1.5*e.clock.elapsedTime+.5*t))}),(0,r.jsxs)("group",{ref:n,position:s,onPointerOver:()=>{d(!0),w.pop()},onPointerOut:()=>d(!1),children:[(0,r.jsxs)("mesh",{position:[0,.12,0],children:[(0,r.jsx)("boxGeometry",{args:[.04,.24,.04]}),(0,r.jsx)("meshLambertMaterial",{color:"#22c55e"})]}),(0,r.jsxs)("mesh",{position:[0,.28,0],children:[(0,r.jsx)("boxGeometry",{args:[.14,.1,.14]}),(0,r.jsx)("meshLambertMaterial",{color:x})]}),(0,r.jsxs)("mesh",{position:[0,.28,0],children:[(0,r.jsx)("sphereGeometry",{args:[.04,6,6]}),(0,r.jsx)("meshLambertMaterial",{color:"#fbbf24"})]}),c&&i&&(0,r.jsx)(l.V,{position:[0,.8,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-2 py-1 rounded-lg text-xs max-w-[150px] shadow-xl border border-pink-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-pink-400",children:"\uD83C\uDF38 Flower of Care"}),(0,r.jsx)("div",{className:"text-[10px] text-gray-300 mt-0.5",children:i})]})})]})}function C(e){let{position:s,height:t=2,memory:a}=e,[i,n]=(0,o.useState)(!1),c=Math.max(2,Math.min(t+2,8));return(0,r.jsxs)("group",{position:s,onPointerOver:()=>{n(!0),w.pop()},onPointerOut:()=>n(!1),children:[(0,r.jsxs)("mesh",{position:[0,.15,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1.8,.3,1.8]}),(0,r.jsx)("meshLambertMaterial",{color:v.stone[0]})]}),Array.from({length:c},(e,s)=>(0,r.jsxs)("mesh",{position:[0,.45+.7*s,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[1.4-.06*s,.7,1.4-.06*s]}),(0,r.jsx)("meshLambertMaterial",{color:s%2==0?v.stone[1]:v.stone[0]})]},s)),Array.from({length:Math.min(c-1,3)},(e,s)=>(0,r.jsxs)("mesh",{position:[.72-.03*s,.8+1.4*s,0],children:[(0,r.jsx)("boxGeometry",{args:[.04,.28,.2]}),(0,r.jsx)("meshBasicMaterial",{color:"#fef08a"})]},"w-".concat(s))),(0,r.jsxs)("mesh",{position:[0,.45+.7*c+.4,0],castShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[.95,1,4]}),(0,r.jsx)("meshLambertMaterial",{color:"#b91c1c"})]}),(0,r.jsxs)("mesh",{position:[0,.45+.7*c+1.3,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.025,.025,.7,6]}),(0,r.jsx)("meshLambertMaterial",{color:v.wood[0]})]}),(0,r.jsxs)("mesh",{position:[.18,.45+.7*c+1.5,0],children:[(0,r.jsx)("boxGeometry",{args:[.35,.2,.02]}),(0,r.jsx)("meshLambertMaterial",{color:"#eab308"})]}),i&&(0,r.jsx)(l.V,{position:[0,c+2.5,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm shadow-xl border border-yellow-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-yellow-400",children:"\uD83C\uDFDB️ Tower of Creation"}),(0,r.jsxs)("div",{className:"text-xs text-gray-300 mt-1",children:["Level ",t]}),a&&(0,r.jsx)("div",{className:"text-xs text-yellow-400/70 mt-1",children:a})]})})]})}function F(e){let{position:s,memory:t}=e,i=(0,o.useRef)(null),[n,d]=(0,o.useState)(!1);return(0,a.F)(e=>{i.current&&(i.current.rotation.y=.4*e.clock.elapsedTime,i.current.position.y=s[1]+.1*Math.sin(2*e.clock.elapsedTime))}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{ref:i,position:s,onPointerOver:()=>{d(!0),w.pop()},onPointerOut:()=>d(!1),castShadow:!0,children:[(0,r.jsx)("octahedronGeometry",{args:[.4]}),(0,r.jsx)("meshStandardMaterial",{color:"#a855f7",emissive:"#7c3aed",emissiveIntensity:n?1.2:.6,roughness:.15,metalness:.8})]}),(0,r.jsx)(c.P,{count:10,scale:1.2,size:3,speed:.5,color:"#c084fc",position:s}),n&&(0,r.jsx)(l.V,{position:[s[0],s[1]+1,s[2]],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm shadow-xl border border-purple-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-purple-400",children:"\uD83D\uDC8E Ripple Crystal"}),t&&(0,r.jsx)("div",{className:"text-xs text-gray-300 mt-1",children:t})]})})]})}function z(e){let{position:s,discovered:t,onDiscover:a}=e,[i,n]=(0,o.useState)(!1);return t||i?(0,r.jsxs)("group",{position:s,onPointerOver:()=>n(!0),onPointerOut:()=>n(!1),onClick:()=>{a(),w.discover()},children:[(0,r.jsxs)("mesh",{castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.6,.8,.6]}),(0,r.jsx)("meshStandardMaterial",{color:"#6366f1",emissive:"#4f46e5",emissiveIntensity:.5})]}),(0,r.jsx)(c.P,{count:8,scale:1,size:2,speed:.3,color:"#818cf8"}),i&&(0,r.jsx)(l.V,{position:[0,1.2,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm shadow-xl border border-indigo-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-indigo-400",children:"\uD83D\uDDFF Memory Stone"}),(0,r.jsx)("div",{className:"text-xs text-gray-300 mt-1",children:t?"Your first gratitude message is inscribed here":"Click to discover secret!"})]})})]}):(0,r.jsxs)("mesh",{position:s,onPointerOver:()=>n(!0),children:[(0,r.jsx)("boxGeometry",{args:[.5,.5,.5]}),(0,r.jsx)("meshLambertMaterial",{color:v.stone[2],transparent:!0,opacity:.3})]})}function A(e){let{position:s,rippleCount:t,discovered:a}=e,[i,n]=(0,o.useState)(!1);return a?(0,r.jsxs)("group",{position:s,onPointerOver:()=>n(!0),onPointerOut:()=>n(!1),children:[(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("circleGeometry",{args:[1,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#0ea5e9",emissive:"#0284c7",emissiveIntensity:.3,transparent:!0,opacity:.8})]}),(0,r.jsx)(c.P,{count:15,scale:2,size:2,speed:.2,color:"#38bdf8",position:[0,.5,0]}),i&&(0,r.jsx)(l.V,{position:[0,1.5,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm shadow-xl border border-cyan-500/30",children:[(0,r.jsx)("div",{className:"font-bold text-cyan-400",children:"\uD83C\uDF0A Ripple Pool"}),(0,r.jsxs)("div",{className:"text-xs text-gray-300 mt-1",children:["You've started ",t," ripples"]}),(0,r.jsx)("div",{className:"text-xs text-cyan-400/70 mt-1",children:"Look within to see your impact"})]})})]}):null}function T(e){let{start:s,end:t}=e,o=Math.sqrt(Math.pow(t[0]-s[0],2)+Math.pow(t[2]-s[2],2)),a=Math.atan2(t[2]-s[2],t[0]-s[0]),i=(s[0]+t[0])/2,n=(s[2]+t[2])/2;return(0,r.jsxs)("group",{position:[i,s[1],n],rotation:[0,-a,0],children:[(0,r.jsxs)("mesh",{position:[0,-.1,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[o,.15,.25]}),(0,r.jsx)("meshLambertMaterial",{color:v.dirt[0]})]}),Array.from({length:Math.floor(o)},(e,s)=>(0,r.jsxs)("mesh",{position:[s-o/2+.5,.05,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.85,.1,1.2]}),(0,r.jsx)("meshLambertMaterial",{color:v.wood[1]})]},s)),(0,r.jsxs)("mesh",{position:[0,.55,.5],children:[(0,r.jsx)("boxGeometry",{args:[o-.3,.04,.04]}),(0,r.jsx)("meshLambertMaterial",{color:v.dirt[0]})]}),(0,r.jsxs)("mesh",{position:[0,.55,-.5],children:[(0,r.jsx)("boxGeometry",{args:[o-.3,.04,.04]}),(0,r.jsx)("meshLambertMaterial",{color:v.dirt[0]})]}),Array.from({length:Math.ceil(o/1.5)},(e,s)=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[1.5*s-o/2+.5,.35,.5],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.08,.6,.08]}),(0,r.jsx)("meshLambertMaterial",{color:v.wood[0]})]}),(0,r.jsxs)("mesh",{position:[1.5*s-o/2+.5,.35,-.5],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.08,.6,.08]}),(0,r.jsx)("meshLambertMaterial",{color:v.wood[0]})]})]},s))]})}function E(e){let{position:s,unlocked:t}=e,[a,i]=(0,o.useState)(!1);return(0,r.jsxs)("group",{position:s,onPointerOver:()=>i(!0),onPointerOut:()=>i(!1),children:[Array.from({length:9},(e,s)=>(0,r.jsx)(k,{position:[s%3-1,0,Math.floor(s/3)-1]},"g-".concat(s))),Array.from({length:9},(e,s)=>(0,r.jsx)(D,{position:[s%3-1,-1,Math.floor(s/3)-1]},"d-".concat(s))),t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,1.5,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.7,.12,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8b5cf6",emissive:"#7c3aed",emissiveIntensity:.8})]}),(0,r.jsx)(c.P,{count:30,scale:2,size:4,speed:.6,color:"#c084fc",position:[0,1.5,0]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,1,0],castShadow:!0,children:[(0,r.jsx)("boxGeometry",{args:[.8,1.2,.8]}),(0,r.jsx)("meshLambertMaterial",{color:v.stone[1]})]}),(0,r.jsxs)("mesh",{position:[0,1.9,0],castShadow:!0,children:[(0,r.jsx)("octahedronGeometry",{args:[.35]}),(0,r.jsx)("meshLambertMaterial",{color:v.stone[2]})]}),(0,r.jsx)(d.b,{speed:2,floatIntensity:.4,children:(0,r.jsx)(x.x,{position:[0,2.8,0],fontSize:.6,color:"#9ca3af",anchorX:"center",children:"?"})})]}),a&&(0,r.jsx)(l.V,{position:[0,3.5,0],center:!0,children:(0,r.jsxs)("div",{className:"bg-black/90 px-3 py-2 rounded-xl text-sm shadow-xl border border-gray-600/50",children:[(0,r.jsx)("div",{className:"font-bold text-gray-400",children:t?"\uD83C\uDF00 Portal":"\uD83D\uDD12 Mystery Island"}),(0,r.jsx)("div",{className:"text-xs text-gray-300 mt-1",children:t?"Visit friends!":"Build bridges to unlock"})]})})]})}function I(e){let{seed:s,size:t=8,items:a,onItemInteract:i}=e,n=t/2,l=(0,o.useMemo)(()=>{let e=[];for(let t=-n;t<n;t++)for(let r=-n;r<n;r++){let o=Math.sqrt(t*t+r*r),a=Math.max(0,1.8-.2*o+1.2*g(s+1e3*t+r));if(o<n-.2+.6*g(s+100*t+100*r)){e.push({pos:[t,Math.floor(a),r],type:"grass"});for(let s=Math.floor(a)-1;s>=-2;s--)e.push({pos:[t,s,r],type:s>-1?"dirt":"stone"})}}return e},[n,s]);return(0,r.jsxs)("group",{children:[l.map((e,s)=>"grass"===e.type?(0,r.jsx)(k,{position:e.pos},s):"dirt"===e.type?(0,r.jsx)(D,{position:e.pos},s):(0,r.jsx)(S,{position:e.pos},s)),a.map(e=>{switch(e.type){case"tree":return(0,r.jsx)(L,{position:[e.x,e.y,e.z],seed:e.variant,memory:e.memory,onInteract:()=>null==i?void 0:i(e)},e.id);case"flower":return(0,r.jsx)(P,{position:[e.x,e.y,e.z],seed:e.variant,memory:e.memory},e.id);case"tower":return(0,r.jsx)(C,{position:[e.x,e.y,e.z],height:e.variant,memory:e.memory},e.id);case"crystal":return(0,r.jsx)(F,{position:[e.x,e.y,e.z],memory:e.memory},e.id);default:return null}})]})}function B(){let e=(0,o.useRef)(null);return(0,a.F)(s=>{e.current&&(e.current.material.opacity=.7+.05*Math.sin(s.clock.elapsedTime))}),(0,r.jsxs)("mesh",{ref:e,position:[0,-1.8,0],rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("planeGeometry",{args:[80,80]}),(0,r.jsx)("meshStandardMaterial",{color:v.water,transparent:!0,opacity:.75,roughness:.2,metalness:.7})]})}function O(e){let{world:s,userName:t,seed:a,placedItems:i,visitors:n,discoveredSecrets:l,placementMode:c,onItemPlace:b,onSecretDiscover:g,onItemInteract:f}=e,[w,v]=(0,o.useState)(new j.Vector3(0,1,0)),M=(s.bridge||0)>0;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("ambientLight",{intensity:.5}),(0,r.jsx)("directionalLight",{position:[10,18,10],intensity:1.2,castShadow:!0,"shadow-mapSize":[1024,1024],"shadow-camera-far":45,"shadow-camera-left":-18,"shadow-camera-right":18,"shadow-camera-top":18,"shadow-camera-bottom":-18}),(0,r.jsx)("hemisphereLight",{args:["#87ceeb","#2d4a2d",.4]}),(0,r.jsx)(h.q,{distance:45e4,sunPosition:[60,25,60],inclination:.5,azimuth:.25}),(0,r.jsx)(m.t,{radius:70,depth:35,count:600,factor:3,saturation:0,fade:!0,speed:.7}),(0,r.jsx)(p.ZJ,{position:[-10,12,-5],speed:.12,opacity:.45}),(0,r.jsx)(p.ZJ,{position:[8,14,5],speed:.08,opacity:.35}),(0,r.jsx)("fog",{attach:"fog",args:["#1e3a5f",22,60]}),(0,r.jsx)(B,{}),(0,r.jsx)(I,{seed:a,size:8,items:i,onItemInteract:f}),(0,r.jsx)(N,{position:w,name:t,seed:a,isLocalPlayer:!0,onPositionChange:v}),n.map(e=>(0,r.jsx)(N,{position:new j.Vector3(e.x,1,e.z),name:e.name,seed:y(e.name),isLocalPlayer:!1},e.id)),(0,r.jsx)(z,{position:[-4,.5,-4],discovered:l.includes("memory_stone"),onDiscover:()=>null==g?void 0:g("memory_stone")}),l.includes("ripple_pool")&&(0,r.jsx)(A,{position:[3,.1,-3],rippleCount:s.help_given||0,discovered:!0}),(0,r.jsx)(E,{position:[12,0,0],unlocked:M}),M&&(0,r.jsx)(T,{start:[4.5,1,0],end:[9.5,1,0]}),(0,r.jsx)(d.b,{speed:.8,floatIntensity:.15,children:(0,r.jsxs)(x.x,{position:[0,7,0],fontSize:.7,color:"#fff",anchorX:"center",outlineWidth:.04,outlineColor:"#000",children:[t,"'s World"]})}),(0,r.jsx)(G,{target:w,enabled:!c}),c&&(0,r.jsx)(u.z,{enablePan:!1,minDistance:8,maxDistance:25,maxPolarAngle:Math.PI/2.1}),c&&(0,r.jsxs)("mesh",{position:[0,1,0],rotation:[-Math.PI/2,0,0],onClick:e=>{let s=e.point;null==b||b(s.x,s.z)},children:[(0,r.jsx)("circleGeometry",{args:[6,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#4ade80",transparent:!0,opacity:.2})]})]})}function V(e){let{world:s,userName:t,placedItems:a=[],visitors:l=[],discoveredSecrets:c=[],inventoryItems:d=[],onItemPlace:x,onSecretDiscover:h,onOpenBrainstorm:m}=e,[p,u]=(0,o.useState)(!1),[j,g]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),[M,k]=(0,o.useState)(null),[D,S]=(0,o.useState)(!0),N=(0,o.useMemo)(()=>y(t),[t]);if((0,o.useEffect)(()=>{u(!0),w.init();let e=setTimeout(()=>S(!1),5e3);return()=>clearTimeout(e)},[]),(0,o.useEffect)(()=>{let e=e=>{("p"===e.key||"P"===e.key)&&(v(e=>!e),w.pop()),("b"===e.key||"B"===e.key)&&(null==m||m())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[m]),!p)return(0,r.jsx)("div",{className:"w-full aspect-video bg-gradient-to-b from-sky-800 to-slate-950 rounded-2xl flex items-center justify-center border border-slate-700",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-5xl mb-4 animate-bounce",children:"\uD83C\uDF0D"}),(0,r.jsx)("div",{className:"text-white font-semibold",children:"Building your world..."}),(0,r.jsx)("div",{className:"text-slate-400 text-sm mt-1",children:"✨ Unique to you!"})]})});let G=s||{trees:0,flowers:0,stones:0,crystals:0,tower:0,bridge:0,garden:0,lighthouse:0,help_given:0,help_received:0,phase1_progress:0,phase2_progress:0,phase3_progress:0,phase4_progress:0},L=a.length;return(0,r.jsxs)("div",{className:"w-full aspect-video bg-gradient-to-b from-sky-700 via-sky-900 to-slate-950 rounded-2xl overflow-hidden shadow-2xl border border-slate-700 relative group",children:[(0,r.jsx)(n.c,{map:b,children:(0,r.jsx)(i.Xz,{shadows:!0,camera:{position:[14,10,14],fov:45},gl:{antialias:!0,powerPreference:"default",preserveDrawingBuffer:!0},dpr:[1,1.5],onCreated:e=>{let{gl:s}=e,t=s.domElement;t.addEventListener("webglcontextlost",e=>{e.preventDefault(),console.log("[VoxelWorld] WebGL context lost, will restore on return")}),t.addEventListener("webglcontextrestored",()=>{console.log("[VoxelWorld] WebGL context restored")})},children:(0,r.jsx)(o.Suspense,{fallback:null,children:(0,r.jsx)(O,{world:G,userName:t,seed:N,placedItems:a,visitors:l,discoveredSecrets:c,placementMode:f,onItemPlace:(e,s)=>{M&&(null==x||x(M,e,s),w.place())},onSecretDiscover:h})})})}),(0,r.jsxs)("div",{className:"absolute top-3 left-3 right-3 flex justify-between items-start pointer-events-none",children:[(0,r.jsx)("div",{className:"bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 pointer-events-auto",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-white text-xs",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,r.jsxs)("span",{className:"font-medium",children:["Level ",Math.floor(L/5)+1]}),l.length>0&&(0,r.jsxs)("span",{className:"text-purple-400",children:["• ",l.length," visiting"]})]})}),(0,r.jsx)("div",{className:"bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 pointer-events-auto",children:(0,r.jsxs)("div",{className:"flex gap-3 text-white text-xs",children:[(0,r.jsxs)("span",{children:["\uD83C\uDF32 ",G.trees]}),(0,r.jsxs)("span",{children:["\uD83C\uDF38 ",G.flowers]}),(0,r.jsxs)("span",{children:["\uD83C\uDFDB️ ",G.tower]}),(0,r.jsxs)("span",{children:["\uD83C\uDF09 ",G.bridge]})]})})]}),f&&(0,r.jsxs)("div",{className:"absolute top-16 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur-sm rounded-xl px-4 py-3 border border-yellow-500/30",children:[(0,r.jsx)("div",{className:"text-yellow-400 text-xs font-bold mb-2 text-center",children:"\uD83D\uDD28 PLACEMENT MODE"}),(0,r.jsx)("div",{className:"flex gap-2",children:d.map(e=>(0,r.jsxs)("button",{onClick:()=>k(e.type===M?null:e.type),className:"\n                  px-3 py-2 rounded-lg text-sm transition-all\n                  ".concat(M===e.type?"bg-yellow-500 text-black":"bg-white/10 text-white hover:bg-white/20","\n                "),children:["tree"===e.type&&"\uD83C\uDF32","flower"===e.type&&"\uD83C\uDF38","tower"===e.type&&"\uD83C\uDFDB️","crystal"===e.type&&"\uD83D\uDC8E",(0,r.jsx)("span",{className:"ml-1 font-bold",children:e.count})]},e.type))}),(0,r.jsx)("div",{className:"text-[10px] text-gray-400 mt-2 text-center",children:"Click anywhere on island to place • Press P to exit"})]}),(0,r.jsxs)("div",{className:"absolute bottom-3 left-3 right-3 flex justify-between items-end",children:[(0,r.jsx)("div",{className:"\n          bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 text-xs text-white/80 \n          transition-opacity duration-500\n          ".concat(D||f?"opacity-100":"opacity-0 group-hover:opacity-100","\n        "),children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{children:"WASD Move"}),(0,r.jsx)("span",{children:"E Interact"}),(0,r.jsx)("span",{className:f?"text-yellow-400 font-bold":"",children:"P Place"}),(0,r.jsx)("span",{children:"B Brainstorm"})]})}),(0,r.jsx)("button",{onClick:()=>g(w.toggle()),className:"bg-black/70 backdrop-blur-sm rounded-lg px-3 py-2 text-xs text-white hover:bg-black/90 transition-colors",children:j?"\uD83D\uDD07":"\uD83D\uDD0A"})]}),c.length>0&&(0,r.jsxs)("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 bg-purple-900/80 backdrop-blur-sm rounded-lg px-3 py-1 text-xs text-purple-200",children:["\uD83D\uDD2E ",c.length," secret",c.length>1?"s":""," discovered"]})]})}}}]);