(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{6489:function(e,s,t){Promise.resolve().then(t.bind(t,168))},5722:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},6809:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9654:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]])},5748:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},3491:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},1072:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(7415).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},168:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ec}});var a=t(8357),i=t(921),l=t(7925),n=t(6829),c=t(1374),r=t(1808),d=t(5722),o=t(7502),x=t(3491),m=t(6682),u=t(7415);let h=(0,u.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var p=t(8267),f=t(8288),j=t(8235);let v=(0,u.Z)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]),b=(0,u.Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),g=(0,u.Z)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var N=t(340),y=t(7209),w=t(2412);let _=(0,u.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var k=t(8844),C=t(4020);let S=(0,u.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var z=t(8556),D=t(4525),Z=t(3836);let E=(0,u.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var M=t(6694);let I=(0,u.Z)("Keyboard",[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]]);var A=t(5748);let q=(0,u.Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var P=t(9654),T=t(1072);function L(e){let{classId:s,onSave:t}=e,[n,r]=(0,i.useState)({interaction_mode:"typing",ai_difficulty:"standard",ai_persona:"strategist",min_responses:5,streak_enabled:!0,dark_mode_default:!0}),[d,o]=(0,i.useState)(!1),[x,m]=(0,i.useState)(!1),u=(0,l.createClient)();(0,i.useEffect)(()=>{h()},[s]);let h=async()=>{let{data:e}=await u.from("classes").select("interaction_mode, ai_difficulty, ai_persona, min_responses, streak_enabled, dark_mode_default").eq("id",s).single();if(e){var t,a;r({interaction_mode:e.interaction_mode||"typing",ai_difficulty:e.ai_difficulty||"standard",ai_persona:e.ai_persona||"strategist",min_responses:e.min_responses||5,streak_enabled:null===(t=e.streak_enabled)||void 0===t||t,dark_mode_default:null===(a=e.dark_mode_default)||void 0===a||a})}},p=async()=>{o(!0);let{error:e}=await u.from("classes").update(n).eq("id",s);o(!1),e||(m(!0),setTimeout(()=>m(!1),2e3),null==t||t())},f=[{value:"typing",label:"Typing Only",icon:I,desc:"Students type responses"},{value:"voice",label:"Voice Only",icon:A.Z,desc:"Students speak responses"},{value:"both",label:"Both Options",icon:C.Z,desc:"Students choose method"}];return(0,a.jsxs)("div",{className:"space-y-8 p-6 bg-surface-800 rounded-2xl",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2",children:[(0,a.jsx)(q,{className:"w-5 h-5 text-primary-500"}),"Class AI Settings"]}),(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200",children:"Student Input Method"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:f.map(e=>(0,a.jsxs)("button",{onClick:()=>r(s=>({...s,interaction_mode:e.value})),className:"p-4 rounded-xl border-2 transition-all ".concat(n.interaction_mode===e.value?"border-primary-500 bg-primary-500/10":"border-surface-600 hover:border-surface-500"),children:[(0,a.jsx)(e.icon,{className:"w-6 h-6 mx-auto mb-2 ".concat(n.interaction_mode===e.value?"text-primary-500":"text-surface-400")}),(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-surface-400 mt-1",children:e.desc})]},e.value))})]}),(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200",children:"AI Pushback Level"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[{value:"gentle",label:"Gentle",desc:"Encouraging, accepts shorter responses",color:"bg-green-500"},{value:"standard",label:"Standard",desc:"Pushback on surface answers",color:"bg-yellow-500"},{value:"intense",label:"Intense",desc:"Relentlessly Socratic",color:"bg-red-500"}].map(e=>(0,a.jsxs)("button",{onClick:()=>r(s=>({...s,ai_difficulty:e.value})),className:"p-4 rounded-xl border-2 transition-all ".concat(n.ai_difficulty===e.value?"border-primary-500 bg-primary-500/10":"border-surface-600 hover:border-surface-500"),children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.color," mx-auto mb-2")}),(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-surface-400 mt-1",children:e.desc})]},e.value))})]}),(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200",children:"AI Personality"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:[{value:"hype_man",label:"The Hype Man",emoji:"\uD83D\uDD25",desc:"Supportive & energetic"},{value:"strategist",label:"The Strategist",emoji:"\uD83C\uDFAF",desc:"Direct & logical"},{value:"sage",label:"The Sage",emoji:"\uD83E\uDDD8",desc:"Philosophical & calm"}].map(e=>(0,a.jsxs)("button",{onClick:()=>r(s=>({...s,ai_persona:e.value})),className:"p-4 rounded-xl border-2 transition-all ".concat(n.ai_persona===e.value?"border-primary-500 bg-primary-500/10":"border-surface-600 hover:border-surface-500"),children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:e.emoji}),(0,a.jsx)("div",{className:"font-medium",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-surface-400 mt-1",children:e.desc})]},e.value))})]}),(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200",children:"Minimum Exchanges Required"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"range",min:3,max:10,value:n.min_responses,onChange:e=>r(s=>({...s,min_responses:parseInt(e.target.value)})),className:"flex-1"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-primary-500 w-12 text-center",children:n.min_responses})]}),(0,a.jsx)("p",{className:"text-sm text-surface-400",children:"Students must complete at least this many exchanges before unlocking rewards"})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-surface-700 rounded-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(P.Z,{className:"w-5 h-5 text-orange-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Streak System"}),(0,a.jsx)("div",{className:"text-sm text-surface-400",children:"Track daily engagement streaks"})]})]}),(0,a.jsx)("button",{onClick:()=>r(e=>({...e,streak_enabled:!e.streak_enabled})),className:"w-12 h-6 rounded-full transition-colors ".concat(n.streak_enabled?"bg-primary-500":"bg-surface-600"),children:(0,a.jsx)("div",{className:"w-5 h-5 bg-white rounded-full transition-transform ".concat(n.streak_enabled?"translate-x-6":"translate-x-0.5")})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-surface-700 rounded-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(z.Z,{className:"w-5 h-5 text-purple-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Dark Mode Default"}),(0,a.jsx)("div",{className:"text-sm text-surface-400",children:"Students start in dark mode"})]})]}),(0,a.jsx)("button",{onClick:()=>r(e=>({...e,dark_mode_default:!e.dark_mode_default})),className:"w-12 h-6 rounded-full transition-colors ".concat(n.dark_mode_default?"bg-primary-500":"bg-surface-600"),children:(0,a.jsx)("div",{className:"w-5 h-5 bg-white rounded-full transition-transform ".concat(n.dark_mode_default?"translate-x-6":"translate-x-0.5")})})]})]}),(0,a.jsxs)(c.E.button,{onClick:p,disabled:d,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full py-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-colors ".concat(x?"bg-green-500 text-white":"bg-primary-600 hover:bg-primary-500 text-white"),children:[(0,a.jsx)(T.Z,{className:"w-5 h-5"}),d?"Saving...":x?"Settings Saved!":"Save Settings"]})]})}var R=t(7285);function B(e){let{classId:s}=e,[t,l]=(0,i.useState)(null),[n,c]=(0,i.useState)("overview"),r=(0,R.createClientComponentClient)();return((0,i.useEffect)(()=>{(async()=>{let{data:e}=await r.from("users").select("id, name, student_cores!inner(battery_level, current_streak, updated_at)").eq("class_id",s).eq("role","student"),{data:t}=await r.from("class_nexus").select("integrity_score").eq("class_id",s).single();if(e){let s=e.map(e=>{var s;return(null===(s=e.student_cores)||void 0===s?void 0:s.battery_level)||0}),a=e.map(e=>{var s;return(null===(s=e.student_cores)||void 0===s?void 0:s.current_streak)||0}),i=new Date().toDateString(),n=[...e].sort((e,s)=>{var t,a;return((null===(t=s.student_cores)||void 0===t?void 0:t.battery_level)||0)-((null===(a=e.student_cores)||void 0===a?void 0:a.battery_level)||0)});l({totalStudents:e.length,activeToday:e.filter(e=>{var s;return new Date(null===(s=e.student_cores)||void 0===s?void 0:s.updated_at).toDateString()===i}).length,avgBattery:s.length?Math.round(s.reduce((e,s)=>e+s,0)/s.length):0,nexusIntegrity:(null==t?void 0:t.integrity_score)||100,studentsInCrisis:s.filter(e=>e<20).length,avgStreak:a.length?Math.round(a.reduce((e,s)=>e+s,0)/a.length):0,topPerformers:n.slice(0,3).map(e=>{var s;return{name:e.name,battery:(null===(s=e.student_cores)||void 0===s?void 0:s.battery_level)||0}}),needsSupport:n.slice(-3).reverse().map(e=>{var s,t;return{name:e.name,battery:(null===(s=e.student_cores)||void 0===s?void 0:s.battery_level)||0,lastActive:new Date(null===(t=e.student_cores)||void 0===t?void 0:t.updated_at).toLocaleDateString()}})})}})()},[s,r]),t)?(0,a.jsxs)("div",{className:"bg-zinc-900 rounded-2xl p-6 border border-zinc-800",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Class Analytics"}),(0,a.jsx)("div",{className:"flex gap-2",children:["overview","students","trends"].map(e=>(0,a.jsx)("button",{onClick:()=>c(e),className:"px-3 py-1 rounded-lg text-sm capitalize ".concat(n===e?"bg-blue-500 text-white":"bg-zinc-800 text-zinc-400"),children:e},e))})]}),"overview"===n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsx)(H,{label:"Students",value:t.totalStudents,icon:"\uD83D\uDC65"}),(0,a.jsx)(H,{label:"Active Today",value:t.activeToday,icon:"✅",color:"green"}),(0,a.jsx)(H,{label:"Avg Battery",value:"".concat(t.avgBattery,"%"),icon:"\uD83D\uDD0B",color:t.avgBattery>50?"green":"yellow"}),(0,a.jsx)(H,{label:"Nexus Health",value:"".concat(t.nexusIntegrity,"%"),icon:"\uD83C\uDF10",color:t.nexusIntegrity>70?"green":"red"})]}),t.studentsInCrisis>0&&(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-6",children:(0,a.jsxs)("p",{className:"text-red-400 font-medium",children:["⚠️ ",t.studentsInCrisis," student(s) below 20% - may need support"]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-zinc-800/50 rounded-xl p-4",children:[(0,a.jsx)("h3",{className:"text-zinc-400 text-sm mb-3",children:"\uD83C\uDF1F Top Performers"}),t.topPerformers.map((e,s)=>(0,a.jsxs)("div",{className:"flex justify-between py-2 border-b border-zinc-700 last:border-0",children:[(0,a.jsx)("span",{className:"text-white",children:e.name}),(0,a.jsxs)("span",{className:"text-green-400",children:[e.battery,"%"]})]},s))]}),(0,a.jsxs)("div",{className:"bg-zinc-800/50 rounded-xl p-4",children:[(0,a.jsx)("h3",{className:"text-zinc-400 text-sm mb-3",children:"\uD83D\uDCAC May Need Support"}),t.needsSupport.map((e,s)=>(0,a.jsxs)("div",{className:"flex justify-between py-2 border-b border-zinc-700 last:border-0",children:[(0,a.jsx)("span",{className:"text-white",children:e.name}),(0,a.jsxs)("span",{className:"text-red-400",children:[e.battery,"%"]})]},s))]})]})]}),"students"===n&&(0,a.jsx)("p",{className:"text-zinc-500 text-center py-8",children:"Detailed student list view coming soon"}),"trends"===n&&(0,a.jsx)("p",{className:"text-zinc-500 text-center py-8",children:"Weekly trends visualization coming soon"})]}):(0,a.jsx)("div",{className:"animate-pulse bg-zinc-800 h-96 rounded-2xl"})}function H(e){let{label:s,value:t,icon:i,color:l="blue"}=e;return(0,a.jsxs)("div",{className:"rounded-xl p-4 border ".concat({blue:"bg-blue-500/10 border-blue-500/30",green:"bg-green-500/10 border-green-500/30",yellow:"bg-yellow-500/10 border-yellow-500/30",red:"bg-red-500/10 border-red-500/30"}[l]),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{children:i}),(0,a.jsx)("span",{className:"text-zinc-400 text-sm",children:s})]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-white",children:t})]})}var W=t(732),O=t(5543);let V=(0,u.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function F(e){let{classId:s,teacherId:t}=e,[n,d]=(0,i.useState)([]),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!0),[p,f]=(0,i.useState)(!1),[j,v]=(0,i.useState)(""),[b,g]=(0,i.useState)(""),[N,w]=(0,i.useState)("normal"),[_,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)(""),z=(0,l.createClient)();(0,i.useEffect)(()=>{D()},[s]);let D=async()=>{h(!0);let{data:e}=await z.from("announcements").select("*").eq("class_id",s).order("is_pinned",{ascending:!1}).order("created_at",{ascending:!1});d(e||[]),h(!1)},E=async()=>{j.trim()&&b.trim()&&(f(!0),await z.from("announcements").insert({class_id:s,teacher_id:t,title:j.trim(),content:b.trim(),priority:N,is_pinned:_,expires_at:C||null}),await z.from("student_activity_log").insert({class_id:s,activity_type:"announcement_created",activity_data:{title:j,priority:N}}),v(""),g(""),w("normal"),k(!1),S(""),m(!1),f(!1),D())},M=async e=>{await z.from("announcements").delete().eq("id",e),d(s=>s.filter(s=>s.id!==e))},I=async(e,s)=>{await z.from("announcements").update({is_pinned:!s}).eq("id",e),D()},A={normal:"bg-surface-800 border-surface-700",important:"bg-amber-900/20 border-amber-500/30",urgent:"bg-red-900/20 border-red-500/30"},q={normal:"badge bg-surface-700 text-surface-300",important:"badge bg-amber-500/20 text-amber-400",urgent:"badge bg-red-500/20 text-red-400"};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100 flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"text-primary-400",size:24}),"Announcements"]}),(0,a.jsxs)("button",{onClick:()=>m(!x),className:"btn btn-primary",children:[(0,a.jsx)(W.Z,{size:18})," New Announcement"]})]}),(0,a.jsx)(r.M,{children:x&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:"Create Announcement"}),(0,a.jsx)("button",{onClick:()=>m(!1),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Title"}),(0,a.jsx)("input",{type:"text",className:"input",placeholder:"Announcement title...",value:j,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Content"}),(0,a.jsx)("textarea",{className:"input",rows:4,placeholder:"Write your announcement...",value:b,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Priority"}),(0,a.jsxs)("select",{className:"input",value:N,onChange:e=>w(e.target.value),children:[(0,a.jsx)("option",{value:"normal",children:"Normal"}),(0,a.jsx)("option",{value:"important",children:"Important"}),(0,a.jsx)("option",{value:"urgent",children:"Urgent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Expires At (optional)"}),(0,a.jsx)("input",{type:"datetime-local",className:"input",value:C,onChange:e=>S(e.target.value)})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:_,onChange:e=>k(e.target.checked),className:"w-5 h-5 rounded"}),(0,a.jsx)("span",{className:"text-surface-200",children:"Pin to top"})]})})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:E,disabled:p||!j.trim()||!b.trim(),className:"btn btn-primary flex-1",children:p?"Creating...":"Create Announcement"})]})]})]})}),u?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===n.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(y.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No announcements"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Create your first announcement to notify students."})]}):(0,a.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,a.jsx)("div",{className:"card p-4 border ".concat(A[e.priority]),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.is_pinned&&(0,a.jsx)(O.Z,{size:14,className:"text-primary-400"}),"urgent"===e.priority&&(0,a.jsx)(o.Z,{size:14,className:"text-red-400"}),(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:e.title}),(0,a.jsx)("span",{className:q[e.priority],children:e.priority})]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:e.content}),(0,a.jsxs)("p",{className:"text-surface-600 text-xs mt-2",children:[new Date(e.created_at).toLocaleString(),e.expires_at&&" | Expires: ".concat(new Date(e.expires_at).toLocaleString())]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>I(e.id,e.is_pinned),className:"p-2 rounded-lg transition-colors ".concat(e.is_pinned?"bg-primary-500/20 text-primary-400":"text-surface-500 hover:text-surface-300 hover:bg-surface-800"),children:(0,a.jsx)(O.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>M(e.id),className:"p-2 text-surface-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:(0,a.jsx)(V,{size:16})})]})]})},e.id))})]})}var U=t(8163),J=t(1375);let X=(0,u.Z)("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),K=(0,u.Z)("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);var Y=t(2922),G=t(8633);function Q(e){let{classId:s,teacherId:t,studentCount:n}=e,[d,o]=(0,i.useState)([]),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!0),[f,v]=(0,i.useState)(!1),[b,g]=(0,i.useState)(""),[N,y]=(0,i.useState)(""),[_,k]=(0,i.useState)("individual"),[C,S]=(0,i.useState)(50),[z,D]=(0,i.useState)(10),[E,M]=(0,i.useState)(""),I=(0,l.createClient)();(0,i.useEffect)(()=>{A()},[s]);let A=async()=>{h(!0);let{data:e}=await I.from("missions").select("*").eq("class_id",s).order("created_at",{ascending:!1}),{data:t}=await I.from("mission_completions").select("mission_id").in("mission_id",(null==e?void 0:e.map(e=>e.id))||[]),a={};null==t||t.forEach(e=>{a[e.mission_id]=(a[e.mission_id]||0)+1}),o((e||[]).map(e=>({...e,completion_count:a[e.id]||0}))),h(!1)},q=async()=>{b.trim()&&N.trim()&&(v(!0),await I.from("missions").insert({class_id:s,teacher_id:t,title:b.trim(),description:N.trim(),mission_type:_,xp_reward:C,battery_reward:z,deadline:E||null,is_active:!0}),await I.from("student_activity_log").insert({class_id:s,activity_type:"mission_created",activity_data:{title:b,mission_type:_}}),g(""),y(""),k("individual"),S(50),D(10),M(""),m(!1),v(!1),A())},P=async(e,s)=>{await I.from("missions").update({is_active:!s}).eq("id",e),A()},T=async e=>{await I.from("missions").delete().eq("id",e),o(s=>s.filter(s=>s.id!==e))},L={individual:U.Z,team:p.Z,class:J.Z};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100 flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"text-teal-400",size:24}),"Missions"]}),(0,a.jsxs)("button",{onClick:()=>m(!x),className:"btn btn-primary",children:[(0,a.jsx)(W.Z,{size:18})," New Mission"]})]}),(0,a.jsx)(r.M,{children:x&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:"Create Mission"}),(0,a.jsx)("button",{onClick:()=>m(!1),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Mission Title"}),(0,a.jsx)("input",{type:"text",className:"input",placeholder:"e.g., Help 3 classmates today",value:b,onChange:e=>g(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Description"}),(0,a.jsx)("textarea",{className:"input",rows:3,placeholder:"Describe what students need to do...",value:N,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Type"}),(0,a.jsxs)("select",{className:"input",value:_,onChange:e=>k(e.target.value),children:[(0,a.jsx)("option",{value:"individual",children:"Individual"}),(0,a.jsx)("option",{value:"team",children:"Team"}),(0,a.jsx)("option",{value:"class",children:"Class"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"XP Reward"}),(0,a.jsx)("input",{type:"number",className:"input",value:C,onChange:e=>S(parseInt(e.target.value)||0),min:0,max:500})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Battery Reward"}),(0,a.jsx)("input",{type:"number",className:"input",value:z,onChange:e=>D(parseInt(e.target.value)||0),min:0,max:50})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Deadline (optional)"}),(0,a.jsx)("input",{type:"datetime-local",className:"input",value:E,onChange:e=>M(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:q,disabled:f||!b.trim()||!N.trim(),className:"btn btn-primary flex-1",children:f?"Creating...":"Create Mission"})]})]})]})}),u?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===d.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(w.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No missions"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Create missions to motivate and challenge your students."})]}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:d.map(e=>{let s=L[e.mission_type],t=n>0?Math.round((e.completion_count||0)/n*100):0;return(0,a.jsxs)("div",{className:"card p-4 ".concat(e.is_active?"":"opacity-50"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat("individual"===e.mission_type?"bg-blue-500/20 text-blue-400":"team"===e.mission_type?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"),children:(0,a.jsx)(s,{size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:e.title}),(0,a.jsx)("span",{className:"text-xs text-surface-500 capitalize",children:e.mission_type})]})]}),(0,a.jsx)("button",{onClick:()=>P(e.id,e.is_active),className:"p-2 rounded-lg transition-colors ".concat(e.is_active?"text-green-400":"text-surface-500"),children:e.is_active?(0,a.jsx)(X,{size:24}):(0,a.jsx)(K,{size:24})})]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mb-3",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-yellow-400",children:[(0,a.jsx)(j.Z,{size:14}),(0,a.jsxs)("span",{children:[e.xp_reward," XP"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-teal-400",children:[(0,a.jsx)(Y.Z,{size:14}),(0,a.jsxs)("span",{children:["+",e.battery_reward,"%"]})]}),e.deadline&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-surface-500",children:[(0,a.jsx)(G.Z,{size:14}),(0,a.jsx)("span",{children:new Date(e.deadline).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 mr-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-surface-500 mb-1",children:[(0,a.jsx)("span",{children:"Completions"}),(0,a.jsxs)("span",{children:[e.completion_count||0,"/",n]})]}),(0,a.jsx)("div",{className:"progress-bar",children:(0,a.jsx)("div",{className:"progress-fill bg-teal-500",style:{width:"".concat(t,"%")}})})]}),(0,a.jsx)("button",{onClick:()=>T(e.id),className:"text-surface-500 hover:text-red-400 text-xs",children:"Delete"})]})]},e.id)})})]})}var $=t(3974),ee=t(6809);function es(e){let{classId:s,teacherId:t,studentCount:n}=e,[d,o]=(0,i.useState)([]),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!0),[p,j]=(0,i.useState)(!1),[v,b]=(0,i.useState)(null),[g,N]=(0,i.useState)(""),[y,w]=(0,i.useState)("video"),[_,k]=(0,i.useState)(""),[S,z]=(0,i.useState)(""),[D,E]=(0,i.useState)(""),[M,I]=(0,i.useState)(""),A=(0,l.createClient)();(0,i.useEffect)(()=>{q()},[s]);let q=async()=>{h(!0);let{data:e}=await A.from("media_lessons").select("*").eq("class_id",s).order("created_at",{ascending:!1}),{data:t}=await A.from("media_lesson_completions").select("media_lesson_id, watched_video, read_content, socratic_completed").in("media_lesson_id",(null==e?void 0:e.map(e=>e.id))||[]),a={};null==t||t.forEach(e=>{a[e.media_lesson_id]||(a[e.media_lesson_id]={watched:0,read:0,discussed:0}),e.watched_video&&a[e.media_lesson_id].watched++,e.read_content&&a[e.media_lesson_id].read++,e.socratic_completed&&a[e.media_lesson_id].discussed++}),o((e||[]).map(e=>({...e,completion_stats:a[e.id]||{watched:0,read:0,discussed:0}}))),h(!1)},P=async()=>{g.trim()&&("video"!==y||_.trim())&&("reading"!==y||S.trim())&&("both"!==y||_.trim()&&S.trim())&&(j(!0),await A.from("media_lessons").insert({class_id:s,teacher_id:t,title:g.trim(),media_type:y,video_url:_.trim()||null,reading_content:S.trim()||null,socratic_prompt:D.trim()||null,due_date:M||null,is_active:!0}),await A.from("student_activity_log").insert({class_id:s,activity_type:"media_lesson_created",activity_data:{title:g,media_type:y}}),N(""),w("video"),k(""),z(""),E(""),I(""),m(!1),j(!1),q())},T=async(e,s)=>{await A.from("media_lessons").update({is_active:!s}).eq("id",e),q()},L=async e=>{await A.from("media_lessons").delete().eq("id",e),o(s=>s.filter(s=>s.id!==e))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100 flex items-center gap-2",children:[(0,a.jsx)($.Z,{className:"text-purple-400",size:24}),"Media Lessons"]}),(0,a.jsxs)("button",{onClick:()=>m(!x),className:"btn btn-primary",children:[(0,a.jsx)(W.Z,{size:18})," New Media Lesson"]})]}),(0,a.jsx)(r.M,{children:x&&(0,a.jsxs)(c.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:"Create Media Lesson"}),(0,a.jsx)("button",{onClick:()=>m(!1),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Title"}),(0,a.jsx)("input",{type:"text",className:"input",placeholder:"Lesson title...",value:g,onChange:e=>N(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Media Type"}),(0,a.jsxs)("select",{className:"input",value:y,onChange:e=>w(e.target.value),children:[(0,a.jsx)("option",{value:"video",children:"Video Only"}),(0,a.jsx)("option",{value:"reading",children:"Reading Only"}),(0,a.jsx)("option",{value:"both",children:"Video + Reading"})]})]})]}),("video"===y||"both"===y)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Video URL (YouTube/Vimeo)"}),(0,a.jsx)("input",{type:"url",className:"input",placeholder:"https://youtube.com/watch?v=...",value:_,onChange:e=>k(e.target.value)})]}),("reading"===y||"both"===y)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Reading Content"}),(0,a.jsx)("textarea",{className:"input",rows:6,placeholder:"Enter reading material...",value:S,onChange:e=>z(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Socratic Prompt (for AI discussion after consuming media)"}),(0,a.jsx)("textarea",{className:"input",rows:3,placeholder:"What questions should the AI guide students through after they finish? e.g., 'Help students reflect on how the concepts in this video apply to their leadership journey...'",value:D,onChange:e=>E(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Due Date (optional)"}),(0,a.jsx)("input",{type:"datetime-local",className:"input w-auto",value:M,onChange:e=>I(e.target.value)})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>m(!1),className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:P,disabled:p||!g.trim(),className:"btn btn-primary flex-1",children:p?"Creating...":"Create Lesson"})]})]})]})}),u?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===d.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)($.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No media lessons"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Create video or reading lessons with AI-powered discussions."})]}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:d.map(e=>{var s,t,i;return(0,a.jsxs)("div",{className:"card p-4 ".concat(e.is_active?"":"opacity-50"),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat("video"===e.media_type?"bg-red-500/20 text-red-400":"reading"===e.media_type?"bg-blue-500/20 text-blue-400":"bg-purple-500/20 text-purple-400"),children:"video"===e.media_type?(0,a.jsx)($.Z,{size:20}):"reading"===e.media_type?(0,a.jsx)(f.Z,{size:20}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.Z,{size:14}),(0,a.jsx)(f.Z,{size:14})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:e.title}),(0,a.jsx)("span",{className:"text-xs text-surface-500 capitalize",children:e.media_type})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:()=>b(e),className:"p-2 text-surface-500 hover:text-surface-300 rounded-lg transition-colors",children:(0,a.jsx)(ee.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>T(e.id,e.is_active),className:"p-2 rounded-lg transition-colors ".concat(e.is_active?"text-green-400":"text-surface-500"),children:e.is_active?(0,a.jsx)(X,{size:24}):(0,a.jsx)(K,{size:24})})]})]}),e.socratic_prompt&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-purple-400 mb-3",children:[(0,a.jsx)(C.Z,{size:14}),(0,a.jsx)("span",{children:"AI Discussion Enabled"})]}),e.due_date&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-surface-500 mb-3",children:[(0,a.jsx)(G.Z,{size:14}),(0,a.jsxs)("span",{children:["Due: ",new Date(e.due_date).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center text-xs mb-3",children:[("video"===e.media_type||"both"===e.media_type)&&(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-red-400",children:(null===(s=e.completion_stats)||void 0===s?void 0:s.watched)||0}),(0,a.jsx)("div",{className:"text-surface-500",children:"Watched"})]}),("reading"===e.media_type||"both"===e.media_type)&&(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-blue-400",children:(null===(t=e.completion_stats)||void 0===t?void 0:t.read)||0}),(0,a.jsx)("div",{className:"text-surface-500",children:"Read"})]}),(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("div",{className:"text-lg font-bold text-purple-400",children:(null===(i=e.completion_stats)||void 0===i?void 0:i.discussed)||0}),(0,a.jsx)("div",{className:"text-surface-500",children:"Discussed"})]})]}),(0,a.jsx)("button",{onClick:()=>L(e.id),className:"text-surface-500 hover:text-red-400 text-xs",children:"Delete"})]},e.id)})}),(0,a.jsx)(r.M,{children:v&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>b(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between sticky top-0 bg-surface-900",children:[(0,a.jsx)("h2",{className:"font-semibold text-surface-100",children:v.title}),(0,a.jsx)("button",{onClick:()=>b(null),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[v.video_url&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 mb-2 flex items-center gap-2",children:[(0,a.jsx)($.Z,{size:16,className:"text-red-400"})," Video"]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm break-all",children:v.video_url})]}),v.reading_content&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 mb-2 flex items-center gap-2",children:[(0,a.jsx)(f.Z,{size:16,className:"text-blue-400"})," Reading Content"]}),(0,a.jsx)("div",{className:"p-4 bg-surface-800 rounded-lg text-surface-300 text-sm whitespace-pre-wrap max-h-60 overflow-y-auto",children:v.reading_content})]}),v.socratic_prompt&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 mb-2 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{size:16,className:"text-purple-400"})," Socratic Prompt"]}),(0,a.jsx)("div",{className:"p-4 bg-purple-500/10 border border-purple-500/20 rounded-lg text-surface-300 text-sm",children:v.socratic_prompt})]})]})]})})})]})}let et=(0,u.Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ea=(0,u.Z)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);function ei(e){let{classId:s}=e,[t,n]=(0,i.useState)([]),[d,o]=(0,i.useState)(""),[m,u]=(0,i.useState)(!0),[h,f]=(0,i.useState)(!1),[j,v]=(0,i.useState)(""),[b,g]=(0,i.useState)(!1),[N,y]=(0,i.useState)([]),[w,_]=(0,i.useState)(null),[k,C]=(0,i.useState)(null),S=(0,l.createClient)();(0,i.useEffect)(()=>{z()},[s]);let z=async()=>{u(!0);let{data:e}=await S.from("users").select("id, name, pin_hash, created_at").eq("class_id",s).eq("role","student").order("name"),{data:t}=await S.from("student_cores").select("student_id, battery_level, streak_count, last_active").in("student_id",(null==e?void 0:e.map(e=>e.id))||[]),a={};null==t||t.forEach(e=>{a[e.student_id]=e}),n((e||[]).map(e=>{var s,t,i;return{...e,battery_level:(null===(s=a[e.id])||void 0===s?void 0:s.battery_level)||0,streak:(null===(t=a[e.id])||void 0===t?void 0:t.streak_count)||0,last_active:null===(i=a[e.id])||void 0===i?void 0:i.last_active}})),u(!1)},M=()=>Math.floor(1e3+9e3*Math.random()).toString(),I=async e=>{let s=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",s))).map(e=>e.toString(16).padStart(2,"0")).join("")},A=async()=>{let e=j.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length)return;g(!0);let t=[];for(let a of e){let e=M(),i=await I(e);await S.from("users").insert({name:a,class_id:s,role:"student",pin_hash:i}),t.push({name:a,pin:e})}y(t),g(!1),v(""),z()},q=async e=>{_(e);let s=M(),t=await I(s);await S.from("users").update({pin_hash:t}).eq("id",e),C(s),_(null),z()},T=async(e,s)=>{confirm("Are you sure you want to remove ".concat(s," from the class?"))&&(await S.from("users").delete().eq("id",e),n(s=>s.filter(s=>s.id!==e)))},L=t.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),R=e=>{if(!e)return"Never";let s=Math.floor((Date.now()-new Date(e).getTime())/6e4);if(s<60)return"".concat(s,"m ago");let t=Math.floor(s/60);return t<24?"".concat(t,"h ago"):"".concat(Math.floor(t/24),"d ago")};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100 flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"text-blue-400",size:24}),"Student Roster (",t.length,")"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:z,className:"btn btn-secondary",children:(0,a.jsx)(x.Z,{size:16})}),(0,a.jsxs)("button",{onClick:()=>f(!0),className:"btn btn-primary",children:[(0,a.jsx)(et,{size:18})," Bulk Add"]})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-surface-500",size:18}),(0,a.jsx)("input",{type:"text",placeholder:"Search students...",className:"input pl-10 w-full md:w-64",value:d,onChange:e=>o(e.target.value)})]}),m?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===L.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(p.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No students found"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Add students using the Bulk Add button above."})]}):(0,a.jsx)("div",{className:"card overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full min-w-[700px]",children:[(0,a.jsx)("thead",{className:"bg-surface-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left px-4 py-3 text-surface-400 font-medium text-sm",children:"Student"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Battery"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Streak"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Last Active"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:L.map(e=>{var s;return(0,a.jsxs)("tr",{className:"border-t border-surface-800 hover:bg-surface-800/50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center text-white font-bold",children:null===(s=e.name[0])||void 0===s?void 0:s.toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-surface-200 font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-surface-500",children:["Joined ",new Date(e.created_at).toLocaleDateString()]})]})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,a.jsx)(Y.Z,{size:16,className:e.battery_level>50?"text-green-400":e.battery_level>20?"text-yellow-400":"text-red-400"}),(0,a.jsxs)("span",{className:"text-surface-200",children:[e.battery_level||0,"%"]})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,a.jsx)(P.Z,{size:16,className:"text-orange-400"}),(0,a.jsx)("span",{className:"text-surface-200",children:e.streak||0})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 text-surface-400",children:[(0,a.jsx)(D.Z,{size:14}),(0,a.jsx)("span",{className:"text-sm",children:R(e.last_active)})]})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>q(e.id),disabled:w===e.id,className:"p-2 text-surface-500 hover:text-yellow-400 hover:bg-yellow-500/10 rounded-lg transition-colors",title:"Reset PIN",children:(0,a.jsx)(ea,{size:16})}),(0,a.jsx)("button",{onClick:()=>T(e.id,e.name),className:"p-2 text-surface-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"Remove Student",children:(0,a.jsx)(V,{size:16})})]})})]},e.id)})})]})}),(0,a.jsx)(r.M,{children:k&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>C(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl p-6 max-w-sm text-center",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(ea,{size:48,className:"mx-auto mb-4 text-yellow-400"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-surface-100 mb-2",children:"New PIN Generated"}),(0,a.jsx)("p",{className:"text-surface-400 mb-4",children:"Share this PIN with the student:"}),(0,a.jsx)("div",{className:"text-4xl font-mono font-bold text-primary-400 bg-surface-800 rounded-xl py-4 mb-4",children:k}),(0,a.jsx)("button",{onClick:()=>C(null),className:"btn btn-primary w-full",children:"Done"})]})})}),(0,a.jsx)(r.M,{children:h&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>{f(!1),y([])},children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between sticky top-0 bg-surface-900",children:[(0,a.jsx)("h2",{className:"font-semibold text-surface-100",children:"Bulk Add Students"}),(0,a.jsx)("button",{onClick:()=>{f(!1),y([])},className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsx)("div",{className:"p-6 space-y-4",children:0===N.length?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Enter one student name per line. PINs will be auto-generated."}),(0,a.jsx)("textarea",{className:"input",rows:8,placeholder:"John Smith Jane Doe Alex Johnson",value:j,onChange:e=>v(e.target.value)}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>f(!1),className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:A,disabled:b||!j.trim(),className:"btn btn-primary flex-1",children:b?"Adding...":"Add Students"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-lg",children:[(0,a.jsx)("p",{className:"text-green-400 font-semibold",children:"Students Added Successfully!"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mt-1",children:"Save these PINs - they cannot be recovered later."})]}),(0,a.jsx)("div",{className:"space-y-2",children:N.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-surface-800 rounded-lg",children:[(0,a.jsx)("span",{className:"text-surface-200",children:e.name}),(0,a.jsx)("span",{className:"font-mono text-primary-400 font-bold",children:e.pin})]},s))}),(0,a.jsx)("button",{onClick:()=>{f(!1),y([])},className:"btn btn-primary w-full",children:"Done"})]})})]})})})]})}let el={do_now_started:{icon:t(5088).Z,color:"text-blue-400",label:()=>"started Do Now"},do_now_complete:{icon:C.Z,color:"text-green-400",label:()=>"completed Do Now"},mission_completed:{icon:w.Z,color:"text-teal-400",label:e=>'completed mission "'.concat((null==e?void 0:e.title)||"Unknown",'"')},media_lesson_started:{icon:$.Z,color:"text-red-400",label:e=>'started media lesson "'.concat((null==e?void 0:e.title)||"Unknown",'"')},media_lesson_complete:{icon:M.Z,color:"text-green-400",label:e=>'finished media lesson "'.concat((null==e?void 0:e.title)||"Unknown",'"')},socratic_complete:{icon:C.Z,color:"text-purple-400",label:()=>"completed Socratic discussion"},battery_update:{icon:Y.Z,color:"text-yellow-400",label:e=>"battery at ".concat((null==e?void 0:e.level)||0,"%")},scenario_complete:{icon:j.Z,color:"text-orange-400",label:()=>"completed Scenario"},challenge_submitted:{icon:w.Z,color:"text-pink-400",label:()=>"submitted Real-World Challenge"},announcement_created:{icon:y.Z,color:"text-primary-400",label:e=>'New announcement: "'.concat((null==e?void 0:e.title)||"Unknown",'"')},mission_created:{icon:w.Z,color:"text-teal-400",label:e=>'New mission created: "'.concat((null==e?void 0:e.title)||"Unknown",'"')},media_lesson_created:{icon:$.Z,color:"text-purple-400",label:e=>'New media lesson: "'.concat((null==e?void 0:e.title)||"Unknown",'"')}};function en(e){let{classId:s,students:t}=e,[n,d]=(0,i.useState)([]),[o,m]=(0,i.useState)(!0),[u,h]=(0,i.useState)(!0),[p,f]=(0,i.useState)(new Date),j=(0,l.createClient)(),v=(0,i.useCallback)(async()=>{let{data:e}=await j.from("student_activity_log").select("*").eq("class_id",s).order("created_at",{ascending:!1}).limit(50),a=new Map(t.map(e=>[e.id,e.name]));d((e||[]).map(e=>({...e,student_name:a.get(e.student_id)||"System"}))),f(new Date),m(!1)},[s,t,j]);(0,i.useEffect)(()=>{v()},[v]),(0,i.useEffect)(()=>{if(!u)return;let e=setInterval(v,3e4);return()=>clearInterval(e)},[u,v]);let b=e=>{let s=Math.floor((Date.now()-new Date(e).getTime())/1e3);if(s<60)return"just now";let t=Math.floor(s/60);if(t<60)return"".concat(t,"m ago");let a=Math.floor(t/60);return a<24?"".concat(a,"h ago"):"".concat(Math.floor(a/24),"d ago")};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100 flex items-center gap-2",children:[(0,a.jsx)(g,{className:"text-green-400",size:24}),"Live Activity Feed"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-surface-400 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:u,onChange:e=>h(e.target.checked),className:"w-4 h-4 rounded"}),"Auto-refresh (30s)"]}),(0,a.jsxs)("button",{onClick:v,className:"btn btn-secondary btn-sm",children:[(0,a.jsx)(x.Z,{size:16})," Refresh"]})]})]}),(0,a.jsxs)("div",{className:"text-xs text-surface-500 flex items-center gap-2",children:[(0,a.jsx)(D.Z,{size:12}),"Last updated: ",p.toLocaleTimeString()]}),o?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===n.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(g,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No activity yet"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Student activity will appear here in real-time."})]}):(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)(r.M,{children:n.map((e,s)=>{let t=el[e.activity_type]||{icon:g,color:"text-surface-400",label:()=>e.activity_type},i=t.icon;return(0,a.jsxs)(c.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.02*s},className:"card p-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat(t.color.replace("text-","bg-").replace("-400","-500/20")),children:(0,a.jsx)(i,{size:16,className:t.color})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("p",{className:"text-surface-200 text-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.student_name})," ",(0,a.jsx)("span",{className:"text-surface-400",children:t.label(e.activity_data)})]})}),(0,a.jsx)("span",{className:"text-xs text-surface-500 whitespace-nowrap",children:b(e.created_at)})]},e.id)})})})]})}function ec(){let[e,s]=(0,i.useState)(null),[t,u]=(0,i.useState)([]),[k,C]=(0,i.useState)(null),[S,z]=(0,i.useState)([]),[D,Z]=(0,i.useState)(null),[E,M]=(0,i.useState)([]),[I,A]=(0,i.useState)([]),[q,P]=(0,i.useState)({completed:0,total:0}),[T,L]=(0,i.useState)(!0),[R,B]=(0,i.useState)("overview"),[H,W]=(0,i.useState)(!1),[O,V]=(0,i.useState)(!1),U=(0,n.useRouter)(),J=(0,l.createClient)();(0,i.useEffect)(()=>{X()},[]),(0,i.useEffect)(()=>{k&&K(k.id)},[k]);let X=async()=>{try{let{data:{user:e}}=await J.auth.getUser();if(!e){U.push("/");return}let{data:t}=await J.from("users").select("*").eq("id",e.id).single();if(!t||"teacher"!==t.role){U.push("/");return}s(t);let{data:a}=await J.from("classes").select("*").eq("teacher_id",e.id).order("name");a&&a.length>0&&(u(a),C(a[0]))}catch(e){console.error("Error loading data:",e)}finally{L(!1)}},K=async e=>{V(!0);try{let{data:s}=await J.from("users").select("*").eq("class_id",e).eq("role","student").order("name");z(s||[]);let a=t.find(s=>s.id===e);if(a){let{data:e}=await J.from("lessons").select("*").eq("id",a.current_lesson_id).single();Z(e)}let{data:i}=await J.from("challenge_submissions").select("*").eq("class_id",e).eq("review_status","pending").order("submitted_at",{ascending:!1}),l=await Promise.all((i||[]).map(async e=>{let{data:s}=await J.from("users").select("id, name").eq("id",e.student_id).single(),{data:t}=await J.from("lessons").select("id, skill_name, phase_id").eq("id",e.lesson_id).single();return{...e,student:s,lesson:t}}));M(l);let{data:n}=await J.from("crisis_alerts").select("*").eq("class_id",e).eq("status","unread").order("created_at",{ascending:!1}),c=await Promise.all((n||[]).map(async e=>{let{data:s}=await J.from("users").select("id, name").eq("id",e.student_id).single();return{...e,student:s}}));A(c);let r=new Date().toISOString().split("T")[0],{data:d}=await J.from("do_now_sessions").select("id").eq("class_id",e).eq("date",r);P({completed:(null==d?void 0:d.length)||0,total:(null==s?void 0:s.length)||0})}catch(e){console.error("Error loading class data:",e)}finally{V(!1)}},Y=async()=>{if(!k||!D)return;let e=Math.min(D.id+1,45);await J.from("classes").update({current_lesson_id:e}).eq("id",k.id);let s=S.map(s=>({student_id:s.id,lesson_id:e,class_id:k.id,status:"available"}));await J.from("student_lessons").upsert(s,{onConflict:"student_id,lesson_id"}),C({...k,current_lesson_id:e}),K(k.id)},G=async()=>{await J.auth.signOut(),U.push("/")},ee=async e=>{await J.from("crisis_alerts").update({status:"read"}).eq("id",e),A(s=>s.filter(s=>s.id!==e))};return T?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-surface-950",children:(0,a.jsx)(c.E.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-surface-950",children:[(0,a.jsxs)("header",{className:"bg-surface-900/95 backdrop-blur-md border-b border-surface-800 sticky top-0 z-50",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCDA"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-bold text-surface-100 text-lg",children:"Teacher Dashboard"}),(0,a.jsx)("p",{className:"text-xs text-surface-500",children:null==e?void 0:e.name})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>W(!H),className:"flex items-center gap-2 px-4 py-2 bg-surface-800 rounded-xl hover:bg-surface-700 transition-colors",children:[(0,a.jsx)("span",{className:"text-surface-200 font-medium",children:null==k?void 0:k.name}),(0,a.jsx)(d.Z,{size:16,className:"text-surface-400"})]}),(0,a.jsx)(r.M,{children:H&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full mt-2 left-0 bg-surface-800 rounded-xl border border-surface-700 shadow-xl overflow-hidden min-w-[200px] z-50",children:t.map(e=>(0,a.jsxs)("button",{onClick:()=>{C(e),W(!1)},className:"w-full px-4 py-3 text-left hover:bg-surface-700 transition-colors flex items-center justify-between ".concat((null==k?void 0:k.id)===e.id?"bg-primary-500/10 text-primary-400":"text-surface-200"),children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsx)("span",{className:"text-xs text-surface-500 font-mono",children:e.code})]},e.id))})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[I.length>0&&(0,a.jsxs)(c.E.button,{onClick:()=>B("alerts"),className:"flex items-center gap-2 px-3 py-2 bg-courage/20 border border-courage/30 rounded-xl text-courage",animate:{scale:[1,1.05,1]},transition:{duration:2,repeat:1/0},children:[(0,a.jsx)(o.Z,{size:18}),(0,a.jsxs)("span",{className:"font-semibold",children:[I.length," Alert",1!==I.length?"s":""]})]}),(0,a.jsx)("button",{onClick:()=>k&&K(k.id),className:"p-2 text-surface-400 hover:text-surface-200 rounded-lg hover:bg-surface-800 transition-all ".concat(O?"animate-spin":""),children:(0,a.jsx)(x.Z,{size:20})}),(0,a.jsx)("button",{onClick:G,className:"p-2 text-surface-400 hover:text-surface-200 rounded-lg hover:bg-surface-800 transition-colors",children:(0,a.jsx)(m.Z,{size:20})})]})]}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex gap-1 -mb-px overflow-x-auto",children:[(0,a.jsx)(er,{active:"overview"===R,onClick:()=>B("overview"),icon:h,label:"Overview"}),(0,a.jsx)(er,{active:"students"===R,onClick:()=>B("students"),icon:p.Z,label:"Students"}),(0,a.jsx)(er,{active:"curriculum"===R,onClick:()=>B("curriculum"),icon:f.Z,label:"Curriculum"}),(0,a.jsx)(er,{active:"donow"===R,onClick:()=>B("donow"),icon:j.Z,label:"Do Now"}),(0,a.jsx)(er,{active:"conversations"===R,onClick:()=>B("conversations"),icon:v,label:"AI Chats"}),(0,a.jsx)(er,{active:"worlds"===R,onClick:()=>B("worlds"),icon:b,label:"Worlds"}),(0,a.jsx)(er,{active:"metrics"===R,onClick:()=>B("metrics"),icon:g,label:"Metrics"}),(0,a.jsx)(er,{active:"reviews"===R,onClick:()=>B("reviews"),icon:N.Z,label:"Reviews",badge:E.length}),(0,a.jsx)(er,{active:"alerts"===R,onClick:()=>B("alerts"),icon:o.Z,label:"Alerts",badge:I.length,urgent:I.length>0}),(0,a.jsx)(er,{active:"announcements"===R,onClick:()=>B("announcements"),icon:y.Z,label:"Announcements"}),(0,a.jsx)(er,{active:"missions"===R,onClick:()=>B("missions"),icon:w.Z,label:"Missions"}),(0,a.jsx)(er,{active:"media"===R,onClick:()=>B("media"),icon:$.Z,label:"Media"}),(0,a.jsx)(er,{active:"roster"===R,onClick:()=>B("roster"),icon:p.Z,label:"Roster"}),(0,a.jsx)(er,{active:"activity"===R,onClick:()=>B("activity"),icon:g,label:"Activity"}),(0,a.jsx)(er,{active:"settings"===R,onClick:()=>B("settings"),icon:_,label:"Settings"})]})})]}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)(r.M,{mode:"wait",children:["overview"===R&&(0,a.jsx)(ed,{currentLesson:D,students:S,doNowStats:q,pendingReviews:E.length,selectedClass:k,onAdvanceLesson:Y}),"reviews"===R&&(0,a.jsx)(ex,{reviews:E,onReviewComplete:()=>k&&K(k.id)}),"students"===R&&(0,a.jsx)(eu,{students:S,classId:null==k?void 0:k.id,currentLessonId:(null==D?void 0:D.id)||1}),"curriculum"===R&&(0,a.jsx)(ef,{classId:null==k?void 0:k.id,currentLessonId:(null==D?void 0:D.id)||1}),"donow"===R&&(0,a.jsx)(ej,{classId:null==k?void 0:k.id,students:S}),"conversations"===R&&(0,a.jsx)(ev,{classId:null==k?void 0:k.id,students:S}),"worlds"===R&&(0,a.jsx)(eb,{classId:null==k?void 0:k.id,students:S}),"metrics"===R&&(0,a.jsx)(eg,{classId:null==k?void 0:k.id,students:S,currentLessonId:(null==D?void 0:D.id)||1}),"alerts"===R&&(0,a.jsx)(ep,{alerts:I,onMarkRead:ee}),"settings"===R&&(0,a.jsx)(eN,{selectedClass:k,classes:t}),"announcements"===R&&k&&e&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,a.jsx)(F,{classId:k.id,teacherId:e.id})},"announcements"),"missions"===R&&k&&e&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,a.jsx)(Q,{classId:k.id,teacherId:e.id,studentCount:S.length})},"missions"),"media"===R&&k&&e&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,a.jsx)(es,{classId:k.id,teacherId:e.id,studentCount:S.length})},"media"),"roster"===R&&k&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,a.jsx)(ei,{classId:k.id})},"roster"),"activity"===R&&k&&(0,a.jsx)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,a.jsx)(en,{classId:k.id,students:S})},"activity")]})})]})}function er(e){let{active:s,onClick:t,icon:i,label:l,badge:n,urgent:c}=e;return(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-3 font-medium transition-all border-b-2 ".concat(s?"text-primary-400 border-primary-500 bg-primary-500/5":"text-surface-400 border-transparent hover:text-surface-200 hover:bg-surface-800/50"),children:[(0,a.jsx)(i,{size:18}),l,void 0!==n&&n>0&&(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs rounded-full font-semibold ".concat(c?"bg-courage text-white":"bg-surface-700 text-surface-300"),children:n})]})}function ed(e){let{currentLesson:s,students:t,doNowStats:i,pendingReviews:l,selectedClass:n,onAdvanceLesson:r}=e;return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsx)("div",{className:"card p-6 phase-".concat(null==s?void 0:s.phase_id),children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[300px]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,a.jsxs)("span",{className:"badge badge-".concat({1:"care",2:"creation",3:"courage",4:"community"}[null==s?void 0:s.phase_id]),children:["Phase ",null==s?void 0:s.phase_id,": ",{1:"Hardware",2:"Direction",3:"Toolbelt",4:"Blueprint"}[null==s?void 0:s.phase_id]]}),(0,a.jsxs)("span",{className:"text-surface-500 text-sm",children:["Lesson ",null==s?void 0:s.id," of 45"]})]}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100 mb-2",children:null==s?void 0:s.skill_name}),(0,a.jsxs)("p",{className:"text-surface-400 italic",children:['"',null==s?void 0:s.compelling_question,'"']})]}),(0,a.jsxs)(c.E.button,{onClick:r,className:"btn btn-primary",whileHover:{scale:1.05},whileTap:{scale:.95},disabled:(null==s?void 0:s.id)===45,children:["Advance to Next Lesson ",(0,a.jsx)(k.Z,{size:18})]})]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,a.jsx)(eo,{icon:p.Z,label:"Students",value:t.length,color:"primary"}),(0,a.jsx)(eo,{icon:C.Z,label:"Do Now Today",value:"".concat(i.completed,"/").concat(i.total),color:"care",progress:i.completed/Math.max(i.total,1)*100}),(0,a.jsx)(eo,{icon:N.Z,label:"Pending Reviews",value:l,color:"creation"}),(0,a.jsx)(eo,{icon:S,label:"Course Progress",value:"".concat(Math.round(((null==s?void 0:s.id)||1)/45*100),"%"),color:"community",progress:((null==s?void 0:s.id)||1)/45*100})]}),n&&(0,a.jsx)(B,{classId:n.id}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-100 mb-4 flex items-center gap-2",children:[(0,a.jsx)(z.Z,{className:"text-primary-400",size:20}),"Class Join Code"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,a.jsx)("div",{className:"px-6 py-4 bg-surface-800 rounded-xl border-2 border-dashed border-surface-600",children:(0,a.jsx)("span",{className:"text-4xl font-mono font-bold tracking-widest text-primary-400",children:null==n?void 0:n.code})}),(0,a.jsxs)("div",{className:"text-surface-400 text-sm",children:[(0,a.jsx)("p",{children:"Share this code with students to join the class."}),(0,a.jsx)("p",{className:"mt-1",children:"Students enter their name + this code + create a PIN."})]})]})]})]},"overview")}function eo(e){let{icon:s,label:t,value:i,color:l,progress:n}=e;return(0,a.jsxs)(c.E.div,{className:"card p-5",whileHover:{scale:1.02},children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-".concat(l,"/20 flex items-center justify-center"),children:(0,a.jsx)(s,{className:"text-".concat(l),size:20})}),(0,a.jsx)("span",{className:"text-surface-400 text-sm",children:t})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-surface-100",children:i}),void 0!==n&&(0,a.jsx)("div",{className:"mt-3 progress-bar",children:(0,a.jsx)("div",{className:"progress-fill bg-".concat(l),style:{width:"".concat(n,"%")}})})]})}function ex(e){let{reviews:s,onReviewComplete:t}=e,[l,n]=(0,i.useState)(null);return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Pending Reviews"}),(0,a.jsxs)("span",{className:"badge badge-creation",children:[s.length," pending"]})]}),0===s.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(N.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"All caught up!"}),(0,a.jsx)("p",{className:"text-surface-500",children:"No challenge submissions waiting for review."})]}):(0,a.jsx)("div",{className:"grid lg:grid-cols-2 gap-4",children:s.map(e=>{var s,t,i;return(0,a.jsxs)(c.E.div,{className:"card p-5 cursor-pointer hover:border-primary-500/30",onClick:()=>n(e),whileHover:{scale:1.01},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:null===(s=e.student)||void 0===s?void 0:s.name}),(0,a.jsxs)("p",{className:"text-sm text-surface-500",children:["Lesson ",e.lesson_id,": ",null===(t=e.lesson)||void 0===t?void 0:t.skill_name]})]}),(0,a.jsxs)("span",{className:"badge badge-primary",children:[(0,a.jsx)(D.Z,{size:12,className:"mr-1"}),new Date(e.submitted_at).toLocaleDateString()]})]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm line-clamp-2",children:(null===(i=e.reflections)||void 0===i?void 0:i["What I did"])||"No description provided"}),(0,a.jsxs)("button",{className:"btn btn-primary btn-sm mt-3",children:["Review ",(0,a.jsx)(k.Z,{size:16})]})]},e.id)})}),(0,a.jsx)(r.M,{children:l&&(0,a.jsx)(em,{review:l,onClose:()=>n(null),onComplete:()=>{n(null),t()}})})]},"reviews")}function em(e){var s,t,n,r;let{review:d,onClose:o,onComplete:x}=e,[m,u]=(0,i.useState)(3),[h,p]=(0,i.useState)(""),[f,j]=(0,i.useState)(""),[v,b]=(0,i.useState)(!1),[g,N]=(0,i.useState)(!1),y=(0,l.createClient)(),w=async()=>{N(!0);try{if(await y.from("challenge_submissions").update({review_status:"reviewed",review_score:m,review_feedback:h,reviewed_at:new Date().toISOString(),approved_for_civic:v,civic_description:v?f:null}).eq("id",d.id),await y.from("world_states").update({trees:m>=3?1:0,tower:4===m?1:0}).eq("student_id",d.student_id),v&&f){var e,s,t;await y.from("civic_events").insert({class_id:d.class_id,phase_id:(null===(e=d.lesson)||void 0===e?void 0:e.phase_id)||1,skill_name:(null===(s=d.lesson)||void 0===s?void 0:s.skill_name)||"Unknown",skill_category:["care","creation","courage","community"][((null===(t=d.lesson)||void 0===t?void 0:t.phase_id)||1)-1],anonymized_description:f,event_type:"challenge_complete"})}x()}catch(e){console.error("Error submitting review:",e)}finally{N(!1)}};return(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:o,children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between sticky top-0 bg-surface-900 z-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"font-semibold text-surface-100",children:[null===(s=d.student)||void 0===s?void 0:s.name,"'s Challenge"]}),(0,a.jsxs)("p",{className:"text-sm text-surface-500",children:["Lesson ",d.lesson_id,": ",null===(t=d.lesson)||void 0===t?void 0:t.skill_name]})]}),(0,a.jsx)("button",{onClick:o,className:"text-surface-500 hover:text-surface-300 p-1",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200 mb-3",children:"Student's Response"}),(0,a.jsxs)("div",{className:"card p-4 bg-surface-800/50",children:[(0,a.jsx)("p",{className:"text-surface-300 whitespace-pre-wrap",children:(null===(n=d.reflections)||void 0===n?void 0:n["What I did"])||"No description provided"}),(null===(r=d.reflections)||void 0===r?void 0:r["Evidence/Proof"])&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-surface-700",children:[(0,a.jsx)("span",{className:"text-xs text-surface-500 uppercase tracking-wide",children:"Evidence"}),(0,a.jsx)("p",{className:"text-surface-400 mt-1",children:d.reflections["Evidence/Proof"]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200 mb-3",children:"Mastery Score"}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[1,2,3,4].map(e=>(0,a.jsx)("button",{onClick:()=>u(e),className:"p-4 rounded-xl text-center transition-all ".concat(m===e?"bg-primary-500 text-white ring-2 ring-primary-400":"bg-surface-800 text-surface-400 hover:bg-surface-700"),children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e})},e))}),(0,a.jsx)("p",{className:"text-sm text-surface-400 mt-2 text-center",children:{1:"Developing - Needs more effort and depth",2:"Approaching - Shows understanding but incomplete",3:"Meeting - Solid demonstration of skill",4:"Exceeding - Exceptional application of skill"}[m]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Feedback for Student"}),(0,a.jsx)("textarea",{className:"input",rows:3,placeholder:"What did they do well? What could they improve?",value:h,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("div",{className:"card p-4 bg-community/10 border-community/30",children:[(0,a.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:v,onChange:e=>b(e.target.checked),className:"w-5 h-5 rounded bg-surface-800 border-surface-600"}),(0,a.jsx)("span",{className:"text-surface-200",children:"Share anonymized version in Civic World"})]}),v&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"label",children:"Write an anonymized description"}),(0,a.jsx)("textarea",{className:"input",rows:2,placeholder:"A student demonstrated active listening by...",value:f,onChange:e=>j(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:o,className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:w,disabled:g,className:"btn btn-primary flex-1",children:g?"Submitting...":"Submit Review"})]})]})]})})}function eu(e){let{students:s,classId:t,currentLessonId:n}=e,[r,d]=(0,i.useState)({}),[o,x]=(0,i.useState)(""),m=(0,l.createClient)();(0,i.useEffect)(()=>{u()},[s,n]);let u=async()=>{if(!t)return;let{data:e}=await m.from("student_lessons").select("*").eq("class_id",t).eq("lesson_id",n),s={};null==e||e.forEach(e=>{s[e.student_id]=e}),d(s)},h=s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase()));return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-surface-100",children:["Students (",s.length,")"]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-surface-500",size:18}),(0,a.jsx)("input",{type:"text",placeholder:"Search students...",className:"input pl-10 w-64",value:o,onChange:e=>x(e.target.value)})]})]}),0===h.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(p.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No students yet"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Share your class code with students to get started."})]}):(0,a.jsx)("div",{className:"card overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full min-w-[600px]",children:[(0,a.jsx)("thead",{className:"bg-surface-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left px-4 py-3 text-surface-400 font-medium text-sm",children:"Student"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Do Now"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Text"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Scenario"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Challenge"}),(0,a.jsx)("th",{className:"text-center px-4 py-3 text-surface-400 font-medium text-sm",children:"Status"})]})}),(0,a.jsx)("tbody",{children:h.map(e=>{let s=r[e.id]||{};return(0,a.jsxs)("tr",{className:"border-t border-surface-800 hover:bg-surface-800/50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-community flex items-center justify-center text-white font-bold text-sm",children:e.name[0]}),(0,a.jsx)("span",{className:"text-surface-200 font-medium",children:e.name})]})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)(eh,{complete:s.do_now_complete})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)(eh,{complete:s.text_anchor_complete})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)(eh,{complete:s.scenario_complete})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)(eh,{complete:s.challenge_complete})}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("span",{className:"badge ".concat("complete"===s.status?"badge-care":"in_progress"===s.status?"badge-creation":"bg-surface-800 text-surface-500"),children:s.status||"Not started"})})]},e.id)})})]})})]},"students")}function eh(e){let{complete:s}=e;return(0,a.jsx)("div",{className:"w-6 h-6 rounded-full mx-auto flex items-center justify-center ".concat(s?"bg-care/20":"bg-surface-800"),children:s?(0,a.jsx)(M.Z,{size:14,className:"text-care"}):(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-surface-600"})})}function ep(e){let{alerts:s,onMarkRead:t}=e,i={self_harm:{label:"Self-Harm Concern",color:"courage"},helplessness:{label:"Helplessness",color:"creation"},rage:{label:"Intense Anger",color:"courage"},abuse:{label:"Possible Abuse",color:"courage"}};return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Crisis Alerts"}),s.length>0&&(0,a.jsxs)("span",{className:"badge bg-courage text-white",children:[s.length," unread"]})]}),(0,a.jsx)("div",{className:"card p-4 bg-surface-800/50 border-surface-700",children:(0,a.jsxs)("p",{className:"text-surface-300 text-sm",children:[(0,a.jsx)("strong",{className:"text-surface-100",children:"Important:"})," These alerts are triggered when a student's conversation indicates they may be struggling. Reach out privately and consider involving school counselors."]})}),0===s.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(M.Z,{size:48,className:"mx-auto mb-4 text-care"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No active alerts"}),(0,a.jsx)("p",{className:"text-surface-500",children:"All students appear to be doing well."})]}):(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>{var s,l,n;return(0,a.jsx)(c.E.div,{className:"card p-5 border-courage/50 bg-courage/5",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,a.jsx)(o.Z,{className:"text-courage",size:20}),(0,a.jsx)("span",{className:"badge badge-".concat((null===(s=i[e.trigger_type])||void 0===s?void 0:s.color)||"courage"),children:(null===(l=i[e.trigger_type])||void 0===l?void 0:l.label)||e.trigger_type}),(0,a.jsx)("span",{className:"text-surface-500 text-sm",children:new Date(e.created_at).toLocaleString()})]}),(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-2",children:null===(n=e.student)||void 0===n?void 0:n.name}),(0,a.jsx)("div",{className:"bg-surface-900 rounded-xl p-4 border border-surface-700",children:(0,a.jsxs)("p",{className:"text-surface-300 text-sm italic",children:['"',e.trigger_text,'"']})})]}),(0,a.jsx)("button",{onClick:()=>t(e.id),className:"btn btn-secondary btn-sm",children:"Mark as Read"})]})},e.id)})})]},"alerts")}function ef(e){let{classId:s,currentLessonId:t}=e,[n,d]=(0,i.useState)([]),[o,x]=(0,i.useState)({}),[m,u]=(0,i.useState)({}),[h,p]=(0,i.useState)(null),[f,j]=(0,i.useState)(null),[v,b]=(0,i.useState)(""),[g,N]=(0,i.useState)(!1),[y,w]=(0,i.useState)(null),_=(0,l.createClient)();(0,i.useEffect)(()=>{k()},[]);let k=async()=>{let{data:e}=await _.from("lessons").select("*").order("id");d(e||[]);let{data:s}=await _.from("scenarios").select("*"),t={};null==s||s.forEach(e=>{t[e.lesson_id]=e}),x(t);let{data:a}=await _.from("challenges").select("*"),i={};null==a||a.forEach(e=>{i[e.lesson_id]=e}),u(i)},C=(e,s)=>{var t,a;p(e),j(s),"scenario"===s?b((null===(t=o[e.id])||void 0===t?void 0:t.situation_prompt)||""):b((null===(a=m[e.id])||void 0===a?void 0:a.description)||"")},S=async()=>{if(h&&f){N(!0);try{if("scenario"===f){let e=o[h.id];e?await _.from("scenarios").update({situation_prompt:v}).eq("id",e.id):await _.from("scenarios").insert({lesson_id:h.id,situation_prompt:v,reflection_questions:["What did you learn?","How can you apply this?"]})}else{let e=m[h.id];e?await _.from("challenges").update({description:v}).eq("id",e.id):await _.from("challenges").insert({lesson_id:h.id,description:v,difficulty:"medium",xp_reward:50,building_block_reward:"flower"})}await k(),j(null),p(null)}catch(e){console.error("Error saving:",e)}finally{N(!1)}}},z={1:"care",2:"creation",3:"courage",4:"community"},D={1:"Hardware",2:"Direction",3:"Toolbelt",4:"Blueprint"},E=y?n.filter(e=>e.phase_id===y):n;return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Curriculum Manager"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>w(null),className:"btn btn-sm ".concat(y?"btn-secondary":"btn-primary"),children:"All"}),[1,2,3,4].map(e=>(0,a.jsxs)("button",{onClick:()=>w(e),className:"btn btn-sm ".concat(y===e?"btn-primary":"btn-secondary"),children:["Phase ",e]},e))]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:E.map(e=>{var s,i,l,n;let c=!!(null===(s=o[e.id])||void 0===s?void 0:s.situation_prompt),r=!!(null===(i=m[e.id])||void 0===i?void 0:i.description),d=e.id===t;return(0,a.jsxs)("div",{className:"card p-4 ".concat(d?"ring-2 ring-primary-500":""),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(0,a.jsx)("span",{className:"badge badge-".concat(z[e.phase_id]),children:D[e.phase_id]}),(0,a.jsxs)("span",{className:"text-surface-500 text-sm",children:["Lesson ",e.id]}),d&&(0,a.jsx)("span",{className:"badge bg-primary-500 text-white",children:"Current"})]}),(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-1",children:e.skill_name}),(0,a.jsxs)("p",{className:"text-surface-400 text-sm italic",children:['"',e.compelling_question,'"']})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>C(e,"scenario"),className:"btn btn-sm ".concat(c?"btn-secondary":"bg-courage/20 text-courage border border-courage/30"),children:c?"✓ Scenario":"+ Scenario"}),(0,a.jsx)("button",{onClick:()=>C(e,"challenge"),className:"btn btn-sm ".concat(r?"btn-secondary":"bg-creation/20 text-creation border border-creation/30"),children:r?"✓ Challenge":"+ Challenge"})]})]}),(c||r)&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-surface-700 grid md:grid-cols-2 gap-4",children:[c&&(0,a.jsxs)("div",{className:"p-3 bg-surface-800/50 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xs text-surface-500 uppercase tracking-wide",children:"Scenario"}),(0,a.jsx)("p",{className:"text-surface-300 text-sm mt-1 line-clamp-2",children:null===(l=o[e.id])||void 0===l?void 0:l.situation_prompt})]}),r&&(0,a.jsxs)("div",{className:"p-3 bg-surface-800/50 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xs text-surface-500 uppercase tracking-wide",children:"Challenge"}),(0,a.jsx)("p",{className:"text-surface-300 text-sm mt-1 line-clamp-2",children:null===(n=m[e.id])||void 0===n?void 0:n.description})]})]})]},e.id)})}),(0,a.jsx)(r.M,{children:f&&h&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>j(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between sticky top-0 bg-surface-900 z-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-semibold text-surface-100",children:"scenario"===f?"Edit Scenario":"Edit Challenge"}),(0,a.jsxs)("p",{className:"text-sm text-surface-500",children:["Lesson ",h.id,": ",h.skill_name]})]}),(0,a.jsx)("button",{onClick:()=>j(null),className:"text-surface-500 hover:text-surface-300 p-1",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"scenario"===f?"Situation Prompt":"Challenge Description"}),(0,a.jsx)("textarea",{className:"input",rows:8,placeholder:"scenario"===f?"Describe a real-world situation that tests this skill...":"Describe the real-life challenge students should complete...",value:v,onChange:e=>b(e.target.value)}),(0,a.jsx)("p",{className:"text-xs text-surface-500 mt-2",children:"scenario"===f?"This situation will be presented to students in the Scenario pathway for them to analyze and respond to.":"This challenge encourages students to practice the skill in their real life and submit evidence of completion."})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>j(null),className:"btn btn-secondary flex-1",children:"Cancel"}),(0,a.jsx)("button",{onClick:S,disabled:g||!v.trim(),className:"btn btn-primary flex-1",children:g?"Saving...":"Save"})]})]})]})})})]},"curriculum")}function ej(e){var s,t;let{classId:n,students:d}=e,[o,x]=(0,i.useState)([]),[m,u]=(0,i.useState)(new Date().toISOString().split("T")[0]),[h,p]=(0,i.useState)(null),[f,v]=(0,i.useState)(!0),b=(0,l.createClient)();(0,i.useEffect)(()=>{g()},[n,m]);let g=async()=>{if(!n)return;v(!0);let{data:e}=await b.from("do_now_sessions").select("*").eq("class_id",n).gte("created_at","".concat(m,"T00:00:00")).lte("created_at","".concat(m,"T23:59:59")).order("created_at",{ascending:!1});x(await Promise.all((e||[]).map(async e=>{let s=d.find(s=>s.id===e.student_id);return{...e,student:s}}))),v(!1)};d.map(e=>[e.id,e]);let N=new Set(o.map(e=>e.student_id));return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Do Now Manager"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"input"}),(0,a.jsxs)("span",{className:"badge badge-care",children:[o.length,"/",d.length," completed"]})]})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-3",children:"Completion Status"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>(0,a.jsxs)("div",{className:"px-3 py-2 rounded-lg text-sm ".concat(N.has(e.id)?"bg-care/20 text-care border border-care/30":"bg-surface-800 text-surface-500"),children:[e.name," ",N.has(e.id)&&"✓"]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-100",children:["Conversations (",o.length,")"]}),f?(0,a.jsx)("div",{className:"card p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===o.length?(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)(j.Z,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("p",{className:"text-surface-400",children:"No Do Now sessions for this date"})]}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:o.map(e=>{var s,t,i,l;return(0,a.jsxs)("div",{className:"card p-4 cursor-pointer hover:border-primary-500/30",onClick:()=>p(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:null===(s=e.student)||void 0===s?void 0:s.name}),(0,a.jsx)("span",{className:"text-xs text-surface-500",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm line-clamp-2",children:(null===(i=e.messages)||void 0===i?void 0:null===(t=i[0])||void 0===t?void 0:t.content)||"No content"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsxs)("span",{className:"text-xs text-surface-500",children:[(null===(l=e.messages)||void 0===l?void 0:l.length)||0," messages"]}),e.completed&&(0,a.jsx)("span",{className:"badge badge-care text-xs",children:"Complete"})]})]},e.id)})})]}),(0,a.jsx)(r.M,{children:h&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>p(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"font-semibold text-surface-100",children:[null===(s=h.student)||void 0===s?void 0:s.name,"'s Do Now"]}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:new Date(h.created_at).toLocaleString()})]}),(0,a.jsx)("button",{onClick:()=>p(null),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsx)("div",{className:"p-4 overflow-y-auto max-h-[60vh] space-y-3",children:null===(t=h.messages)||void 0===t?void 0:t.map((e,s)=>(0,a.jsxs)("div",{className:"p-3 rounded-xl ".concat("assistant"===e.role?"bg-primary-500/10 border border-primary-500/20":"bg-surface-800"),children:[(0,a.jsx)("span",{className:"text-xs text-surface-500 uppercase",children:"assistant"===e.role?"\uD83E\uDD16 AI":"\uD83D\uDC64 Student"}),(0,a.jsx)("p",{className:"text-surface-200 mt-1 whitespace-pre-wrap",children:e.content})]},s))})]})})})]},"donow")}function ev(e){var s,t;let{classId:n,students:d}=e,[o,x]=(0,i.useState)([]),[m,u]=(0,i.useState)(null),[h,p]=(0,i.useState)("all"),[f,j]=(0,i.useState)(!0),b=(0,l.createClient)();(0,i.useEffect)(()=>{g()},[n]);let g=async()=>{if(!n)return;j(!0);let[e,s]=await Promise.all([b.from("do_now_sessions").select("*").eq("class_id",n).order("created_at",{ascending:!1}).limit(50),b.from("scenario_sessions").select("*").eq("class_id",n).order("created_at",{ascending:!1}).limit(50)]);x([...(e.data||[]).map(e=>({...e,type:"do_now"})),...(s.data||[]).map(e=>({...e,type:"scenario"}))].sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime()).map(e=>({...e,student:d.find(s=>s.id===e.student_id)}))),j(!1)},N="all"===h?o:o.filter(e=>e.type===h);return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"AI Conversations"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>p("all"),className:"btn btn-sm ".concat("all"===h?"btn-primary":"btn-secondary"),children:"All"}),(0,a.jsx)("button",{onClick:()=>p("do_now"),className:"btn btn-sm ".concat("do_now"===h?"btn-primary":"btn-secondary"),children:"Do Now"}),(0,a.jsx)("button",{onClick:()=>p("scenario"),className:"btn btn-sm ".concat("scenario"===h?"btn-primary":"btn-secondary"),children:"Scenarios"})]})]}),f?(0,a.jsx)("div",{className:"card p-12 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===N.length?(0,a.jsxs)("div",{className:"card p-12 text-center",children:[(0,a.jsx)(v,{size:48,className:"mx-auto mb-4 text-surface-600"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-surface-300 mb-2",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-surface-500",children:"Student AI conversations will appear here."})]}):(0,a.jsx)("div",{className:"space-y-3",children:N.map(e=>{var s,t,i,l,n;return(0,a.jsxs)("div",{className:"card p-4 cursor-pointer hover:border-primary-500/30",onClick:()=>u(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-community flex items-center justify-center text-white font-bold",children:(null===(t=e.student)||void 0===t?void 0:null===(s=t.name)||void 0===s?void 0:s[0])||"?"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100",children:(null===(i=e.student)||void 0===i?void 0:i.name)||"Unknown"}),(0,a.jsxs)("p",{className:"text-sm text-surface-500",children:[(null===(l=e.messages)||void 0===l?void 0:l.length)||0," messages • ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"badge ".concat("do_now"===e.type?"badge-care":"badge-courage"),children:"do_now"===e.type?"Do Now":"Scenario"}),(0,a.jsx)(k.Z,{size:16,className:"text-surface-500"})]})]}),(null===(n=e.messages)||void 0===n?void 0:n[e.messages.length-1])&&(0,a.jsx)("p",{className:"text-surface-400 text-sm mt-3 line-clamp-2 pl-13",children:e.messages[e.messages.length-1].content})]},e.id)})}),(0,a.jsx)(r.M,{children:m&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>u(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"font-semibold text-surface-100",children:[null===(s=m.student)||void 0===s?void 0:s.name,"'s Conversation"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("span",{className:"badge text-xs ".concat("do_now"===m.type?"badge-care":"badge-courage"),children:"do_now"===m.type?"Do Now":"Scenario"}),(0,a.jsx)("span",{className:"text-xs text-surface-500",children:new Date(m.created_at).toLocaleString()})]})]}),(0,a.jsx)("button",{onClick:()=>u(null),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsx)("div",{className:"p-4 overflow-y-auto max-h-[60vh] space-y-3",children:null===(t=m.messages)||void 0===t?void 0:t.map((e,s)=>(0,a.jsxs)("div",{className:"p-3 rounded-xl ".concat("assistant"===e.role?"bg-primary-500/10 border border-primary-500/20":"bg-surface-800"),children:[(0,a.jsx)("span",{className:"text-xs text-surface-500 uppercase",children:"assistant"===e.role?"\uD83E\uDD16 Socratic AI":"\uD83D\uDC64 Student"}),(0,a.jsx)("p",{className:"text-surface-200 mt-1 whitespace-pre-wrap",children:e.content})]},s))})]})})})]},"conversations")}function eb(e){var s,t,n;let{classId:d,students:o}=e,[m,u]=(0,i.useState)({}),[h,p]=(0,i.useState)({}),[f,j]=(0,i.useState)(null),[v,b]=(0,i.useState)(!0),g=(0,l.createClient)();(0,i.useEffect)(()=>{N()},[d,o]);let N=async()=>{var e,s;if(!d)return;b(!0);let t=o.map(e=>e.id),[a,i]=await Promise.all([g.from("world_states").select("*").in("student_id",t),g.from("student_inventory").select("*").in("student_id",t)]),l={};null===(e=a.data)||void 0===e||e.forEach(e=>{l[e.student_id]=e}),u(l);let n={};null===(s=i.data)||void 0===s||s.forEach(e=>{n[e.student_id]||(n[e.student_id]=[]),n[e.student_id].push(e)}),p(n),b(!1)},y=e=>{let s=m[e]||{},t=h[e]||[];return(s.trees||0)+(s.tower||0)+t.length};return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Student Worlds"}),(0,a.jsxs)("button",{onClick:N,className:"btn btn-secondary btn-sm",children:[(0,a.jsx)(x.Z,{size:16})," Refresh"]})]}),v?(0,a.jsx)("div",{className:"card p-12 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):(0,a.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(e=>{let s=m[e.id]||{},t=h[e.id]||[],i=y(e.id);return(0,a.jsxs)("div",{className:"card p-4 cursor-pointer hover:border-primary-500/30",onClick:()=>j(e),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-community flex items-center justify-center text-white font-bold",children:e.name[0]}),(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:e.name})]}),(0,a.jsxs)("span",{className:"badge badge-primary",children:[i," items"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-center",children:[(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDF33"}),(0,a.jsx)("p",{className:"text-xs text-surface-500 mt-1",children:s.trees||0})]}),(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDFDB️"}),(0,a.jsx)("p",{className:"text-xs text-surface-500 mt-1",children:s.tower||0})]}),(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83C\uDF38"}),(0,a.jsx)("p",{className:"text-xs text-surface-500 mt-1",children:t.filter(e=>"flower"===e.item_type).length})]}),(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg",children:[(0,a.jsx)("span",{className:"text-xl",children:"\uD83D\uDCE6"}),(0,a.jsx)("p",{className:"text-xs text-surface-500 mt-1",children:t.length})]})]})]},e.id)})}),(0,a.jsx)(r.M,{children:f&&(0,a.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",onClick:()=>j(null),children:(0,a.jsxs)(c.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-lg max-h-[80vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between",children:[(0,a.jsxs)("h2",{className:"font-semibold text-surface-100",children:[f.name,"'s World"]}),(0,a.jsx)("button",{onClick:()=>j(null),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(Z.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-200 mb-2",children:"World State"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"p-3 bg-surface-800 rounded-lg flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDF33"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-surface-400 text-xs",children:"Trees"}),(0,a.jsx)("p",{className:"text-surface-100 font-bold",children:(null===(s=m[f.id])||void 0===s?void 0:s.trees)||0})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-surface-800 rounded-lg flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFDB️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-surface-400 text-xs",children:"Towers"}),(0,a.jsx)("p",{className:"text-surface-100 font-bold",children:(null===(t=m[f.id])||void 0===t?void 0:t.tower)||0})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 mb-2",children:["Inventory (",(null===(n=h[f.id])||void 0===n?void 0:n.length)||0," items)"]}),(0,a.jsxs)("div",{className:"max-h-48 overflow-y-auto space-y-2",children:[(h[f.id]||[]).map((e,s)=>(0,a.jsxs)("div",{className:"p-2 bg-surface-800 rounded-lg flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-200",children:e.item_type}),(0,a.jsxs)("span",{className:"text-xs text-surface-500",children:["x",e.quantity||1]})]},s)),(!h[f.id]||0===h[f.id].length)&&(0,a.jsx)("p",{className:"text-surface-500 text-center py-4",children:"No items in inventory"})]})]})]})]})})})]},"worlds")}function eg(e){let{classId:s,students:t,currentLessonId:n}=e,[r,d]=(0,i.useState)({}),[m,u]=(0,i.useState)(!0),h=(0,l.createClient)();(0,i.useEffect)(()=>{p()},[s,t]);let p=async()=>{var e,a,i,l,c;if(!s)return;u(!0);let r=t.map(e=>e.id),o=new Date().toISOString().split("T")[0],x=new Date(Date.now()-6048e5).toISOString().split("T")[0],[m,p,f,j,v,b]=await Promise.all([h.from("do_now_sessions").select("id").eq("class_id",s).gte("created_at","".concat(o,"T00:00:00")),h.from("do_now_sessions").select("id").eq("class_id",s).gte("created_at","".concat(x,"T00:00:00")),h.from("challenge_submissions").select("id, review_status, review_score").eq("class_id",s),h.from("student_lessons").select("*").eq("class_id",s),h.from("crisis_alerts").select("id").eq("class_id",s).eq("status","unread"),h.from("world_states").select("*").in("student_id",r)]),g=(j.data||[]).filter(e=>"complete"===e.status).length,N=t.length*n,y=(f.data||[]).filter(e=>e.review_score).reduce((e,s,t,a)=>e+(s.review_score||0)/a.length,0);d({doNowToday:(null===(e=m.data)||void 0===e?void 0:e.length)||0,doNowWeek:(null===(a=p.data)||void 0===a?void 0:a.length)||0,totalChallenges:(null===(i=f.data)||void 0===i?void 0:i.length)||0,pendingChallenges:(f.data||[]).filter(e=>"pending"===e.review_status).length,reviewedChallenges:(f.data||[]).filter(e=>"reviewed"===e.review_status).length,avgScore:y.toFixed(1),completedLessons:g,totalPossibleLessons:N,completionRate:N>0?Math.round(g/N*100):0,activeAlerts:(null===(l=v.data)||void 0===l?void 0:l.length)||0,totalWorlds:(null===(c=b.data)||void 0===c?void 0:c.length)||0}),u(!1)};return m?(0,a.jsx)(c.E.div,{className:"flex items-center justify-center py-20",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full"})},"metrics"):(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Class Metrics"}),(0,a.jsxs)("button",{onClick:p,className:"btn btn-secondary btn-sm",children:[(0,a.jsx)(x.Z,{size:16})," Refresh"]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"card p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-care/20 flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"text-care",size:20})}),(0,a.jsx)("span",{className:"text-surface-400 text-sm",children:"Do Now Today"})]}),(0,a.jsxs)("div",{className:"text-3xl font-bold text-surface-100",children:[r.doNowToday,"/",t.length]}),(0,a.jsx)("div",{className:"mt-2 progress-bar",children:(0,a.jsx)("div",{className:"progress-fill bg-care",style:{width:"".concat(r.doNowToday/Math.max(t.length,1)*100,"%")}})})]}),(0,a.jsxs)("div",{className:"card p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-creation/20 flex items-center justify-center",children:(0,a.jsx)(N.Z,{className:"text-creation",size:20})}),(0,a.jsx)("span",{className:"text-surface-400 text-sm",children:"Avg Score"})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-surface-100",children:r.avgScore||"-"}),(0,a.jsx)("p",{className:"text-surface-500 text-sm mt-1",children:"of 4.0 mastery"})]}),(0,a.jsxs)("div",{className:"card p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-primary/20 flex items-center justify-center",children:(0,a.jsx)(w.Z,{className:"text-primary-400",size:20})}),(0,a.jsx)("span",{className:"text-surface-400 text-sm",children:"Completion Rate"})]}),(0,a.jsxs)("div",{className:"text-3xl font-bold text-surface-100",children:[r.completionRate,"%"]}),(0,a.jsx)("div",{className:"mt-2 progress-bar",children:(0,a.jsx)("div",{className:"progress-fill bg-primary-500",style:{width:"".concat(r.completionRate,"%")}})})]}),(0,a.jsxs)("div",{className:"card p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-courage/20 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"text-courage",size:20})}),(0,a.jsx)("span",{className:"text-surface-400 text-sm",children:"Active Alerts"})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-surface-100",children:r.activeAlerts}),(0,a.jsx)("p",{className:"text-surface-500 text-sm mt-1",children:"need attention"})]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-100 mb-4 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{size:20,className:"text-care"}),"Engagement This Week"]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Do Now Sessions"}),(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:r.doNowWeek})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Challenge Submissions"}),(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:r.totalChallenges})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Pending Reviews"}),(0,a.jsx)("span",{className:"font-semibold text-creation",children:r.pendingChallenges})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Reviewed"}),(0,a.jsx)("span",{className:"font-semibold text-care",children:r.reviewedChallenges})]})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-100 mb-4 flex items-center gap-2",children:[(0,a.jsx)(b,{size:20,className:"text-community"}),"World Building"]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Active Worlds"}),(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:r.totalWorlds})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Students"}),(0,a.jsx)("span",{className:"font-semibold text-surface-100",children:t.length})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Current Lesson"}),(0,a.jsxs)("span",{className:"font-semibold text-primary-400",children:["#",n]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-surface-400",children:"Course Progress"}),(0,a.jsxs)("span",{className:"font-semibold text-surface-100",children:[Math.round(n/45*100),"%"]})]})]})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-100 mb-4 flex items-center gap-2",children:[(0,a.jsx)(S,{size:20,className:"text-creation"}),"Student Progress Overview"]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mb-4",children:"Track individual student engagement and completion across all activities."}),(0,a.jsxs)("div",{className:"text-center py-8 text-surface-500",children:[(0,a.jsx)(g,{size:32,className:"mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Detailed student analytics coming soon"})]})]})]},"metrics")}function eN(e){let{selectedClass:s,classes:t}=e;return(0,a.jsxs)(c.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100",children:"Settings"}),s&&(0,a.jsx)(L,{classId:s.id}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-4",children:"Class Codes"}),(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-surface-800/50 rounded-xl",children:[(0,a.jsx)("span",{className:"text-surface-200",children:e.name}),(0,a.jsx)("span",{className:"font-mono text-xl font-bold text-primary-400",children:e.code})]},e.id))})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-4",children:"Curriculum Overview"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-care/10 rounded-xl border border-care/30",children:[(0,a.jsx)("h4",{className:"font-semibold text-care mb-2",children:"Phase 1: Hardware"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Lessons 1-10: Self-Awareness, Attention, Impulse Control"})]}),(0,a.jsxs)("div",{className:"p-4 bg-creation/10 rounded-xl border border-creation/30",children:[(0,a.jsx)("h4",{className:"font-semibold text-creation mb-2",children:"Phase 2: Direction"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Lessons 11-22: Values, Resilience, Standards"})]}),(0,a.jsxs)("div",{className:"p-4 bg-courage/10 rounded-xl border border-courage/30",children:[(0,a.jsx)("h4",{className:"font-semibold text-courage mb-2",children:"Phase 3: Toolbelt"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Lessons 23-32: Strategy, Risk, Agency"})]}),(0,a.jsxs)("div",{className:"p-4 bg-community/10 rounded-xl border border-community/30",children:[(0,a.jsx)("h4",{className:"font-semibold text-community mb-2",children:"Phase 4: Blueprint"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Lessons 33-45: Leadership, Service, Legacy"})]})]})]}),(0,a.jsxs)("div",{className:"card p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-surface-100 mb-4",children:"About Leadership 2.0"}),(0,a.jsx)("p",{className:"text-surface-400 mb-4",children:"A research-backed leadership development platform that builds real skills through real action. Students develop executive function, resilience, and leadership capacity through daily practice."}),(0,a.jsxs)("p",{className:"text-surface-500 text-sm",children:[(0,a.jsx)("strong",{children:"Principle:"}),' "The 51/49 Rule" — Master yourself before leading others. Consistency over intensity. Deeds not words.']})]})]},"settings")}},7925:function(e,s,t){"use strict";t.r(s),t.d(s,{createClient:function(){return l}});var a=t(9982);let i=null;function l(){if(i)return i;let e="https://apakkhzuydsfzvypewwa.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwYWtraHp1eWRzZnp2eXBld3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1MDEyODQsImV4cCI6MjA4NDA3NzI4NH0.c3hiZOEKMIXMP7aB0SVgrbQH58nwxseycVmeH23KsNQ";if(!e||!s)throw Error("Missing Supabase environment variables. Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");return i=(0,a.createBrowserClient)(e,s)}}},function(e){e.O(0,[285,220,535,741,564,744],function(){return e(e.s=6489)}),_N_E=e.O()}]);