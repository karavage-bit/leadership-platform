(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{7052:function(e,s,t){Promise.resolve().then(t.bind(t,4550))},4550:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eq}});var a=t(8357),l=t(921),i=t(1374),r=t(1808),n=t(609),c=t(840),o=t(8556),d=t(6682),m=t(7384),x=t(8267),u=t(9085),p=t(6520),h=t(4525),f=t(7796),v=t(9596),b=t(7925),g=t(6829),j=t(4020),y=t(8844),w=t(2412),N=t(9235),_=t(8288),C=t(5088),k=t(8235),S=t(340),z=t(2389),Z=t(6694),D=t(4615),I=t(5049),E=t(7502),q=t(5543),P=t(7209),L=t(3836);function T(e){let{classId:s}=e,[t,n]=(0,l.useState)([]),[c,o]=(0,l.useState)(new Set),[d,m]=(0,l.useState)(!1),x=(0,b.createClient)();(0,l.useEffect)(()=>{u();let e=localStorage.getItem("announcements_dismissed_".concat(s));e&&o(new Set(JSON.parse(e)))},[s]);let u=async()=>{let e=new Date().toISOString(),{data:t}=await x.from("announcements").select("*").eq("class_id",s).or("expires_at.is.null,expires_at.gt.".concat(e)).order("is_pinned",{ascending:!1}).order("priority",{ascending:!1}).order("created_at",{ascending:!1}).limit(10);n(t||[])},p=e=>{let t=new Set(c);t.add(e),o(t),localStorage.setItem("announcements_dismissed_".concat(s),JSON.stringify([...t]))},h=t.filter(e=>!!e.is_pinned||"normal"!==e.priority||!c.has(e.id)),f=h.filter(e=>"urgent"===e.priority),v=h.filter(e=>"important"===e.priority||e.is_pinned),g=h.filter(e=>"normal"===e.priority&&!e.is_pinned);return 0===h.length?null:(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[f.map(e=>(0,a.jsx)(i.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 rounded-xl bg-gradient-to-r from-red-900/40 to-red-800/20 border border-red-500/40",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(E.Z,{className:"text-red-400 shrink-0 mt-0.5",size:20}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-red-300",children:e.title}),(0,a.jsx)("p",{className:"text-surface-300 text-sm mt-1",children:e.content})]})]})},e.id)),v.map(e=>(0,a.jsx)(i.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 rounded-xl bg-gradient-to-r from-amber-900/30 to-amber-800/10 border border-amber-500/30",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[e.is_pinned?(0,a.jsx)(q.Z,{className:"text-primary-400 shrink-0 mt-0.5",size:18}):(0,a.jsx)(P.Z,{className:"text-amber-400 shrink-0 mt-0.5",size:18}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-amber-300",children:e.title}),(0,a.jsx)("p",{className:"text-surface-300 text-sm mt-1",children:e.content})]})]})},e.id)),g.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[!d&&g.length>0&&(0,a.jsxs)("button",{onClick:()=>m(!0),className:"w-full p-3 rounded-xl bg-surface-800/50 border border-surface-700 text-surface-400 text-sm hover:bg-surface-800 transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)(P.Z,{size:16}),g.length," announcement",g.length>1?"s":""]}),(0,a.jsx)(r.M,{children:d&&g.map(e=>(0,a.jsx)(i.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-3 rounded-xl bg-surface-800/50 border border-surface-700",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(P.Z,{className:"text-surface-500 shrink-0 mt-0.5",size:16}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-surface-200",children:e.title}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mt-1",children:e.content})]}),(0,a.jsx)("button",{onClick:()=>p(e.id),className:"text-surface-500 hover:text-surface-300 p-1",children:(0,a.jsx)(L.Z,{size:16})})]})},e.id))}),d&&(0,a.jsx)("button",{onClick:()=>m(!1),className:"text-surface-500 text-sm hover:text-surface-300",children:"Collapse"})]})]})}var O=t(8163),A=t(1375),M=t(2922),H=t(8633);function R(e){let{classId:s,studentId:t,onMissionComplete:r}=e,[n,c]=(0,l.useState)([]),[o,d]=(0,l.useState)(!0),[m,u]=(0,l.useState)(null),p=(0,b.createClient)();(0,l.useEffect)(()=>{h()},[s,t]);let h=async()=>{d(!0);let{data:e}=await p.from("missions").select("*").eq("class_id",s).eq("is_active",!0).order("created_at",{ascending:!1}),{data:a}=await p.from("mission_completions").select("mission_id").eq("student_id",t),l=new Set((null==a?void 0:a.map(e=>e.mission_id))||[]);c((e||[]).map(e=>({...e,is_completed:l.has(e.id)}))),d(!1)},f=async(e,a)=>{u(e),await p.from("mission_completions").insert({mission_id:e,student_id:t,completed_at:new Date().toISOString()});let{data:l}=await p.from("student_cores").select("battery_level").eq("student_id",t).single();if(l){let e=Math.min(100,(l.battery_level||0)+a.battery_reward);await p.from("student_cores").update({battery_level:e}).eq("student_id",t)}await p.from("student_activity_log").insert({student_id:t,class_id:s,activity_type:"mission_completed",activity_data:{mission_id:e,title:a.title}}),u(null),h(),null==r||r()},v={individual:O.Z,team:x.Z,class:A.Z},g=n.filter(e=>!e.is_completed),j=n.filter(e=>e.is_completed);return o?(0,a.jsx)("div",{className:"card p-6 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===n.length?null:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(w.Z,{className:"text-teal-400",size:20}),"Missions"]}),g.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:g.map(e=>{let s=v[e.mission_type];return e.deadline&&new Date(e.deadline)<new Date?null:(0,a.jsx)(i.E.div,{className:"card p-4 bg-gradient-to-r from-teal-900/20 to-surface-900 border-teal-500/30",whileHover:{scale:1.01},children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat("individual"===e.mission_type?"bg-blue-500/20 text-blue-400":"team"===e.mission_type?"bg-purple-500/20 text-purple-400":"bg-green-500/20 text-green-400"),children:(0,a.jsx)(s,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-surface-100",children:e.title}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mt-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-yellow-400",children:[(0,a.jsx)(k.Z,{size:14}),(0,a.jsxs)("span",{children:[e.xp_reward," XP"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-teal-400",children:[(0,a.jsx)(M.Z,{size:14}),(0,a.jsxs)("span",{children:["+",e.battery_reward,"%"]})]}),e.deadline&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-surface-500",children:[(0,a.jsx)(H.Z,{size:14}),(0,a.jsxs)("span",{children:["Due ",new Date(e.deadline).toLocaleDateString()]})]})]})]}),(0,a.jsx)("button",{onClick:()=>f(e.id,e),disabled:m===e.id,className:"px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white rounded-xl font-medium flex items-center gap-2 transition-colors disabled:opacity-50",children:m===e.id?(0,a.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}):(0,a.jsxs)(a.Fragment,{children:["Complete ",(0,a.jsx)(y.Z,{size:16})]})})]})},e.id)})}),j.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-surface-500 text-sm",children:["Completed (",j.length,")"]}),j.slice(0,3).map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-xl bg-surface-800/30 border border-surface-700/50 flex items-center gap-3 opacity-60",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg bg-green-500/20 text-green-400 flex items-center justify-center",children:(0,a.jsx)(Z.Z,{size:16})}),(0,a.jsx)("span",{className:"text-surface-400 line-through",children:e.title}),(0,a.jsxs)("span",{className:"text-green-400 text-xs ml-auto",children:["+",e.xp_reward," XP"]})]},e.id))]})]})}var B=t(3974);function G(e){var s,t;let{classId:n,studentId:c,onOpenSocratic:o}=e,[d,m]=(0,l.useState)([]),[x,u]=(0,l.useState)(!0),[p,h]=(0,l.useState)(null),[f,v]=(0,l.useState)(null),g=(0,b.createClient)();(0,l.useEffect)(()=>{w()},[n,c]);let w=async()=>{u(!0);let{data:e}=await g.from("media_lessons").select("*").eq("class_id",n).eq("is_active",!0).order("created_at",{ascending:!1}),{data:s}=await g.from("media_lesson_completions").select("media_lesson_id, watched_video, read_content, socratic_completed").eq("student_id",c),t={};null==s||s.forEach(e=>{t[e.media_lesson_id]=e}),m((e||[]).map(e=>({...e,completion:t[e.id]||{watched_video:!1,read_content:!1,socratic_completed:!1}}))),u(!1)},N=async(e,s)=>{v({id:e,type:s});let{data:t}=await g.from("media_lesson_completions").select("*").eq("media_lesson_id",e).eq("student_id",c).single();t?await g.from("media_lesson_completions").update({[s]:!0}).eq("id",t.id):await g.from("media_lesson_completions").insert({media_lesson_id:e,student_id:c,[s]:!0}),await g.from("student_activity_log").insert({student_id:c,class_id:n,activity_type:"watched_video"===s?"media_lesson_video_watched":"media_lesson_read",activity_data:{lesson_id:e}}),v(null),w()},k=async e=>{if(!e.socratic_prompt)return;let{data:s}=await g.from("media_lesson_completions").select("*").eq("media_lesson_id",e.id).eq("student_id",c).single();s||await g.from("media_lesson_completions").insert({media_lesson_id:e.id,student_id:c}),await g.from("student_activity_log").insert({student_id:c,class_id:n,activity_type:"media_lesson_socratic_started",activity_data:{lesson_id:e.id,title:e.title}}),null==o||o(e.socratic_prompt,e.id,e.title),h(null)};return x?(0,a.jsx)("div",{className:"card p-6 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===d.length?null:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(B.Z,{className:"text-purple-400",size:20}),"Media Lessons"]}),(0,a.jsx)("div",{className:"space-y-3",children:d.map(e=>{var s,t,l;let r=null===(s=e.completion)||void 0===s?void 0:s.watched_video,n=null===(t=e.completion)||void 0===t?void 0:t.read_content,c=null===(l=e.completion)||void 0===l?void 0:l.socratic_completed,o="video"===e.media_type||"both"===e.media_type,d="reading"===e.media_type||"both"===e.media_type,m=e.socratic_prompt&&(!o||r)&&(!d||n),x=(!o||r)&&(!d||n)&&(!e.socratic_prompt||c);return(0,a.jsx)(i.E.div,{className:"card p-4 cursor-pointer ".concat(x?"opacity-60":"bg-gradient-to-r from-purple-900/20 to-surface-900 border-purple-500/30"),onClick:()=>h(e),whileHover:{scale:1.01},children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat(x?"bg-green-500/20 text-green-400":"video"===e.media_type?"bg-red-500/20 text-red-400":"reading"===e.media_type?"bg-blue-500/20 text-blue-400":"bg-purple-500/20 text-purple-400"),children:x?(0,a.jsx)(Z.Z,{size:20}):"video"===e.media_type?(0,a.jsx)(B.Z,{size:20}):"reading"===e.media_type?(0,a.jsx)(_.Z,{size:20}):(0,a.jsx)(C.Z,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold ".concat(x?"text-surface-400 line-through":"text-surface-100"),children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-xs",children:[o&&(0,a.jsxs)("span",{className:"flex items-center gap-1 ".concat(r?"text-green-400":"text-surface-500"),children:[(0,a.jsx)(B.Z,{size:12}),r?"Watched":"Video"]}),d&&(0,a.jsxs)("span",{className:"flex items-center gap-1 ".concat(n?"text-green-400":"text-surface-500"),children:[(0,a.jsx)(_.Z,{size:12}),n?"Read":"Reading"]}),e.socratic_prompt&&(0,a.jsxs)("span",{className:"flex items-center gap-1 ".concat(c?"text-green-400":m?"text-purple-400":"text-surface-500"),children:[(0,a.jsx)(j.Z,{size:12}),c?"Discussed":"Discuss with AI"]})]}),e.due_date&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-surface-500 text-xs mt-2",children:[(0,a.jsx)(H.Z,{size:12}),"Due ",new Date(e.due_date).toLocaleDateString()]})]}),(0,a.jsx)(y.Z,{size:16,className:"text-surface-500"})]})},e.id)})}),(0,a.jsx)(r.M,{children:p&&(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4",onClick:()=>h(null),children:(0,a.jsxs)(i.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between sticky top-0 bg-surface-900 z-10",children:[(0,a.jsx)("h2",{className:"font-semibold text-surface-100",children:p.title}),(0,a.jsx)("button",{onClick:()=>h(null),className:"text-surface-500 hover:text-surface-300",children:(0,a.jsx)(L.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)] space-y-6",children:[p.video_url&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(B.Z,{size:18,className:"text-red-400"}),"Video"]}),!(null===(s=p.completion)||void 0===s?void 0:s.watched_video)&&(0,a.jsxs)("button",{onClick:()=>N(p.id,"watched_video"),disabled:(null==f?void 0:f.id)===p.id,className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded-lg text-sm flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{size:14})," Mark Watched"]})]}),(0,a.jsx)("div",{className:"aspect-video bg-black rounded-xl overflow-hidden",children:(0,a.jsx)("iframe",{src:(e=>{let s=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);return s?"https://www.youtube.com/embed/".concat(s[1]):e})(p.video_url),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}),p.reading_content&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(_.Z,{size:18,className:"text-blue-400"}),"Reading"]}),!(null===(t=p.completion)||void 0===t?void 0:t.read_content)&&(0,a.jsxs)("button",{onClick:()=>N(p.id,"read_content"),disabled:(null==f?void 0:f.id)===p.id,className:"px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded-lg text-sm flex items-center gap-1",children:[(0,a.jsx)(Z.Z,{size:14})," Mark Read"]})]}),(0,a.jsx)("div",{className:"p-4 bg-surface-800 rounded-xl text-surface-300 text-sm whitespace-pre-wrap max-h-80 overflow-y-auto leading-relaxed",children:p.reading_content})]}),p.socratic_prompt&&(0,a.jsxs)("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-xl",children:[(0,a.jsxs)("h3",{className:"font-semibold text-purple-300 flex items-center gap-2 mb-2",children:[(0,a.jsx)(j.Z,{size:18}),"Discuss with AI"]}),(0,a.jsx)("p",{className:"text-surface-400 text-sm mb-4",children:"After consuming the media, have a Socratic discussion to deepen your understanding."}),(()=>{var e,s,t,l;let i="video"===p.media_type||"both"===p.media_type,r="reading"===p.media_type||"both"===p.media_type,n=(!i||(null===(e=p.completion)||void 0===e?void 0:e.watched_video))&&(!r||(null===(s=p.completion)||void 0===s?void 0:s.read_content));return(null===(t=p.completion)||void 0===t?void 0:t.socratic_completed)?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-green-400",children:[(0,a.jsx)(Z.Z,{size:18}),"Discussion completed!"]}):n?(0,a.jsxs)("button",{onClick:()=>k(p),className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-xl font-medium flex items-center gap-2",children:[(0,a.jsx)(j.Z,{size:18}),"Start Discussion"]}):(0,a.jsxs)("p",{className:"text-surface-500 text-sm",children:["Complete the ",!i||(null===(l=p.completion)||void 0===l?void 0:l.watched_video)?"reading":"video"," first to unlock discussion."]})})()]})]})]})})})]})}let F={1:"courage",2:"care",3:"community",4:"creation"};function W(e){let{lesson:s,progress:t,world:l,onDoNowClick:r,onScenarioClick:n,onChallengeClick:c,onTextAnchorComplete:d,onMediaComplete:m,classId:u,studentId:p,onOpenSocraticForMedia:h}=e,v=(null==t?void 0:t.do_now_complete)&&(null==t?void 0:t.text_anchor_complete)&&(null==t?void 0:t.media_complete)&&(null==t?void 0:t.scenario_complete)&&(null==t?void 0:t.challenge_complete),b=[],g=[];return(null==t?void 0:t.do_now_complete)?g.push({type:"do_now",label:"Do Now"}):b.push({type:"do_now",label:"Complete Do Now for today's lesson"}),!(null==t?void 0:t.scenario_complete)&&(null==t?void 0:t.media_complete)?b.push({type:"scenario",label:"Socratic Scenario - Apply your knowledge"}):(null==t?void 0:t.scenario_complete)&&g.push({type:"scenario",label:"Socratic Scenario"}),!(null==t?void 0:t.challenge_complete)&&(null==t?void 0:t.scenario_complete)?b.push({type:"challenge",label:"Real-World Challenge - Prove it in action"}):(null==t?void 0:t.challenge_complete)&&g.push({type:"challenge",label:"Real-World Challenge"}),(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[u&&(0,a.jsx)(T,{classId:u}),!(null==t?void 0:t.do_now_complete)&&(0,a.jsxs)(i.E.div,{className:"card p-6 bg-gradient-to-r from-primary-900/40 to-surface-900 border-primary-700/50 relative overflow-hidden",whileHover:{scale:1.01},children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-primary-400 text-sm font-semibold mb-3",children:[(0,a.jsx)(i.E.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},children:(0,a.jsx)(j.Z,{size:18})}),"START HERE — TODAY'S DO NOW"]}),(0,a.jsxs)("h2",{className:"text-xl font-bold text-surface-100 mb-2",children:['"',null==s?void 0:s.compelling_question,'"']}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"5-minute Socratic conversation to prime your brain for today's skill."})]}),(0,a.jsxs)(i.E.button,{onClick:r,className:"px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-medium flex items-center gap-2 whitespace-nowrap",whileHover:{scale:1.05},whileTap:{scale:.95},children:["Begin ",(0,a.jsx)(y.Z,{size:18})]})]})})]}),(0,a.jsxs)("div",{className:"card p-6 phase-".concat(null==s?void 0:s.phase_id),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center bg-".concat(F[null==s?void 0:s.phase_id],"/20"),children:(0,a.jsx)(w.Z,{className:"text-".concat(F[null==s?void 0:s.phase_id]),size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs font-medium bg-".concat(F[null==s?void 0:s.phase_id],"/20 text-").concat(F[null==s?void 0:s.phase_id]),children:["Lesson ",null==s?void 0:s.id," of 45"]}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-surface-100 mt-1",children:null==s?void 0:s.skill_name})]})]}),(0,a.jsx)("p",{className:"text-surface-400",children:null==s?void 0:s.lesson_objective})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(N.Z,{size:20,className:"text-primary-400"}),"Your Pathway"]}),(0,a.jsx)(J,{icon:j.Z,title:"Do Now",subtitle:"Warm up your brain",complete:(null==t?void 0:t.do_now_complete)||!1,locked:!1,reward:"\uD83C\uDF38 Flower",onClick:r}),(0,a.jsx)(J,{icon:_.Z,title:(null==s?void 0:s.text_anchor_title)||"Text Anchor",subtitle:"Read ".concat((null==s?void 0:s.text_anchor_chapter)||"Chapter"),complete:(null==t?void 0:t.text_anchor_complete)||!1,locked:!(null==t?void 0:t.do_now_complete),reward:"\uD83E\uDEA8 Stone",onClick:d}),(0,a.jsx)(J,{icon:C.Z,title:(null==s?void 0:s.media_title)||"Media",subtitle:"Watch & reflect",complete:(null==t?void 0:t.media_complete)||!1,locked:!(null==t?void 0:t.text_anchor_complete),reward:"\uD83E\uDEA8 Stone",onClick:m,mediaUrl:null==s?void 0:s.media_url}),(0,a.jsx)(J,{icon:k.Z,title:"Socratic Scenario",subtitle:"Apply your knowledge",complete:(null==t?void 0:t.scenario_complete)||!1,locked:!(null==t?void 0:t.media_complete),reward:"\uD83C\uDF32 Tree",onClick:n}),(0,a.jsx)(J,{icon:S.Z,title:"Real-World Challenge",subtitle:"Prove it in action",complete:(null==t?void 0:t.challenge_complete)||!1,locked:!(null==t?void 0:t.scenario_complete),reward:"\uD83C\uDFDB️ Tower",onClick:c})]}),v&&(0,a.jsxs)(i.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"card p-8 text-center bg-gradient-to-br from-green-900/30 to-surface-900 border-green-500/30",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(z.Z,{className:"w-16 h-16 text-green-400"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"Great! You are all caught up!"}),(0,a.jsx)("p",{className:"text-surface-400 mb-6",children:"You've completed all tasks for this lesson. Here's what you can do next:"}),(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsxs)(I.default,{href:"#",className:"flex items-center gap-3 p-4 bg-surface-800/50 rounded-xl hover:bg-surface-700/50 transition-colors text-left",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"text-purple-400",size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Create your own challenge"}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:"Design a leadership challenge for classmates"})]})]}),(0,a.jsxs)(I.default,{href:"#",className:"flex items-center gap-3 p-4 bg-surface-800/50 rounded-xl hover:bg-surface-700/50 transition-colors text-left",onClick:()=>window.dispatchEvent(new CustomEvent("switchTab",{detail:"world"})),children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-primary-500/20 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"text-primary-400",size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Explore your world"}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:"Build and customize your leadership world"})]})]}),(0,a.jsxs)(I.default,{href:"#",className:"flex items-center gap-3 p-4 bg-surface-800/50 rounded-xl hover:bg-surface-700/50 transition-colors text-left",onClick:()=>window.dispatchEvent(new CustomEvent("switchTab",{detail:"commons"})),children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-care/20 flex items-center justify-center",children:(0,a.jsx)(x.Z,{className:"text-care",size:20})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Check help requests"}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:"Help classmates with their challenges"})]})]})]})]}),b.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-surface-200 flex items-center gap-2",children:[(0,a.jsx)(k.Z,{size:20,className:"text-primary-400"}),"Active Tasks"]}),b.map(e=>(0,a.jsxs)(i.E.button,{onClick:()=>{"do_now"===e.type?r():"scenario"===e.type?n():"challenge"===e.type&&c()},className:"w-full p-4 rounded-xl border bg-primary-900/20 border-primary-500/30 flex items-center gap-4 transition-all text-left hover:border-primary-400",whileHover:{scale:1.01},whileTap:{scale:.99},children:[(0,a.jsxs)("div",{className:"w-10 h-10 rounded-lg bg-primary-500/20 text-primary-400 flex items-center justify-center",children:["do_now"===e.type&&(0,a.jsx)(j.Z,{size:20}),"scenario"===e.type&&(0,a.jsx)(k.Z,{size:20}),"challenge"===e.type&&(0,a.jsx)(S.Z,{size:20})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:e.label}),(0,a.jsx)("p",{className:"text-xs text-surface-500",children:"Click to start"})]}),(0,a.jsx)(y.Z,{size:18,className:"text-primary-400"})]},e.type))]}),g.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-surface-500 flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{size:20}),"Completed"]}),g.map(e=>(0,a.jsxs)("div",{className:"w-full p-4 rounded-xl border bg-surface-800/30 border-surface-700/50 flex items-center gap-4 opacity-60",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-green-500/20 text-green-400 flex items-center justify-center",children:(0,a.jsx)(Z.Z,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-surface-400 line-through",children:e.label}),(0,a.jsx)("p",{className:"text-xs text-surface-600",children:"Completed"})]}),(0,a.jsx)("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded-full",children:"Done"})]},e.type))]}),u&&p&&(0,a.jsx)(R,{classId:u,studentId:p}),u&&p&&(0,a.jsx)(G,{classId:u,studentId:p,onOpenSocratic:h}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Today's Progress"}),(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-2 text-center",children:[(0,a.jsx)(Y,{label:"Trees",value:(null==l?void 0:l.trees)||0,icon:"tree"}),(0,a.jsx)(Y,{label:"Flowers",value:(null==l?void 0:l.flowers)||0,icon:"flower"}),(0,a.jsx)(Y,{label:"Stones",value:(null==l?void 0:l.stones)||0,icon:"stone"}),(0,a.jsx)(Y,{label:"Tower",value:(null==l?void 0:l.tower)||0,icon:"tower"}),(0,a.jsx)(Y,{label:"Helped",value:(null==l?void 0:l.help_given)||0,icon:"help"})]})]})]},"home")}function J(e){let{icon:s,title:t,subtitle:l,complete:r,locked:n,reward:c,onClick:o,mediaUrl:d}=e;return(0,a.jsxs)(i.E.button,{onClick:()=>{if(!r&&!n){if(d){window.open(d,"_blank"),o();return}o()}},disabled:n,className:"w-full p-4 rounded-xl border flex items-center gap-4 transition-all text-left ".concat(r?"bg-green-500/10 border-green-500/30":n?"bg-surface-800/50 border-surface-700 opacity-50 cursor-not-allowed":"bg-surface-800/50 border-surface-700 hover:border-primary-500/50 hover:bg-surface-800"),whileHover:n||r?{}:{scale:1.01},whileTap:n||r?{}:{scale:.99},children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat(r?"bg-green-500/20 text-green-400":n?"bg-surface-700 text-surface-500":"bg-primary-500/20 text-primary-400"),children:r?(0,a.jsx)(Z.Z,{size:20}):n?(0,a.jsx)(D.Z,{size:20}):(0,a.jsx)(s,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium ".concat(r?"text-green-400":"text-surface-200"),children:t}),(0,a.jsx)("p",{className:"text-xs text-surface-500",children:l})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("span",{className:"text-lg",children:c.split(" ")[0]}),(0,a.jsx)("p",{className:"text-xs text-surface-500",children:c.split(" ")[1]})]}),!r&&!n&&(0,a.jsx)(y.Z,{size:18,className:"text-surface-500"})]})}function Y(e){let{label:s,value:t,icon:l}=e;return(0,a.jsxs)("div",{className:"p-2 bg-surface-800/50 rounded-lg",children:[(0,a.jsx)("div",{className:"flex justify-center mb-1",children:(()=>{switch(l){case"tree":return(0,a.jsx)("svg",{className:"w-6 h-6 text-green-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 2L4 12h4v8h8v-8h4L12 2z"})});case"flower":return(0,a.jsxs)("svg",{className:"w-6 h-6 text-pink-400",fill:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,a.jsx)("circle",{cx:"12",cy:"6",r:"2"}),(0,a.jsx)("circle",{cx:"18",cy:"12",r:"2"}),(0,a.jsx)("circle",{cx:"12",cy:"18",r:"2"}),(0,a.jsx)("circle",{cx:"6",cy:"12",r:"2"})]});case"stone":return(0,a.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("ellipse",{cx:"12",cy:"14",rx:"8",ry:"6"})});case"tower":return(0,a.jsx)("svg",{className:"w-6 h-6 text-yellow-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 2L8 8h2v6H8v6h8v-6h-2V8h2L12 2z"})});case"help":return(0,a.jsx)(x.Z,{className:"w-6 h-6 text-blue-400"});default:return null}})()}),(0,a.jsx)("div",{className:"text-lg font-bold text-white",children:t}),(0,a.jsx)("div",{className:"text-xs text-surface-500",children:s})]})}var U=t(4307),V=t(4428),X=t(2113),K=t(9045),Q=t(795),$=t(9496),ee=t(1701),es=t(2294);let et=(0,v.default)(()=>Promise.all([t.e(375),t.e(356),t.e(532),t.e(677),t.e(737)]).then(t.bind(t,1737)),{loadableGenerated:{webpack:()=>[1737]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"w-full aspect-video bg-surface-900 rounded-2xl flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-surface-400 animate-pulse",children:"Loading 3D World..."})})});function ea(e){let{world:s,userName:t,placedItems:l,inventoryItems:r,discoveredSecrets:n,onItemPlace:c,onBrainstormOpen:o}=e,d=((null==s?void 0:s.trees)||0)+((null==s?void 0:s.flowers)||0)+((null==s?void 0:s.tower)||0)+((null==s?void 0:s.bridge)||0);return(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(et,{world:s,userName:t,placedItems:l,discoveredSecrets:n,inventoryItems:r,onItemPlace:c,onOpenBrainstorm:o}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 bg-black/60 backdrop-blur-sm rounded-lg px-3 py-2 text-xs text-white",children:[(0,a.jsxs)("div",{className:"font-semibold mb-1",children:[t,"'s World"]}),(0,a.jsxs)("div",{className:"text-surface-300",children:[d," items placed"]})]}),(0,a.jsxs)("div",{className:"absolute bottom-4 right-4 bg-black/60 backdrop-blur-sm rounded-lg px-3 py-2 text-xs text-surface-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(U.Z,{size:12}),(0,a.jsx)("span",{children:"Controls"})]}),(0,a.jsx)("div",{children:"WASD - Move"}),(0,a.jsx)("div",{children:"P - Place items"}),(0,a.jsx)("div",{children:"E - Interact"}),(0,a.jsx)("div",{children:"B - Brainstorm"})]})]}),r.length>0&&(0,a.jsxs)(i.E.div,{className:"card p-4 border-yellow-500/30 bg-gradient-to-r from-yellow-900/20 to-surface-900",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-yellow-400 flex items-center gap-2",children:[(0,a.jsx)(V.Z,{size:16}),"Items Ready to Place"]}),(0,a.jsx)("div",{className:"text-xs text-surface-400",children:"Press P in world to build"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-surface-800 rounded-lg",children:[(0,a.jsxs)("span",{className:"text-lg",children:["tree"===e.type&&"\uD83C\uDF32","flower"===e.type&&"\uD83C\uDF38","tower"===e.type&&"\uD83C\uDFDB️","crystal"===e.type&&"\uD83D\uDC8E","stone"===e.type&&"\uD83E\uDEA8"]}),(0,a.jsxs)("span",{className:"font-bold text-white",children:["\xd7",e.count]})]},s))})]}),0===r.length&&(0,a.jsxs)("div",{className:"card p-4 border-dashed border-surface-600 text-center",children:[(0,a.jsx)(X.Z,{size:24,className:"mx-auto mb-2 text-surface-500"}),(0,a.jsx)("p",{className:"text-surface-400 text-sm",children:"Complete activities to earn building items!"}),(0,a.jsx)("p",{className:"text-surface-500 text-xs mt-1",children:"Do Nows → Flowers | Scenarios → Trees | Challenges → Towers"})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Your Resources"}),(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-3",children:[(0,a.jsx)(el,{icon:K.Z,count:(null==s?void 0:s.trees)||0,label:"Trees",color:"text-green-400",bgColor:"bg-green-500/20"}),(0,a.jsx)(el,{icon:Q.Z,count:(null==s?void 0:s.flowers)||0,label:"Flowers",color:"text-pink-400",bgColor:"bg-pink-500/20"}),(0,a.jsx)(el,{icon:$.Z,count:(null==s?void 0:s.tower)||0,label:"Tower",color:"text-blue-400",bgColor:"bg-blue-500/20"}),(0,a.jsx)(el,{icon:ee.Z,count:(null==s?void 0:s.bridge)||0,label:"Bridge",color:"text-purple-400",bgColor:"bg-purple-500/20"}),(0,a.jsx)(el,{icon:es.Z,count:(null==s?void 0:s.crystals)||0,label:"Crystals",color:"text-cyan-400",bgColor:"bg-cyan-500/20"})]})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:"Journey Progress"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(ei,{label:"Self-Leadership",progress:(null==s?void 0:s.phase1_progress)||0,color:"bg-courage"}),(0,a.jsx)(ei,{label:"Team Leadership",progress:(null==s?void 0:s.phase2_progress)||0,color:"bg-care"}),(0,a.jsx)(ei,{label:"Community Leadership",progress:(null==s?void 0:s.phase3_progress)||0,color:"bg-community"}),(0,a.jsx)(ei,{label:"Legacy Leadership",progress:(null==s?void 0:s.phase4_progress)||0,color:"bg-creation"})]})]}),n.length>0&&(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-surface-300 mb-3",children:["\uD83D\uDD2E Secrets Discovered (",n.length,")"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map((e,s)=>(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 rounded-full text-xs",children:e},s))})]})]},"world")}function el(e){let{icon:s,count:t,label:l,color:i,bgColor:r}=e;return(0,a.jsxs)("div",{className:"text-center p-3 bg-surface-800/50 rounded-xl",children:[(0,a.jsx)("div",{className:"w-10 h-10 mx-auto mb-2 rounded-lg ".concat(r," flex items-center justify-center"),children:(0,a.jsx)(s,{className:i,size:20})}),(0,a.jsx)("div",{className:"text-xl font-bold text-white",children:t}),(0,a.jsx)("div",{className:"text-xs text-surface-500",children:l})]})}function ei(e){let{label:s,progress:t,color:l}=e;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,a.jsx)("span",{className:"text-surface-400",children:s}),(0,a.jsxs)("span",{className:"text-surface-300 font-medium",children:[t,"%"]})]}),(0,a.jsx)("div",{className:"h-2 bg-surface-800 rounded-full overflow-hidden",children:(0,a.jsx)(i.E.div,{className:"h-full ".concat(l," rounded-full"),initial:{width:0},animate:{width:"".concat(t,"%")},transition:{duration:.5,ease:"easeOut"}})})]})}var er=t(5698),en=t(9701),ec=t(732);let eo={academic:_.Z,technical:er.Z,creative:f.Z,personal:en.Z,other:U.Z},ed={academic:"text-blue-400 bg-blue-500/20",technical:"text-green-400 bg-green-500/20",creative:"text-purple-400 bg-purple-500/20",personal:"text-pink-400 bg-pink-500/20",other:"text-gray-400 bg-gray-500/20"};function em(e){let{helpRequests:s,userId:t,classId:n,onRefresh:c}=e,[o,d]=(0,l.useState)(!1),m=(0,b.createClient)(),u=async e=>{await m.from("help_requests").update({helper_id:t,status:"in_progress"}).eq("id",e),t&&(await m.rpc("increment_help_given",{p_student_id:t}),await m.rpc("increment_bridge",{p_student_id:t})),c()};return(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"text-purple-400"}),"The Commons"]}),(0,a.jsx)("p",{className:"text-sm text-surface-400",children:"Help others, grow together"})]}),(0,a.jsxs)(i.E.button,{onClick:()=>d(!0),className:"px-4 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-medium flex items-center gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,a.jsx)(ec.Z,{size:18}),"Ask for Help"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"card p-3 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:s.length}),(0,a.jsx)("div",{className:"text-xs text-surface-400",children:"Open Requests"})]}),(0,a.jsxs)("div",{className:"card p-3 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-pink-400",children:"0"}),(0,a.jsx)("div",{className:"text-xs text-surface-400",children:"You've Helped"})]}),(0,a.jsxs)("div",{className:"card p-3 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-400",children:"0"}),(0,a.jsx)("div",{className:"text-xs text-surface-400",children:"Helped You"})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:0===s.length?(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)(en.Z,{className:"mx-auto mb-3 text-surface-500",size:40}),(0,a.jsx)("h3",{className:"font-semibold text-surface-300 mb-1",children:"No open requests"}),(0,a.jsx)("p",{className:"text-sm text-surface-500",children:"When classmates need help, their requests will appear here."})]}):s.map(e=>{let s=eo[e.category]||U.Z,t=ed[e.category]||ed.other;return(0,a.jsx)(i.E.div,{className:"card p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat(t),children:(0,a.jsx)(s,{size:20})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-surface-300",children:["\uD83C\uDFAD ",e.anonymous_name]}),(0,a.jsxs)("span",{className:"text-xs text-surface-500",children:[(0,a.jsx)(h.Z,{size:12,className:"inline mr-1"}),new Date(e.created_at).toLocaleDateString()]})]}),(0,a.jsx)("h4",{className:"font-semibold text-white mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-surface-400",children:e.description})]}),(0,a.jsxs)(i.E.button,{onClick:()=>u(e.id),className:"px-3 py-2 bg-pink-500/20 hover:bg-pink-500/30 text-pink-400 rounded-lg text-sm font-medium flex items-center gap-1",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,a.jsx)(en.Z,{size:14}),"Help"]})]})},e.id)})}),(0,a.jsx)(r.M,{children:o&&(0,a.jsx)(ex,{userId:t,classId:n,onClose:()=>d(!1),onSuccess:()=>{d(!1),c()}})})]},"commons")}function ex(e){let{userId:s,classId:t,onClose:r,onSuccess:n}=e,[c,o]=(0,l.useState)(""),[d,m]=(0,l.useState)(""),[x,u]=(0,l.useState)("academic"),[p,h]=(0,l.useState)(!1),v=(0,b.createClient)(),g=async e=>{e.preventDefault(),h(!0);let a=["Swift","Bright","Calm","Noble","Wise","Kind","Bold","Gentle"],l=["Phoenix","Eagle","Oak","River","Star","Mountain","Wave","Wind"],i="".concat(a[Math.floor(Math.random()*a.length)]," ").concat(l[Math.floor(Math.random()*l.length)]);await v.from("help_requests").insert({requester_id:s,class_id:t,title:c,description:d,category:x,anonymous_name:i}),h(!1),n()},j=[{id:"academic",label:"Academic",icon:_.Z},{id:"technical",label:"Technical",icon:er.Z},{id:"creative",label:"Creative",icon:f.Z},{id:"personal",label:"Personal",icon:en.Z},{id:"other",label:"Other",icon:U.Z}];return(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(i.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-md",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"font-semibold text-white",children:"Ask for Help"}),(0,a.jsx)("button",{onClick:r,className:"text-surface-400 hover:text-white",children:(0,a.jsx)(L.Z,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:g,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"What do you need help with?"}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"Brief title...",className:"w-full bg-surface-800 border border-surface-700 rounded-xl px-4 py-2 text-white placeholder:text-surface-500 focus:border-primary-500 outline-none",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Category"}),(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2",children:j.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>u(e.id),className:"p-2 rounded-lg flex flex-col items-center gap-1 transition-colors ".concat(x===e.id?"bg-primary-500/20 border border-primary-500":"bg-surface-800 border border-transparent hover:border-surface-600"),children:[(0,a.jsx)(e.icon,{size:18,className:x===e.id?"text-primary-400":"text-surface-400"}),(0,a.jsx)("span",{className:"text-xs",children:e.label})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-surface-300 mb-1",children:"Details"}),(0,a.jsx)("textarea",{value:d,onChange:e=>m(e.target.value),placeholder:"Describe what you're struggling with...",className:"w-full h-24 bg-surface-800 border border-surface-700 rounded-xl px-4 py-2 text-white placeholder:text-surface-500 focus:border-primary-500 outline-none resize-none",required:!0})]}),(0,a.jsx)("div",{className:"bg-surface-800/50 rounded-lg p-3 text-sm text-surface-400",children:"\uD83D\uDCA1 Your request will be posted anonymously. Someone who can help will reach out!"}),(0,a.jsx)("button",{type:"submit",disabled:p||!c||!d,className:"w-full py-3 bg-primary-600 hover:bg-primary-500 disabled:bg-surface-700 text-white rounded-xl font-medium transition-colors",children:p?"Posting...":"Post Request"})]})]})})}let eu=(0,v.default)(()=>t.e(534).then(t.bind(t,5534)),{loadableGenerated:{webpack:()=>[5534]},ssr:!1}),ep=(0,v.default)(()=>t.e(444).then(t.bind(t,9444)),{loadableGenerated:{webpack:()=>[9444]},ssr:!1});function eh(e){let{teacherChallenges:s,discoveries:t,userId:l,classId:r,onChallengeSubmit:n,onDiscoveryPost:c,onDiscoveryVote:o}=e;return(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"text-yellow-400"}),"Discover"]}),(0,a.jsx)("p",{className:"text-sm text-surface-400",children:"Teacher challenges & student discoveries"})]}),(0,a.jsx)(eu,{challenges:s,onSubmitResponse:n}),(0,a.jsx)(ep,{discoveries:t,onPost:c,onVote:o,onComment:()=>{}})]},"discover")}var ef=t(2926);let ev=(0,v.default)(()=>t.e(348).then(t.bind(t,4348)),{loadableGenerated:{webpack:()=>[4348]},ssr:!1}),eb=(0,v.default)(()=>t.e(631).then(t.bind(t,2631)),{loadableGenerated:{webpack:()=>[2631]},ssr:!1});function eg(e){let{world:s,currentLesson:t,journalData:r,connectionMapData:n,userId:c}=e,[o,d]=(0,l.useState)("overview");return"journal"===o?(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[(0,a.jsx)("button",{onClick:()=>d("overview"),className:"mb-4 text-sm text-primary-400 hover:text-primary-300 flex items-center gap-1",children:"← Back to Progress"}),(0,a.jsx)(ev,{weeks:(null==r?void 0:r.weeks)||[],totalDaysActive:(null==r?void 0:r.totalDaysActive)||0,longestStreak:(null==r?void 0:r.longestStreak)||0,totalRipples:(null==r?void 0:r.totalRipples)||0,skillsLearned:(null==r?void 0:r.skillsLearned)||[]})]},"journal"):"connections"===o?(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:[(0,a.jsx)("button",{onClick:()=>d("overview"),className:"mb-4 text-sm text-primary-400 hover:text-primary-300 flex items-center gap-1",children:"← Back to Progress"}),(0,a.jsx)(eb,{students:(null==n?void 0:n.students)||[],connections:(null==n?void 0:n.connections)||[],currentUserId:c||"",classStats:(null==n?void 0:n.stats)||{totalConnections:0,totalRipples:0,averageHelpPerStudent:0}})]},"connections"):(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(p.Z,{className:"text-yellow-400"}),"Your Progress"]}),(0,a.jsx)("p",{className:"text-sm text-surface-400",children:"Track your leadership journey"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-white",children:t}),(0,a.jsx)("div",{className:"text-sm text-surface-400",children:"Lessons Complete"})]}),(0,a.jsxs)("div",{className:"card p-4 text-center",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-primary-400",children:[Math.round((t-1)/45*100),"%"]}),(0,a.jsx)("div",{className:"text-sm text-surface-400",children:"Journey Progress"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(ej,{phase:1,name:"Self-Leadership",description:"Understanding yourself as a leader",progress:(null==s?void 0:s.phase1_progress)||0,lessons:"1-12",color:"courage",currentLesson:t}),(0,a.jsx)(ej,{phase:2,name:"Team Leadership",description:"Leading and collaborating with others",progress:(null==s?void 0:s.phase2_progress)||0,lessons:"13-24",color:"care",currentLesson:t}),(0,a.jsx)(ej,{phase:3,name:"Community Leadership",description:"Making impact beyond your circle",progress:(null==s?void 0:s.phase3_progress)||0,lessons:"25-36",color:"community",currentLesson:t}),(0,a.jsx)(ej,{phase:4,name:"Legacy Leadership",description:"Creating lasting change",progress:(null==s?void 0:s.phase4_progress)||0,lessons:"37-45",color:"creation",currentLesson:t})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-surface-300",children:"Deep Dive"}),(0,a.jsxs)("button",{onClick:()=>d("journal"),className:"w-full card p-4 flex items-center justify-between hover:border-primary-500/50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center",children:(0,a.jsx)(_.Z,{className:"text-purple-400",size:20})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Growth Journal"}),(0,a.jsx)("p",{className:"text-xs text-surface-400",children:"Your complete journey timeline"})]})]}),(0,a.jsx)(y.Z,{className:"text-surface-500",size:20})]}),(0,a.jsxs)("button",{onClick:()=>d("connections"),className:"w-full card p-4 flex items-center justify-between hover:border-primary-500/50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:(0,a.jsx)(ef.Z,{className:"text-cyan-400",size:20})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("h4",{className:"font-medium text-white",children:"Class Connections"}),(0,a.jsx)("p",{className:"text-xs text-surface-400",children:"See how the class is connected"})]})]}),(0,a.jsx)(y.Z,{className:"text-surface-500",size:20})]})]})]},"progress")}function ej(e){let{phase:s,name:t,description:l,progress:r,lessons:n,color:c,currentLesson:o}=e,d=n.split("-").map(Number),m=o>=d[0]&&o<=d[1],x=o<d[0];return(0,a.jsxs)("div",{className:"card p-4 ".concat(m?"border-".concat(c,"/50"):""," ").concat(x?"opacity-50":""),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-".concat(c,"/20 flex items-center justify-center text-lg font-bold text-").concat(c),children:s}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-white",children:t}),r>=100&&(0,a.jsx)("span",{className:"text-green-400",children:"✓"}),m&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-primary-500/20 text-primary-400 rounded-full",children:"Current"})]}),(0,a.jsx)("p",{className:"text-xs text-surface-400",children:l})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-white",children:[r,"%"]}),(0,a.jsxs)("div",{className:"text-xs text-surface-500",children:["Lessons ",n]})]})]}),(0,a.jsx)("div",{className:"h-2 bg-surface-800 rounded-full overflow-hidden",children:(0,a.jsx)(i.E.div,{className:"h-full bg-".concat(c," rounded-full"),initial:{width:0},animate:{width:"".concat(r,"%")},transition:{duration:.5}})})]})}let ey=(0,v.default)(()=>t.e(114).then(t.bind(t,5626)),{loadableGenerated:{webpack:()=>[5626]},ssr:!1}),ew=(0,v.default)(()=>t.e(674).then(t.bind(t,7674)),{loadableGenerated:{webpack:()=>[7674]},ssr:!1}),eN=(0,v.default)(()=>t.e(854).then(t.bind(t,3854)),{loadableGenerated:{webpack:()=>[3854]},ssr:!1}),e_=(0,v.default)(()=>t.e(229).then(t.bind(t,3229)),{loadableGenerated:{webpack:()=>[3229]},ssr:!1}),eC=(0,v.default)(()=>t.e(481).then(t.bind(t,9481)),{loadableGenerated:{webpack:()=>[9481]},ssr:!1}),ek=(0,v.default)(()=>t.e(146).then(t.bind(t,4146)),{loadableGenerated:{webpack:()=>[4146]},ssr:!1}),eS=(0,v.default)(()=>Promise.all([t.e(375),t.e(435),t.e(532),t.e(729)]).then(t.bind(t,5729)),{loadableGenerated:{webpack:()=>[5729]},ssr:!1}),ez=(0,v.default)(()=>Promise.all([t.e(375),t.e(435),t.e(532),t.e(801)]).then(t.bind(t,1801)),{loadableGenerated:{webpack:()=>[1801]},ssr:!1}),eZ=(0,v.default)(()=>t.e(173).then(t.bind(t,4173)),{loadableGenerated:{webpack:()=>[4173]},ssr:!1});(0,v.default)(()=>t.e(875).then(t.bind(t,9875)),{loadableGenerated:{webpack:()=>[9875]},ssr:!1});let eD=(0,v.default)(()=>t.e(645).then(t.bind(t,6645)),{loadableGenerated:{webpack:()=>[6645]},ssr:!1}),eI=(0,v.default)(()=>Promise.all([t.e(285),t.e(747)]).then(t.bind(t,4747)),{loadableGenerated:{webpack:()=>[4747]},ssr:!1});(0,v.default)(()=>Promise.all([t.e(285),t.e(194)]).then(t.bind(t,2194)),{loadableGenerated:{webpack:()=>[2194]},ssr:!1}),(0,v.default)(()=>Promise.all([t.e(285),t.e(919)]).then(t.bind(t,5919)),{loadableGenerated:{webpack:()=>[5919]},ssr:!1}),(0,v.default)(()=>t.e(759).then(t.bind(t,9759)),{loadableGenerated:{webpack:()=>[9759]},ssr:!1});let eE={1:"Self-Leadership",2:"Team Leadership",3:"Community Leadership",4:"Legacy Leadership"};function eq(){var e,s;let{user:v,lesson:j,progress:y,world:w,helpRequests:N,teacherChallenges:_,discoveries:C,journalData:k,connectionMapData:S,placedItems:z,inventoryItems:Z,discoveredSecrets:D,gatewayComplete:I,dailyUnmaskData:E,studentSkills:q,loading:P,isOnline:L,error:T,loadData:O,handleLogout:A,refreshHelpRequests:M,markTextAnchorComplete:H,markMediaComplete:R,updateWorld:B,updateProgress:G}=function(){let e=(0,g.useRouter)(),s=(0,b.createClient)(),[t,a]=(0,l.useState)(null),[i,r]=(0,l.useState)(null),[n,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(null),[m,x]=(0,l.useState)([]),[u,p]=(0,l.useState)([]),[h,f]=(0,l.useState)([]),[v,j]=(0,l.useState)([]),[y,w]=(0,l.useState)(null),[N,_]=(0,l.useState)(null),[C,k]=(0,l.useState)([]),[S,z]=(0,l.useState)([]),[Z,D]=(0,l.useState)([]),[I,E]=(0,l.useState)(!1),[q,P]=(0,l.useState)(null),[L,T]=(0,l.useState)([]),[O,A]=(0,l.useState)(!0),[M,H]=(0,l.useState)(!0),[R,B]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=()=>H(!0),s=()=>H(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),H(navigator.onLine),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);let G=(0,l.useCallback)(async(e,s)=>{try{let t=await fetch("/api/challenges/teacher?classId=".concat(e,"&studentId=").concat(s));if(!t.ok)throw Error("Failed to load challenges");let a=await t.json();f(a.challenges||[])}catch(e){console.error("Error loading teacher challenges:",e)}},[]),F=(0,l.useCallback)(async(e,s)=>{try{let t=s?"/api/discoveries?classId=".concat(e,"&studentId=").concat(s):"/api/discoveries?classId=".concat(e),a=await fetch(t);if(!a.ok)throw Error("Failed to load discoveries");let l=await a.json();j(l.discoveries||[])}catch(e){console.error("Error loading discoveries:",e)}},[]),W=(0,l.useCallback)(async e=>{try{let s=await fetch("/api/journal?studentId=".concat(e));if(!s.ok)throw Error("Failed to load journal");let t=await s.json();w(t),T(t.skillsLearned||[])}catch(e){console.error("Error loading journal:",e)}},[]),J=(0,l.useCallback)(async e=>{try{let{data:t,error:a}=await s.from("placement_inventory").select("item_type, quantity").eq("student_id",e).gt("quantity",0);if(a){console.error("Error loading inventory:",a);return}t&&t.length>0&&z(t.map(e=>({type:e.item_type,count:e.quantity})))}catch(e){console.error("Error loading inventory:",e)}},[s]),Y=(0,l.useCallback)(async e=>{try{let{data:t}=await s.from("world_placements").select("*").eq("student_id",e);t&&k(t.map(e=>({id:e.id,type:e.item_type,variant:e.item_variant||0,x:e.pos_x,y:e.pos_y,z:e.pos_z,rotation:e.rotation_y||0,memory:e.earned_description,earnedFrom:e.earned_from})))}catch(e){console.error("Error loading placed items:",e)}},[s]),U=(0,l.useCallback)(async e=>{try{let{data:t}=await s.from("discovered_secrets").select("secret_name").eq("student_id",e);t&&D(t.map(e=>e.secret_name))}catch(e){console.error("Error loading secrets:",e)}},[s]),V=(0,l.useCallback)(async(e,t)=>{try{let{data:t}=await s.from("users").select("id, name, anonymous_name, is_unmasked").eq("class_id",e).eq("role","student"),{data:a}=await s.from("world_states").select("student_id, help_given").in("student_id",(null==t?void 0:t.map(e=>e.id))||[]),l=(null==t?void 0:t.map(e=>{let s=null==a?void 0:a.find(s=>s.student_id===e.id);return{id:e.id,name:e.name,anonymousName:e.anonymous_name||"Anonymous",isUnmasked:e.is_unmasked||!1,ripplesStarted:0,helpGiven:(null==s?void 0:s.help_given)||0,tier:1}}))||[],{data:i}=await s.from("help_requests").select("requester_id, helper_id").eq("class_id",e).eq("status","completed"),r=(null==i?void 0:i.map(e=>({from:e.helper_id,to:e.requester_id,strength:1,type:"help"})))||[];_({students:l,connections:r,stats:{totalConnections:r.length,totalRipples:0,averageHelpPerStudent:l.length>0?l.reduce((e,s)=>e+s.helpGiven,0)/l.length:0}})}catch(e){console.error("Error loading connection map:",e)}},[s]),X=(0,l.useCallback)(async()=>{B(null);try{let{data:{user:t}}=await s.auth.getUser();if(t){let{data:a}=await s.from("teachers").select("id").eq("auth_user_id",t.id).maybeSingle();if(a){e.push("/teacher");return}}let l=localStorage.getItem("leadership_user_id"),i=localStorage.getItem("leadership_user_name"),n=localStorage.getItem("leadership_class_id"),o=l,m=null;if(l&&i&&n){let{data:t}=await s.from("users").select("*").eq("id",l).single();if(t)m=t,o=t.id;else{localStorage.removeItem("leadership_user_id"),localStorage.removeItem("leadership_user_name"),localStorage.removeItem("leadership_class_id"),e.push("/");return}}else{let{data:{user:t}}=await s.auth.getUser();if(!t){e.push("/");return}let{data:a}=await s.from("users").select("*").eq("id",t.id).single();if(!a||"student"!==a.role){e.push("/");return}m=a,o=a.id,localStorage.setItem("leadership_user_id",a.id),localStorage.setItem("leadership_user_name",a.name),localStorage.setItem("leadership_class_id",a.class_id)}a(m),E((null==m?void 0:m.gateway_complete)||!1);let{data:u}=await s.from("classes").select("current_lesson_id").eq("id",m.class_id).single(),h=(null==u?void 0:u.current_lesson_id)||1,{data:f}=await s.from("lessons").select("*").eq("id",h).single();r(f);let{data:v}=await s.from("student_lessons").select("*").eq("student_id",o).eq("lesson_id",h).single();if(!v){let{data:e}=await s.from("student_lessons").insert({student_id:o,lesson_id:h,class_id:m.class_id,status:"available"}).select().single();v=e}c(v);let{data:b}=await s.from("world_states").select("*").eq("student_id",o).single();if(!b){let{data:e}=await s.from("world_states").insert({student_id:o}).select().single();b=e}d(b);let{data:g}=await s.from("help_requests").select("*").eq("class_id",m.class_id).eq("status","open").order("created_at",{ascending:!1}).limit(10);x(g||[]);let{data:j}=await s.from("civic_events").select("*").eq("class_id",m.class_id).order("created_at",{ascending:!1}).limit(10);p(j||[]),await Promise.all([G(m.class_id,o),F(m.class_id,o),W(o),V(m.class_id,o),J(o),Y(o),U(o)])}catch(e){console.error("Error loading data:",e),B("Failed to load data. Please refresh.")}finally{A(!1)}},[e,s,G,F,W,V,J,Y,U]),K=(0,l.useCallback)(async()=>{localStorage.removeItem("leadership_user_id"),localStorage.removeItem("leadership_user_name"),localStorage.removeItem("leadership_class_id"),localStorage.removeItem("leadership_draft_conversation"),await s.auth.signOut(),e.push("/")},[e,s]),Q=(0,l.useCallback)(async()=>{if(!t)return;let{data:e}=await s.from("help_requests").select("*").eq("class_id",t.class_id).eq("status","open").order("created_at",{ascending:!1}).limit(10);x(e||[])},[t,s]),$=(0,l.useCallback)(async()=>{t&&await F(t.class_id,t.id)},[t,F]),ee=(0,l.useCallback)(async()=>{n&&t&&i&&(await s.from("student_lessons").update({text_anchor_complete:!0,text_anchor_at:new Date().toISOString(),status:"in_progress"}).eq("student_id",t.id).eq("lesson_id",i.id),await s.from("world_states").update({stones:((null==o?void 0:o.stones)||0)+1,updated_at:new Date().toISOString()}).eq("student_id",t.id),c({...n,text_anchor_complete:!0,status:"in_progress"}),d(e=>e?{...e,stones:(e.stones||0)+1}:null))},[n,t,i,o,s]),es=(0,l.useCallback)(async()=>{n&&t&&i&&(await s.from("student_lessons").update({media_complete:!0,media_at:new Date().toISOString()}).eq("student_id",t.id).eq("lesson_id",i.id),await s.from("world_states").update({stones:((null==o?void 0:o.stones)||0)+1,updated_at:new Date().toISOString()}).eq("student_id",t.id),c({...n,media_complete:!0}),d(e=>e?{...e,stones:(e.stones||0)+1}:null))},[n,t,i,o,s]),et=(0,l.useCallback)(e=>{d(s=>s?{...s,...e}:null)},[]),ea=(0,l.useCallback)(e=>{c(s=>s?{...s,...e}:null)},[]);return(0,l.useEffect)(()=>{X()},[X]),{user:t,lesson:i,progress:n,world:o,helpRequests:m,civicEvents:u,teacherChallenges:h,discoveries:v,journalData:y,connectionMapData:N,placedItems:C,inventoryItems:S,discoveredSecrets:Z,gatewayComplete:I,dailyUnmaskData:q,studentSkills:L,loading:O,isOnline:M,error:R,loadData:X,handleLogout:K,refreshHelpRequests:Q,refreshDiscoveries:$,markTextAnchorComplete:ee,markMediaComplete:es,updateWorld:et,updateProgress:ea}}(),[F,J]=(0,l.useState)("home"),[Y,U]=(0,l.useState)(!1);l.useEffect(()=>{"true"===localStorage.getItem("leadership_show_welcome")&&(null==v?void 0:v.name)&&(U(!0),localStorage.removeItem("leadership_show_welcome")),!localStorage.getItem("radiance_onboarding_complete")&&(null==v?void 0:v.id)&&ex(!0)},[v]);let[V,X]=(0,l.useState)(!1),[K,Q]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(!1),[es,et]=(0,l.useState)(!1),[el,ei]=(0,l.useState)(!1),[er,en]=(0,l.useState)(!1),[ec,eo]=(0,l.useState)(!1),[ed,ex]=(0,l.useState)(!1),[eu,ep]=(0,l.useState)(!1),[ef,ev]=(0,l.useState)(!1),[eb,ej]=(0,l.useState)(!1),[eq,eL]=(0,l.useState)(!1),[eT,eO]=(0,l.useState)(!1),eA=async e=>{if(null==j?void 0:j.id)try{let s=(await Promise.resolve().then(t.bind(t,7925))).createClient(),{error:a}=await s.rpc("complete_step",{p_lesson_id:j.id,p_step_type:e});a&&console.error("complete_step error:",a),O()}catch(e){console.error("Failed to complete step:",e)}},[eM,eH]=l.useState(0);l.useEffect(()=>{(async()=>{if(!(null==v?void 0:v.id))return;let e=(await Promise.resolve().then(t.bind(t,7925))).createClient(),{data:s}=await e.from("student_cores").select("battery_level").eq("student_id",v.id).single();s&&eH(s.battery_level||0)})()},[null==v?void 0:v.id]);let eR=async()=>{await eA("do_now"),X(!1)},eB=async()=>{await eA("scenario"),ee(!1),et(!0)},eG=((null==w?void 0:w.trees)||0)+((null==w?void 0:w.flowers)||0)+((null==w?void 0:w.tower)||0)+((null==w?void 0:w.bridge)||0);return P?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-purple-950/20 to-slate-950 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)(i.E.div,{className:"relative w-20 h-20 mx-auto mb-6",animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-400 to-violet-600 opacity-60 blur-xl"}),(0,a.jsx)("div",{className:"absolute inset-2 rounded-full bg-gradient-to-br from-purple-300 to-violet-500"}),(0,a.jsx)("div",{className:"absolute inset-4 rounded-full bg-gradient-to-br from-white/30 to-transparent"})]}),(0,a.jsxs)("p",{className:"text-purple-300/70 font-mono text-sm animate-pulse",children:[">"," SYNCING CORE..."]})]})}):T?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-purple-950/20 to-slate-950 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"card p-8 max-w-md text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"⚠️"}),(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Something went wrong"}),(0,a.jsx)("p",{className:"text-surface-400 mb-4",children:T}),(0,a.jsx)("button",{onClick:O,className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"min-h-screen relative overflow-hidden bg-gradient-to-br from-slate-950 via-purple-950/20 to-slate-950",children:[(0,a.jsx)("div",{className:"fixed inset-0 pointer-events-none z-0",children:[...Array(25)].map((e,s)=>(0,a.jsx)("div",{className:"absolute w-1 h-1 bg-purple-400/30 rounded-full",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),animation:"float ".concat(3+4*Math.random(),"s ease-in-out infinite"),animationDelay:"".concat(2*Math.random(),"s")}},s))}),(0,a.jsx)("header",{className:"sticky top-0 z-40 backdrop-blur-xl bg-slate-900/80 border-b border-purple-500/20",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative w-10 h-10",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-400 to-violet-600 opacity-60 blur-md animate-pulse"}),(0,a.jsx)("div",{className:"absolute inset-1 rounded-full bg-gradient-to-br from-purple-300 to-violet-500 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-xs font-bold text-white",children:[eM,"%"]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-bold text-white text-lg tracking-wide",children:"RADIANCE"}),(0,a.jsxs)("p",{className:"text-xs text-surface-500",children:["Phase ",null==j?void 0:j.phase_id,": ",eE[null==j?void 0:j.phase_id]]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium ".concat(L?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"),children:[L?(0,a.jsx)(n.Z,{size:14}):(0,a.jsx)(c.Z,{size:14}),L?"Online":"Offline"]}),(null==v?void 0:v.id)&&(0,a.jsx)(eZ,{studentId:v.id}),(0,a.jsxs)("div",{className:"streak-counter text-xs",children:[(0,a.jsx)(o.Z,{size:14,className:"streak-fire"}),(0,a.jsx)("span",{className:"font-bold",children:eG})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm",children:null==v?void 0:null===(s=v.name)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.toUpperCase()}),(0,a.jsx)("span",{className:"text-sm font-medium text-surface-200 hidden sm:block",children:null==v?void 0:v.name})]}),(0,a.jsx)("button",{onClick:A,className:"p-2 text-surface-400 hover:text-surface-200 rounded-lg hover:bg-surface-800 transition-colors",children:(0,a.jsx)(d.Z,{size:18})})]})]})}),(0,a.jsx)("main",{className:"relative z-10 max-w-6xl mx-auto px-4 py-6 pb-24",children:(0,a.jsxs)(r.M,{mode:"wait",children:["home"===F&&(0,a.jsx)(W,{lesson:j,progress:y,world:w,onDoNowClick:()=>X(!0),onScenarioClick:()=>ee(!0),onChallengeClick:()=>et(!0),onTextAnchorComplete:H,onMediaComplete:R,classId:null==v?void 0:v.class_id,studentId:null==v?void 0:v.id}),"world"===F&&(0,a.jsx)(ea,{world:w,userName:(null==v?void 0:v.name)||"Student",placedItems:z,inventoryItems:Z,discoveredSecrets:D,onBrainstormOpen:()=>en(!0)}),"commons"===F&&(0,a.jsx)(em,{helpRequests:N,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,onRefresh:M}),"discover"===F&&(0,a.jsx)(eh,{teacherChallenges:_,discoveries:C,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,onChallengeSubmit:async(e,s,t,a)=>{await fetch("/api/challenges/teacher/response",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challengeId:e,studentId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,responseText:s,personalConnection:t,shareWithClass:a})}),O()},onDiscoveryPost:async e=>{await fetch("/api/discoveries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,...e})}),O()},onDiscoveryVote:async e=>{await fetch("/api/discoveries",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({discoveryId:e,studentId:null==v?void 0:v.id,action:"vote"})}),O()}}),"progress"===F&&(0,a.jsx)(eg,{world:w,currentLesson:(null==j?void 0:j.id)||1,journalData:k,connectionMapData:S,userId:null==v?void 0:v.id})]})}),(0,a.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-slate-900/90 backdrop-blur-xl border-t border-purple-500/20 z-50",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-around py-2",children:[(0,a.jsx)(eP,{icon:m.Z,label:"Home",active:"home"===F,onClick:()=>J("home")}),(0,a.jsx)(eP,{icon:o.Z,label:"Core",active:"world"===F,onClick:()=>J("world")}),(0,a.jsx)(eP,{icon:x.Z,label:"Commons",active:"commons"===F,onClick:()=>J("commons"),badge:N.length}),(0,a.jsx)(eP,{icon:u.Z,label:"Discover",active:"discover"===F,onClick:()=>J("discover")}),(0,a.jsx)(eP,{icon:p.Z,label:"Progress",active:"progress"===F,onClick:()=>J("progress")})]})})}),(0,a.jsxs)(i.E.button,{onClick:()=>Q(!0),className:"fixed bottom-20 right-4 px-4 py-2 bg-surface-800 hover:bg-surface-700 text-white rounded-xl shadow-lg z-40 flex items-center gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},children:[(0,a.jsx)(h.Z,{size:16}),"Exit Ticket"]}),(0,a.jsx)(i.E.button,{onClick:()=>en(!0),className:"fixed bottom-20 left-4 p-3 bg-purple-600 hover:bg-purple-500 text-white rounded-full shadow-lg z-40",whileHover:{scale:1.1},whileTap:{scale:.95},title:"Brainstorm Ideas",children:(0,a.jsx)(f.Z,{size:20})}),(0,a.jsxs)("div",{className:"fixed bottom-20 left-1/2 -translate-x-1/2 flex gap-2 z-40",children:[(0,a.jsx)(i.E.button,{onClick:()=>ep(!0),className:"px-4 py-2 bg-blue-600/80 hover:bg-blue-500 text-white rounded-xl backdrop-blur-sm text-sm",whileHover:{scale:1.05},children:"\uD83D\uDD2E My Core"}),(0,a.jsxs)(i.E.button,{onClick:()=>{if(eM<50){alert("\uD83D\uDD0B Oxygen Mask Rule: Reach 50% Core energy before accessing the Nexus. Focus on yourself first!");return}ev(!0)},className:"px-4 py-2 ".concat(eM>=50?"bg-purple-600/80 hover:bg-purple-500":"bg-zinc-600/50 cursor-not-allowed"," text-white rounded-xl backdrop-blur-sm text-sm"),whileHover:{scale:eM>=50?1.05:1},children:["\uD83C\uDF10 Class Nexus ",eM<50&&"\uD83D\uDD12"]})]}),(0,a.jsx)(eD,{}),(0,a.jsxs)(r.M,{children:[V&&(0,a.jsx)(ey,{type:"do_now",lesson:j,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,userName:null==v?void 0:v.name,onClose:()=>X(!1),onComplete:eR}),$&&(0,a.jsx)(ey,{type:"scenario",lesson:j,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,userName:null==v?void 0:v.name,onClose:()=>ee(!1),onScenarioComplete:eB}),K&&(0,a.jsx)(ey,{type:"exit_ticket",lesson:j,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,userName:null==v?void 0:v.name,onClose:()=>Q(!1)}),es&&(0,a.jsx)(ew,{lesson:j,userId:null==v?void 0:v.id,classId:null==v?void 0:v.class_id,onClose:()=>{et(!1),O()}})]}),el&&(0,a.jsx)(eN,{onComplete:async e=>{await fetch("/api/gateway",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:null==v?void 0:v.id,...e})}),ei(!1),O()}}),ec&&E&&(0,a.jsx)(e_,{anonymousName:E.anonymousName,realName:E.realName,reason:E.reason,rippleCount:E.rippleCount,onContinue:()=>eo(!1)}),ed&&(0,a.jsx)(ek,{onComplete:()=>{ex(!1),localStorage.setItem("radiance_onboarding_complete","true")}}),eu&&(null==v?void 0:v.id)&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-4xl h-[80vh] relative",children:[(0,a.jsx)("button",{onClick:()=>ep(!1),className:"absolute top-4 right-4 z-10 p-2 bg-zinc-800 rounded-full text-white hover:bg-zinc-700",children:"✕"}),(0,a.jsx)(eS,{studentId:v.id})]})}),ef&&(null==v?void 0:v.class_id)&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-4xl h-[80vh] relative",children:[(0,a.jsx)("button",{onClick:()=>ev(!1),className:"absolute top-4 right-4 z-10 p-2 bg-zinc-800 rounded-full text-white hover:bg-zinc-700",children:"✕"}),(0,a.jsx)(ez,{classId:v.class_id,studentId:v.id})]})}),(null==v?void 0:v.id)&&(null==v?void 0:v.class_id)&&"world"===F&&(0,a.jsx)("div",{className:"fixed top-24 right-4 z-30",children:(0,a.jsx)(eI,{studentId:v.id,classId:v.class_id})}),(0,a.jsx)(eC,{isOpen:er,onClose:()=>en(!1),studentSkills:q,onActionPlan:e=>{console.log("Action plan committed:",e),en(!1)}}),(0,a.jsx)(r.M,{children:Y&&(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>U(!1),children:(0,a.jsxs)(i.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gradient-to-br from-surface-800 to-surface-900 rounded-2xl p-8 max-w-md text-center border border-surface-700 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)(i.E.div,{className:"text-6xl mb-4",animate:{scale:[1,1.2,1],rotate:[0,10,-10,0]},transition:{duration:1.5,repeat:2},children:(0,a.jsx)(o.Z,{className:"w-16 h-16 mx-auto text-primary-400"})}),(0,a.jsxs)("h2",{className:"text-3xl font-bold text-white mb-2",children:["Hello ",null==v?void 0:v.name,"!"]}),(0,a.jsx)("p",{className:"text-xl text-primary-400 mb-6",children:"Welcome back!"}),(0,a.jsx)("p",{className:"text-surface-400 mb-6",children:"Ready to continue your leadership journey?"}),(0,a.jsx)(i.E.button,{onClick:()=>U(!1),className:"px-8 py-3 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-semibold",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Let's Go!"})]})})})]})}function eP(e){let{icon:s,label:t,active:l,onClick:i,badge:r}=e;return(0,a.jsxs)("button",{onClick:i,className:"flex flex-col items-center gap-1 px-4 py-2 rounded-xl transition-all relative ".concat(l?"text-purple-400 bg-purple-500/20 shadow-[0_0_15px_rgba(147,51,234,0.3)]":"text-slate-400 hover:text-purple-300"),children:[(0,a.jsx)(s,{size:22}),(0,a.jsx)("span",{className:"text-xs font-medium",children:t}),r&&r>0&&(0,a.jsx)("span",{className:"notification-badge",children:r})]})}},7925:function(e,s,t){"use strict";t.r(s),t.d(s,{createClient:function(){return i}});var a=t(9982);let l=null;function i(){if(l)return l;let e="https://apakkhzuydsfzvypewwa.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwYWtraHp1eWRzZnp2eXBld3dhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1MDEyODQsImV4cCI6MjA4NDA3NzI4NH0.c3hiZOEKMIXMP7aB0SVgrbQH58nwxseycVmeH23KsNQ";if(!e||!s)throw Error("Missing Supabase environment variables. Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");return l=(0,a.createBrowserClient)(e,s)}}},function(e){e.O(0,[220,535,898,741,564,744],function(){return e(e.s=7052)}),_N_E=e.O()}]);