"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{9654:function(e,t,n){n.d(t,{Z:function(){return s}});let s=(0,n(7415).Z)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]])},5748:function(e,t,n){n.d(t,{Z:function(){return s}});let s=(0,n(7415).Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]])},5292:function(e,t,n){n.d(t,{Z:function(){return s}});let s=(0,n(7415).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},5626:function(e,t,n){n.r(t),n.d(t,{default:function(){return f}});var s=n(8357),a=n(921),i=n(1374),r=n(9654),o=n(3836);let l=(0,n(7415).Z)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var c=n(5748),u=n(5292),d=n(6694),p=n(7925);function f(e){let{type:t,lesson:n,userId:f,classId:x,userName:h,classSettings:y,batteryLevel:m=50,onClose:g,onComplete:v,onScenarioComplete:w}=e,[b,_]=(0,a.useState)([]),[k,j]=(0,a.useState)(""),[N,S]=(0,a.useState)(!1),[E,C]=(0,a.useState)(!1),[Z,D]=(0,a.useState)(0),[M,R]=(0,a.useState)(!1),[T,I]=(0,a.useState)(!1),O=(0,a.useRef)(null),z=(0,a.useRef)(null),A=(0,p.createClient)(),F=(null==y?void 0:y.min_responses)||5,L=(null==y?void 0:y.interaction_mode)||"typing";(0,a.useEffect)(()=>{if("SpeechRecognition"in window||"webkitSpeechRecognition"in window){I(!0);let e=window.SpeechRecognition||window.webkitSpeechRecognition;z.current=new e,z.current.continuous=!1,z.current.interimResults=!1,z.current.onresult=e=>{let t=e.results[0][0].transcript;j(e=>e+" "+t),R(!1)},z.current.onerror=()=>R(!1),z.current.onend=()=>R(!1)}return()=>{z.current&&z.current.abort()}},[]),(0,a.useEffect)(()=>{_([{role:"assistant",content:"do_now"===t?"Hey ".concat(h||"there",'! Ready to charge up?\n\n**"').concat(null==n?void 0:n.compelling_question,"\"**\n\nWhat's your first instinct?"):"scenario"===t?"Time to put ".concat(null==n?void 0:n.skill_name," into practice. I'll challenge your thinking. Ready?"):"Let's lock in today's learning about ".concat(null==n?void 0:n.skill_name,". What stuck with you?")}])},[t,n,h]),(0,a.useEffect)(()=>{var e;null===(e=O.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[b]);let V=(0,a.useCallback)(async()=>{if(!k.trim()||N)return;let e=k.trim();if(e.split(" ").length<3&&Z<F){_(t=>[...t,{role:"user",content:e},{role:"assistant",content:"Give me at least a full sentence. What are you really thinking?"}]),j("");return}let s=[...b,{role:"user",content:e}];j(""),_(s),S(!0),D(e=>e+1);try{let a=await fetch("/api/ai/socratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,lesson_id:null==n?void 0:n.id,student_id:f,class_id:x,conversation_history:b,user_message:e,lesson_context:n,response_count:Z+1,min_responses:F,battery_level:m,ai_persona:null==y?void 0:y.ai_persona,ai_difficulty:null==y?void 0:y.ai_difficulty})});if(!a.ok)throw Error("Network response was not ok");let i=await a.json();if(i.crisis_detected){_(e=>[...e,{role:"assistant",content:i.message}]);return}if(_(e=>[...e,{role:"assistant",content:i.message}]),i.should_complete&&Z>=F-1){C(!0);let e="do_now"===t?"do_now_sessions":"exit_ticket"===t?"exit_ticket_sessions":"scenario_sessions",a=[...s,{role:"assistant",content:i.message}];await A.from(e).insert({student_id:f,lesson_id:null==n?void 0:n.id,class_id:x,conversation:a,response_count:Z+1,completed_at:new Date().toISOString(),..."scenario"!==t?{date:new Date().toISOString().split("T")[0]}:{}})}}catch(e){console.error("Error:",e),_(e=>[...e,{role:"assistant",content:"Connection unstable. Try again."}])}finally{S(!1)}},[k,N,b,Z,t,n,f,x,m,y,F,A]),W=async()=>{let{data:e,error:s}=await A.rpc("complete_step",{p_lesson_id:null==n?void 0:n.id,p_step_type:t});s&&console.error("Complete step error:",s),"scenario"===t&&w?w():v&&v(),g()};return(0,s.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:(0,s.jsxs)(i.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},className:"bg-surface-800 rounded-2xl w-full max-w-2xl max-h-[85vh] flex flex-col",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-surface-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-lg font-semibold",children:"do_now"===t?"âš¡ Do Now":"scenario"===t?"\uD83C\uDFAF Scenario":"\uD83D\uDD12 Exit Ticket"}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-surface-400",children:[(0,s.jsx)(r.Z,{className:"w-4 h-4 text-orange-500"}),(0,s.jsxs)("span",{children:[Z,"/",F]})]})]}),(0,s.jsx)("button",{onClick:g,className:"p-2 hover:bg-surface-700 rounded-lg",children:(0,s.jsx)(o.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[b.map((e,t)=>(0,s.jsx)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsx)("div",{className:"max-w-[80%] rounded-2xl px-4 py-3 ".concat("user"===e.role?"bg-primary-600 text-white":"bg-surface-700 text-surface-100"),children:e.content})},t)),N&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-surface-700 rounded-2xl px-4 py-3",children:(0,s.jsx)("span",{className:"animate-pulse",children:"Processing..."})})}),(0,s.jsx)("div",{ref:O})]}),(0,s.jsx)("footer",{className:"p-4 border-t border-surface-700",children:E?(0,s.jsxs)("button",{onClick:W,className:"w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl font-semibold flex items-center justify-center gap-2 hover:from-green-400 hover:to-emerald-500 transition-all",children:[(0,s.jsx)(d.Z,{className:"w-5 h-5"}),"Lock In & Earn Energy"]}):(0,s.jsxs)("div",{className:"flex gap-2",children:[("voice"===L||"both"===L)&&T&&(0,s.jsx)("button",{onClick:()=>{z.current&&(M?z.current.stop():(z.current.start(),R(!0)))},className:"p-3 rounded-xl transition-colors ".concat(M?"bg-red-500 text-white":"bg-surface-700 hover:bg-surface-600"),children:M?(0,s.jsx)(l,{className:"w-5 h-5"}):(0,s.jsx)(c.Z,{className:"w-5 h-5"})}),("typing"===L||"both"===L)&&(0,s.jsx)("input",{value:k,onChange:e=>j(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&V(),placeholder:M?"Listening...":"Type your response...",className:"flex-1 bg-surface-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:M}),(0,s.jsx)("button",{onClick:V,disabled:N||!k.trim(),className:"p-3 bg-primary-600 hover:bg-primary-500 disabled:opacity-50 rounded-xl",children:(0,s.jsx)(u.Z,{className:"w-5 h-5"})})]})})]})})}}}]);