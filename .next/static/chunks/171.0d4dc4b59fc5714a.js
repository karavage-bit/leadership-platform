"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{5292:function(e,t,s){s.d(t,{Z:function(){return a}});let a=(0,s(7415).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9171:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=s(8357),n=s(921),i=s(1374),o=s(3836),r=s(6694),l=s(5292),c=s(7925);function u(e){let{type:t,lesson:s,userId:u,classId:d,userName:h,onClose:m,onComplete:p,onScenarioComplete:x}=e,[f,y]=(0,n.useState)([]),[b,g]=(0,n.useState)(""),[w,v]=(0,n.useState)(!1),[_,j]=(0,n.useState)(!1),[k,N]=(0,n.useState)(0),S=(0,n.useRef)(null),D=(0,c.e)();(0,n.useEffect)(()=>{E()},[t,s]);let E=()=>{y([{role:"assistant",content:"do_now"===t?"Hey ".concat(h||"there","! \uD83D\uDC4B Ready to warm up that brain?\n\nHere's today's question to think about:\n\n**\"").concat(null==s?void 0:s.compelling_question,'"**\n\nTake a moment to really think about this. What comes to mind first?'):"scenario"===t?"Alright ".concat(h||"there",", time to put ").concat(null==s?void 0:s.skill_name," into practice.\n\nI'm going to present you with a real-life situation. Fair warning: I won't let you off easy. I'll push back, ask hard questions, and make you think.\n\nReady to begin?"):"Let's wrap up today's learning about ".concat(null==s?void 0:s.skill_name,".\n\nWhat's one thing that stuck with you from today?")}])};(0,n.useEffect)(()=>{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[f]);let C=async()=>{if(!b.trim()||w)return;if(b.trim().split(" ").length<3&&k<5){y(e=>[...e,{role:"user",content:b.trim()},{role:"assistant",content:"I need more than that! Give me at least a full sentence. What are you really thinking?"}]),g("");return}let e=b.trim();g(""),y(t=>[...t,{role:"user",content:e}]),v(!0),N(e=>e+1);try{let a=await fetch("/api/ai/socratic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:t,lesson_id:null==s?void 0:s.id,student_id:u,class_id:d,conversation_history:f,user_message:e,lesson_context:s,response_count:k+1,min_responses:5})}),n=await a.json();if(n.crisis_detected){y(e=>[...e,{role:"assistant",content:n.message}]);return}if(y(e=>[...e,{role:"assistant",content:n.message}]),n.should_complete&&k>=4){j(!0);let a="do_now"===t?"do_now_sessions":"exit_ticket"===t?"exit_ticket_sessions":"scenario_sessions";await D.from(a).insert({student_id:u,lesson_id:null==s?void 0:s.id,class_id:d,conversation:[...f,{role:"user",content:e},{role:"assistant",content:n.message}],response_count:k+1,completed_at:new Date().toISOString(),..."scenario"!==t?{date:new Date().toISOString().split("T")[0]}:{}})}}catch(e){console.error("Error:",e),y(e=>[...e,{role:"assistant",content:"Connection issue. Your work is saved locally. Try again when you reconnect."}])}finally{v(!1)}};return(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)(i.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-surface-900 rounded-2xl w-full max-w-2xl max-h-[85vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-surface-800 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h2",{className:"font-semibold text-surface-100",children:{do_now:"\uD83E\uDDE0 Do Now",scenario:"âš¡ Socratic Scenario",exit_ticket:"\uD83C\uDFAB Exit Ticket"}[t]}),(0,a.jsxs)("span",{className:"text-xs text-surface-500 bg-surface-800 px-2 py-1 rounded-lg",children:[k,"/",5," exchanges"]})]}),(0,a.jsx)("button",{onClick:m,className:"text-surface-500 hover:text-surface-300 p-1",children:(0,a.jsx)(o.Z,{size:20})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[f.map((e,t)=>(0,a.jsx)(i.E.div,{className:"assistant"===e.role?"chat-ai":"chat-user",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.content})},t)),w&&(0,a.jsx)("div",{className:"chat-ai",children:(0,a.jsxs)("div",{className:"typing-indicator flex gap-1",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-surface-500 rounded-full animate-bounce"}),(0,a.jsx)("span",{className:"w-2 h-2 bg-surface-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),(0,a.jsx)("span",{className:"w-2 h-2 bg-surface-500 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})}),(0,a.jsx)("div",{ref:S})]}),(0,a.jsx)("div",{className:"p-4 border-t border-surface-800",children:_?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-green-400 mb-3 flex items-center justify-center gap-2",children:[(0,a.jsx)(r.Z,{size:20})," Session complete!"]}),(0,a.jsx)(i.E.button,{onClick:()=>{"do_now"===t&&p?p():"scenario"===t&&x?x(""):m()},className:"px-6 py-2 bg-primary-600 hover:bg-primary-500 text-white rounded-xl font-medium transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"scenario"===t?"Continue to Challenge":"Done"})]}):(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 bg-surface-800 border border-surface-700 rounded-xl px-4 py-2 text-white placeholder:text-surface-500 focus:border-primary-500 outline-none",placeholder:"Type your response (be thoughtful!)...",value:b,onChange:e=>g(e.target.value),onKeyPress:e=>"Enter"===e.key&&C(),disabled:w}),(0,a.jsx)(i.E.button,{onClick:C,disabled:w||!b.trim(),className:"px-4 py-2 bg-primary-600 hover:bg-primary-500 disabled:bg-surface-700 text-white rounded-xl transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsx)(l.Z,{size:18})})]})})]})})}}}]);